{"ast":null,"code":"import React,{Component,useEffect}from\"react\";import\"./gaussian.css\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";let cameras=[{id:0,img_name:\"00001\",width:1959,height:1090,position:[-3.0089893469241797,-0.11086489695181866,-3.7527640949141428],rotation:[[0.876134201218856,0.06925962026449776,0.47706599800804744],[-0.04747421839895102,0.9972110940209488,-0.057586739349882114],[-0.4797239414934443,0.027805376500959853,0.8769787916452908]],fy:1164.6601287484507,fx:1159.5880733038064},{id:1,img_name:\"00009\",width:1959,height:1090,position:[-2.5199776022057296,-0.09704735754873686,-3.6247725540304545],rotation:[[0.9982731285632193,-0.011928707708098955,-0.05751927260507243],[0.0065061360949636325,0.9955928229282383,-0.09355533724430458],[0.058381769258182864,0.09301955098900708,0.9939511719154457]],fy:1164.6601287484507,fx:1159.5880733038064},{id:2,img_name:\"00017\",width:1959,height:1090,position:[-0.7737533667465242,-0.3364271945329695,-2.9358969417573753],rotation:[[0.9998813418672372,0.013742375651625236,-0.0069605529394208224],[-0.014268370388586709,0.996512943252834,-0.08220929105659476],[0.00580653013657589,0.08229885200307129,0.9965907801935302]],fy:1164.6601287484507,fx:1159.5880733038064},{id:3,img_name:\"00025\",width:1959,height:1090,position:[1.2198221749590001,-0.2196687861401182,-2.3183162007028453],rotation:[[0.9208648867765482,0.0012010625395201253,0.389880004297208],[-0.06298204172269357,0.987319521752825,0.14571693239364383],[-0.3847611242348369,-0.1587410451475895,0.9092635249821667]],fy:1164.6601287484507,fx:1159.5880733038064},{id:4,img_name:\"00033\",width:1959,height:1090,position:[1.742387858893817,-0.13848225198886954,-2.0566370113193146],rotation:[[0.24669889292141334,-0.08370189346592856,-0.9654706879349405],[0.11343747891376445,0.9919082664242816,-0.05700815184573074],[0.9624300466054861,-0.09545671285663988,0.2541976029815521]],fy:1164.6601287484507,fx:1159.5880733038064},{id:5,img_name:\"00041\",width:1959,height:1090,position:[3.6567309419223935,-0.16470990600750707,-1.3458085590422042],rotation:[[0.2341293058324528,-0.02968330457755884,-0.9717522161434825],[0.10270823606832301,0.99469554638321,-0.005638106875665722],[0.9667649592295676,-0.09848690996657204,0.2359360976431732]],fy:1164.6601287484507,fx:1159.5880733038064},{id:6,img_name:\"00049\",width:1959,height:1090,position:[3.9013554243203497,-0.2597500978038105,-0.8106154188297828],rotation:[[0.6717235545638952,-0.015718162115524837,-0.7406351366386528],[0.055627354673906296,0.9980224478387622,0.029270992841185218],[0.7387104058127439,-0.060861588786650656,0.6712695459756353]],fy:1164.6601287484507,fx:1159.5880733038064},{id:7,img_name:\"00057\",width:1959,height:1090,position:[4.742994605467533,-0.05591660945412069,0.9500365976084458],rotation:[[-0.17042655709210375,0.01207080756938,-0.9852964448542146],[0.1165090336695526,0.9931575292530063,-0.00798543433078162],[0.9784581921120181,-0.1161568667478904,-0.1706667764862097]],fy:1164.6601287484507,fx:1159.5880733038064},{id:8,img_name:\"00065\",width:1959,height:1090,position:[4.34676307626522,0.08168160516967145,1.0876221470355405],rotation:[[-0.003575447631888379,-0.044792503246552894,-0.9989899137764799],[0.10770152645126597,0.9931680875192705,-0.04491693593046672],[0.9941768441149182,-0.10775333677534978,0.0012732004866391048]],fy:1164.6601287484507,fx:1159.5880733038064},{id:9,img_name:\"00073\",width:1959,height:1090,position:[3.264984351114202,0.078974937336732,1.0117200284114904],rotation:[[-0.026919994628162257,-0.1565891128261527,-0.9872968974090509],[0.08444552208239385,0.983768234577625,-0.1583319754069128],[0.9960643893290491,-0.0876350978794554,-0.013259786205163005]],fy:1164.6601287484507,fx:1159.5880733038064}];let camera=cameras[0];function getProjectionMatrix(fx,fy,width,height){const znear=0.2;const zfar=200;return[[2*fx/width,0,0,0],[0,-(2*fy)/height,0,0],[0,0,zfar/(zfar-znear),1],[0,0,-(zfar*znear)/(zfar-znear),0]].flat();}function getViewMatrix(camera){const R=camera.rotation.flat();const t=camera.position;const camToWorld=[[R[0],R[1],R[2],0],[R[3],R[4],R[5],0],[R[6],R[7],R[8],0],[-t[0]*R[0]-t[1]*R[3]-t[2]*R[6],-t[0]*R[1]-t[1]*R[4]-t[2]*R[7],-t[0]*R[2]-t[1]*R[5]-t[2]*R[8],1]].flat();return camToWorld;}// function translate4(a, x, y, z) {\n//     return [\n//         ...a.slice(0, 12),\n//         a[0] * x + a[4] * y + a[8] * z + a[12],\n//         a[1] * x + a[5] * y + a[9] * z + a[13],\n//         a[2] * x + a[6] * y + a[10] * z + a[14],\n//         a[3] * x + a[7] * y + a[11] * z + a[15],\n//     ];\n// }\nfunction normalize(vec3){const length=Math.sqrt(vec3[0]*vec3[0]+vec3[1]*vec3[1]+vec3[2]*vec3[2]);if(length===0){return[0,0,0];}return[vec3[0]/length,vec3[1]/length,vec3[2]/length];}function cross(vec3a,vec3b){const x=vec3a[1]*vec3b[2]-vec3a[2]*vec3b[1];const y=vec3a[2]*vec3b[0]-vec3a[0]*vec3b[2];const z=vec3a[0]*vec3b[1]-vec3a[1]*vec3b[0];return[x,y,z];}function multiply4(a,b){return[b[0]*a[0]+b[1]*a[4]+b[2]*a[8]+b[3]*a[12],b[0]*a[1]+b[1]*a[5]+b[2]*a[9]+b[3]*a[13],b[0]*a[2]+b[1]*a[6]+b[2]*a[10]+b[3]*a[14],b[0]*a[3]+b[1]*a[7]+b[2]*a[11]+b[3]*a[15],b[4]*a[0]+b[5]*a[4]+b[6]*a[8]+b[7]*a[12],b[4]*a[1]+b[5]*a[5]+b[6]*a[9]+b[7]*a[13],b[4]*a[2]+b[5]*a[6]+b[6]*a[10]+b[7]*a[14],b[4]*a[3]+b[5]*a[7]+b[6]*a[11]+b[7]*a[15],b[8]*a[0]+b[9]*a[4]+b[10]*a[8]+b[11]*a[12],b[8]*a[1]+b[9]*a[5]+b[10]*a[9]+b[11]*a[13],b[8]*a[2]+b[9]*a[6]+b[10]*a[10]+b[11]*a[14],b[8]*a[3]+b[9]*a[7]+b[10]*a[11]+b[11]*a[15],b[12]*a[0]+b[13]*a[4]+b[14]*a[8]+b[15]*a[12],b[12]*a[1]+b[13]*a[5]+b[14]*a[9]+b[15]*a[13],b[12]*a[2]+b[13]*a[6]+b[14]*a[10]+b[15]*a[14],b[12]*a[3]+b[13]*a[7]+b[14]*a[11]+b[15]*a[15]];}function invert4(a){let b00=a[0]*a[5]-a[1]*a[4];let b01=a[0]*a[6]-a[2]*a[4];let b02=a[0]*a[7]-a[3]*a[4];let b03=a[1]*a[6]-a[2]*a[5];let b04=a[1]*a[7]-a[3]*a[5];let b05=a[2]*a[7]-a[3]*a[6];let b06=a[8]*a[13]-a[9]*a[12];let b07=a[8]*a[14]-a[10]*a[12];let b08=a[8]*a[15]-a[11]*a[12];let b09=a[9]*a[14]-a[10]*a[13];let b10=a[9]*a[15]-a[11]*a[13];let b11=a[10]*a[15]-a[11]*a[14];let det=b00*b11-b01*b10+b02*b09+b03*b08-b04*b07+b05*b06;if(!det)return null;return[(a[5]*b11-a[6]*b10+a[7]*b09)/det,(a[2]*b10-a[1]*b11-a[3]*b09)/det,(a[13]*b05-a[14]*b04+a[15]*b03)/det,(a[10]*b04-a[9]*b05-a[11]*b03)/det,(a[6]*b08-a[4]*b11-a[7]*b07)/det,(a[0]*b11-a[2]*b08+a[3]*b07)/det,(a[14]*b02-a[12]*b05-a[15]*b01)/det,(a[8]*b05-a[10]*b02+a[11]*b01)/det,(a[4]*b10-a[5]*b08+a[7]*b06)/det,(a[1]*b08-a[0]*b10-a[3]*b06)/det,(a[12]*b04-a[13]*b02+a[15]*b00)/det,(a[9]*b02-a[8]*b04-a[11]*b00)/det,(a[5]*b07-a[4]*b09-a[6]*b06)/det,(a[0]*b09-a[1]*b07+a[2]*b06)/det,(a[13]*b01-a[12]*b03-a[14]*b00)/det,(a[8]*b03-a[9]*b01+a[10]*b00)/det];}function rotate4(a,rad,x,y,z){let len=Math.hypot(x,y,z);x/=len;y/=len;z/=len;let s=Math.sin(rad);let c=Math.cos(rad);let t=1-c;let b00=x*x*t+c;let b01=y*x*t+z*s;let b02=z*x*t-y*s;let b10=x*y*t-z*s;let b11=y*y*t+c;let b12=z*y*t+x*s;let b20=x*z*t+y*s;let b21=y*z*t-x*s;let b22=z*z*t+c;return[a[0]*b00+a[4]*b01+a[8]*b02,a[1]*b00+a[5]*b01+a[9]*b02,a[2]*b00+a[6]*b01+a[10]*b02,a[3]*b00+a[7]*b01+a[11]*b02,a[0]*b10+a[4]*b11+a[8]*b12,a[1]*b10+a[5]*b11+a[9]*b12,a[2]*b10+a[6]*b11+a[10]*b12,a[3]*b10+a[7]*b11+a[11]*b12,a[0]*b20+a[4]*b21+a[8]*b22,a[1]*b20+a[5]*b21+a[9]*b22,a[2]*b20+a[6]*b21+a[10]*b22,a[3]*b20+a[7]*b21+a[11]*b22,...a.slice(12,16)];}function translate4(a,x,y,z){return[...a.slice(0,12),a[0]*x+a[4]*y+a[8]*z+a[12],a[1]*x+a[5]*y+a[9]*z+a[13],a[2]*x+a[6]*y+a[10]*z+a[14],a[3]*x+a[7]*y+a[11]*z+a[15]];}function createWorker(self){let buffer;let vertexCount=0;let viewProj;// 6*4 + 4 + 4 = 8*4\n// XYZ - Position (Float32)\n// XYZ - Scale (Float32)\n// RGBA - colors (uint8)\n// IJKL - quaternion/rot (uint8)\nconst rowLength=3*4+3*4+4+4;let lastProj=[];let depthIndex=new Uint32Array();let lastVertexCount=0;var _floatView=new Float32Array(1);var _int32View=new Int32Array(_floatView.buffer);function floatToHalf(float){_floatView[0]=float;var f=_int32View[0];var sign=f>>31&0x0001;var exp=f>>23&0x00ff;var frac=f&0x007fffff;var newExp;if(exp==0){newExp=0;}else if(exp<113){newExp=0;frac|=0x00800000;frac=frac>>113-exp;if(frac&0x01000000){newExp=1;frac=0;}}else if(exp<142){newExp=exp-112;}else{newExp=31;frac=0;}return sign<<15|newExp<<10|frac>>13;}function packHalf2x16(x,y){return(floatToHalf(x)|floatToHalf(y)<<16)>>>0;}function generateTexture(){if(!buffer)return;const f_buffer=new Float32Array(buffer);const u_buffer=new Uint8Array(buffer);var texwidth=1024*2;// Set to your desired width\nvar texheight=Math.ceil(2*vertexCount/texwidth);// Set to your desired height\nvar texdata=new Uint32Array(texwidth*texheight*4);// 4 components per pixel (RGBA)\nvar texdata_c=new Uint8Array(texdata.buffer);var texdata_f=new Float32Array(texdata.buffer);// Here we convert from a .splat file buffer into a texture\n// With a little bit more foresight perhaps this texture file\n// should have been the native format as it'd be very easy to\n// load it into webgl.\nfor(let i=0;i<vertexCount;i++){// x, y, z\ntexdata_f[8*i+0]=f_buffer[8*i+0];texdata_f[8*i+1]=f_buffer[8*i+1];texdata_f[8*i+2]=f_buffer[8*i+2];// r, g, b, a\ntexdata_c[4*(8*i+7)+0]=u_buffer[32*i+24+0];texdata_c[4*(8*i+7)+1]=u_buffer[32*i+24+1];texdata_c[4*(8*i+7)+2]=u_buffer[32*i+24+2];texdata_c[4*(8*i+7)+3]=u_buffer[32*i+24+3];// quaternions\nlet scale=[f_buffer[8*i+3+0],f_buffer[8*i+3+1],f_buffer[8*i+3+2]];let rot=[(u_buffer[32*i+28+0]-128)/128,(u_buffer[32*i+28+1]-128)/128,(u_buffer[32*i+28+2]-128)/128,(u_buffer[32*i+28+3]-128)/128];// Compute the matrix product of S and R (M = S * R)\nconst M=[1.0-2.0*(rot[2]*rot[2]+rot[3]*rot[3]),2.0*(rot[1]*rot[2]+rot[0]*rot[3]),2.0*(rot[1]*rot[3]-rot[0]*rot[2]),2.0*(rot[1]*rot[2]-rot[0]*rot[3]),1.0-2.0*(rot[1]*rot[1]+rot[3]*rot[3]),2.0*(rot[2]*rot[3]+rot[0]*rot[1]),2.0*(rot[1]*rot[3]+rot[0]*rot[2]),2.0*(rot[2]*rot[3]-rot[0]*rot[1]),1.0-2.0*(rot[1]*rot[1]+rot[2]*rot[2])].map((k,i)=>k*scale[Math.floor(i/3)]);const sigma=[M[0]*M[0]+M[3]*M[3]+M[6]*M[6],M[0]*M[1]+M[3]*M[4]+M[6]*M[7],M[0]*M[2]+M[3]*M[5]+M[6]*M[8],M[1]*M[1]+M[4]*M[4]+M[7]*M[7],M[1]*M[2]+M[4]*M[5]+M[7]*M[8],M[2]*M[2]+M[5]*M[5]+M[8]*M[8]];texdata[8*i+4]=packHalf2x16(4*sigma[0],4*sigma[1]);texdata[8*i+5]=packHalf2x16(4*sigma[2],4*sigma[3]);texdata[8*i+6]=packHalf2x16(4*sigma[4],4*sigma[5]);}self.postMessage({texdata,texwidth,texheight},[texdata.buffer]);}function runSort(viewProj){if(!buffer)return;const f_buffer=new Float32Array(buffer);if(lastVertexCount==vertexCount){let dot=lastProj[2]*viewProj[2]+lastProj[6]*viewProj[6]+lastProj[10]*viewProj[10];if(Math.abs(dot-1)<0.01){return;}}else{generateTexture();lastVertexCount=vertexCount;}// console.time(\"sort\");\nlet maxDepth=-Infinity;let minDepth=Infinity;let sizeList=new Int32Array(vertexCount);for(let i=0;i<vertexCount;i++){let depth=(viewProj[2]*f_buffer[8*i+0]+viewProj[6]*f_buffer[8*i+1]+viewProj[10]*f_buffer[8*i+2])*4096|0;sizeList[i]=depth;if(depth>maxDepth)maxDepth=depth;if(depth<minDepth)minDepth=depth;}// This is a 16 bit single-pass counting sort\nlet depthInv=256*256/(maxDepth-minDepth);let counts0=new Uint32Array(256*256);for(let i=0;i<vertexCount;i++){sizeList[i]=(sizeList[i]-minDepth)*depthInv|0;counts0[sizeList[i]]++;}let starts0=new Uint32Array(256*256);for(let i=1;i<256*256;i++)starts0[i]=starts0[i-1]+counts0[i-1];depthIndex=new Uint32Array(vertexCount);for(let i=0;i<vertexCount;i++)depthIndex[starts0[sizeList[i]]++]=i;// console.timeEnd(\"sort\");\nlastProj=viewProj;self.postMessage({depthIndex,viewProj,vertexCount},[depthIndex.buffer]);}function processPlyBuffer(inputBuffer){const ubuf=new Uint8Array(inputBuffer);// 10KB ought to be enough for a header...\nconst header=new TextDecoder().decode(ubuf.slice(0,1024*10));const header_end=\"end_header\\n\";const header_end_index=header.indexOf(header_end);if(header_end_index<0)throw new Error(\"Unable to read .ply file header\");const vertexCount=parseInt(/element vertex (\\d+)\\n/.exec(header)[1]);console.log(\"Vertex Count\",vertexCount);let row_offset=0,offsets={},types={};const TYPE_MAP={double:\"getFloat64\",int:\"getInt32\",uint:\"getUint32\",float:\"getFloat32\",short:\"getInt16\",ushort:\"getUint16\",uchar:\"getUint8\"};for(let prop of header.slice(0,header_end_index).split(\"\\n\").filter(k=>k.startsWith(\"property \"))){const[p,type,name]=prop.split(\" \");const arrayType=TYPE_MAP[type]||\"getInt8\";types[name]=arrayType;offsets[name]=row_offset;row_offset+=parseInt(arrayType.replace(/[^\\d]/g,\"\"))/8;}console.log(\"Bytes per row\",row_offset,types,offsets);let dataView=new DataView(inputBuffer,header_end_index+header_end.length);let row=0;const attrs=new Proxy({},{get(target,prop){if(!types[prop])throw new Error(prop+\" not found\");return dataView[types[prop]](row*row_offset+offsets[prop],true);}});console.time(\"calculate importance\");let sizeList=new Float32Array(vertexCount);let sizeIndex=new Uint32Array(vertexCount);for(row=0;row<vertexCount;row++){sizeIndex[row]=row;if(!types[\"scale_0\"])continue;const size=Math.exp(attrs.scale_0)*Math.exp(attrs.scale_1)*Math.exp(attrs.scale_2);const opacity=1/(1+Math.exp(-attrs.opacity));sizeList[row]=size*opacity;}console.timeEnd(\"calculate importance\");console.time(\"sort\");sizeIndex.sort((b,a)=>sizeList[a]-sizeList[b]);console.timeEnd(\"sort\");// 6*4 + 4 + 4 = 8*4\n// XYZ - Position (Float32)\n// XYZ - Scale (Float32)\n// RGBA - colors (uint8)\n// IJKL - quaternion/rot (uint8)\nconst rowLength=3*4+3*4+4+4;const buffer=new ArrayBuffer(rowLength*vertexCount);console.time(\"build buffer\");for(let j=0;j<vertexCount;j++){row=sizeIndex[j];const position=new Float32Array(buffer,j*rowLength,3);const scales=new Float32Array(buffer,j*rowLength+4*3,3);const rgba=new Uint8ClampedArray(buffer,j*rowLength+4*3+4*3,4);const rot=new Uint8ClampedArray(buffer,j*rowLength+4*3+4*3+4,4);if(types[\"scale_0\"]){const qlen=Math.sqrt(attrs.rot_0**2+attrs.rot_1**2+attrs.rot_2**2+attrs.rot_3**2);rot[0]=attrs.rot_0/qlen*128+128;rot[1]=attrs.rot_1/qlen*128+128;rot[2]=attrs.rot_2/qlen*128+128;rot[3]=attrs.rot_3/qlen*128+128;scales[0]=Math.exp(attrs.scale_0);scales[1]=Math.exp(attrs.scale_1);scales[2]=Math.exp(attrs.scale_2);}else{scales[0]=0.01;scales[1]=0.01;scales[2]=0.01;rot[0]=255;rot[1]=0;rot[2]=0;rot[3]=0;}position[0]=attrs.x;position[1]=attrs.y;position[2]=attrs.z;if(types[\"f_dc_0\"]){const SH_C0=0.28209479177387814;rgba[0]=(0.5+SH_C0*attrs.f_dc_0)*255;rgba[1]=(0.5+SH_C0*attrs.f_dc_1)*255;rgba[2]=(0.5+SH_C0*attrs.f_dc_2)*255;}else{rgba[0]=attrs.red;rgba[1]=attrs.green;rgba[2]=attrs.blue;}if(types[\"opacity\"]){rgba[3]=1/(1+Math.exp(-attrs.opacity))*255;}else{rgba[3]=255;}}console.timeEnd(\"build buffer\");return buffer;}const throttledSort=()=>{if(!sortRunning){sortRunning=true;let lastView=viewProj;runSort(lastView);setTimeout(()=>{sortRunning=false;if(lastView!==viewProj){throttledSort();}},0);}};let sortRunning;self.onmessage=e=>{if(e.data.ply){vertexCount=0;runSort(viewProj);buffer=processPlyBuffer(e.data.ply);vertexCount=Math.floor(buffer.byteLength/rowLength);postMessage({buffer:buffer});}else if(e.data.buffer){buffer=e.data.buffer;vertexCount=e.data.vertexCount;}else if(e.data.vertexCount){vertexCount=e.data.vertexCount;}else if(e.data.view){viewProj=e.data.view;throttledSort();}};}const vertexShaderSource=\"\\n#version 300 es\\nprecision highp float;\\nprecision highp int;\\n\\nuniform highp usampler2D u_texture;\\nuniform mat4 projection, view;\\nuniform vec2 focal;\\nuniform vec2 viewport;\\n\\nin vec2 position;\\nin int index;\\n\\nout vec4 vColor;\\nout vec2 vPosition;\\n\\nvoid main () {\\n    uvec4 cen = texelFetch(u_texture, ivec2((uint(index) & 0x3ffu) << 1, uint(index) >> 10), 0);\\n    vec4 cam = view * vec4(uintBitsToFloat(cen.xyz), 1);\\n    vec4 pos2d = projection * cam;\\n\\n    float clip = 1.2 * pos2d.w;\\n    if (pos2d.z < -clip || pos2d.x < -clip || pos2d.x > clip || pos2d.y < -clip || pos2d.y > clip) {\\n        gl_Position = vec4(0.0, 0.0, 2.0, 1.0);\\n        return;\\n    }\\n\\n    uvec4 cov = texelFetch(u_texture, ivec2(((uint(index) & 0x3ffu) << 1) | 1u, uint(index) >> 10), 0);\\n    vec2 u1 = unpackHalf2x16(cov.x), u2 = unpackHalf2x16(cov.y), u3 = unpackHalf2x16(cov.z);\\n    mat3 Vrk = mat3(u1.x, u1.y, u2.x, u1.y, u2.y, u3.x, u2.x, u3.x, u3.y);\\n\\n    mat3 J = mat3(\\n        focal.x / cam.z, 0., -(focal.x * cam.x) / (cam.z * cam.z), \\n        0., -focal.y / cam.z, (focal.y * cam.y) / (cam.z * cam.z), \\n        0., 0., 0.\\n    );\\n\\n    mat3 T = transpose(mat3(view)) * J;\\n    mat3 cov2d = transpose(T) * Vrk * T;\\n\\n    float mid = (cov2d[0][0] + cov2d[1][1]) / 2.0;\\n    float radius = length(vec2((cov2d[0][0] - cov2d[1][1]) / 2.0, cov2d[0][1]));\\n    float lambda1 = mid + radius, lambda2 = mid - radius;\\n\\n    if(lambda2 < 0.0) return;\\n    vec2 diagonalVector = normalize(vec2(cov2d[0][1], lambda1 - cov2d[0][0]));\\n    vec2 majorAxis = min(sqrt(2.0 * lambda1), 1024.0) * diagonalVector;\\n    vec2 minorAxis = min(sqrt(2.0 * lambda2), 1024.0) * vec2(diagonalVector.y, -diagonalVector.x);\\n\\n    vColor = clamp(pos2d.z/pos2d.w+1.0, 0.0, 1.0) * vec4((cov.w) & 0xffu, (cov.w >> 8) & 0xffu, (cov.w >> 16) & 0xffu, (cov.w >> 24) & 0xffu) / 255.0;\\n    vPosition = position;\\n\\n    vec2 vCenter = vec2(pos2d) / pos2d.w;\\n    gl_Position = vec4(\\n        vCenter \\n        + position.x * majorAxis / viewport \\n        + position.y * minorAxis / viewport, 0.0, 1.0);\\n\\n}\\n\".trim();const fragmentShaderSource=\"\\n#version 300 es\\nprecision highp float;\\n\\nin vec4 vColor;\\nin vec2 vPosition;\\n\\nout vec4 fragColor;\\n\\nvoid main () {\\n    float A = -dot(vPosition, vPosition);\\n    if (A < -4.0) discard;\\n    float B = exp(A) * vColor.a;\\n    fragColor = vec4(B * vColor.rgb, B);\\n}\\n\\n\".trim();let defaultViewMatrix=[0,0,1,0,0,1,0,0,1,0,0,0,0,0.85,0,1];let viewMatrix=defaultViewMatrix;async function main(source,id){let carousel=true;const params=new URLSearchParams(window.location.search);try{viewMatrix=JSON.parse(decodeURIComponent(window.location.hash.slice(1)));carousel=false;}catch(err){}const url=new URL(source);const req=await fetch(url,{mode:\"cors\",// no-cors, *cors, same-origin\ncredentials:\"omit\"// include, *same-origin, omit\n});console.log(req);if(req.status!=200)throw new Error(req.status+\" Unable to load \"+req.url);const rowLength=3*4+3*4+4+4;const reader=req.body.getReader();let splatData=new Uint8Array(req.headers.get(\"content-length\"));const downsample=splatData.length/rowLength>500000?1:1/devicePixelRatio;console.log(splatData.length/rowLength,downsample);const worker=new Worker(URL.createObjectURL(new Blob([\"(\",createWorker.toString(),\")(self)\"],{type:\"application/javascript\"})));const canvas=document.getElementById(\"canvas\"+id);// const fps = document.getElementById(\"fps\");\n// const camid = document.getElementById(\"camid\");\nlet projectionMatrix;const gl=canvas.getContext(\"webgl2\",{antialias:false});const vertexShader=gl.createShader(gl.VERTEX_SHADER);gl.shaderSource(vertexShader,vertexShaderSource);gl.compileShader(vertexShader);if(!gl.getShaderParameter(vertexShader,gl.COMPILE_STATUS))console.error(gl.getShaderInfoLog(vertexShader));const fragmentShader=gl.createShader(gl.FRAGMENT_SHADER);gl.shaderSource(fragmentShader,fragmentShaderSource);gl.compileShader(fragmentShader);if(!gl.getShaderParameter(fragmentShader,gl.COMPILE_STATUS))console.error(gl.getShaderInfoLog(fragmentShader));const program=gl.createProgram();gl.attachShader(program,vertexShader);gl.attachShader(program,fragmentShader);gl.linkProgram(program);gl.useProgram(program);if(!gl.getProgramParameter(program,gl.LINK_STATUS))console.error(gl.getProgramInfoLog(program));gl.disable(gl.DEPTH_TEST);// Disable depth testing\n// Enable blending\ngl.enable(gl.BLEND);gl.blendFuncSeparate(gl.ONE_MINUS_DST_ALPHA,gl.ONE,gl.ONE_MINUS_DST_ALPHA,gl.ONE);gl.blendEquationSeparate(gl.FUNC_ADD,gl.FUNC_ADD);const u_projection=gl.getUniformLocation(program,\"projection\");const u_viewport=gl.getUniformLocation(program,\"viewport\");const u_focal=gl.getUniformLocation(program,\"focal\");const u_view=gl.getUniformLocation(program,\"view\");// positions\nconst triangleVertices=new Float32Array([-2,-2,2,-2,2,2,-2,2]);const vertexBuffer=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,vertexBuffer);gl.bufferData(gl.ARRAY_BUFFER,triangleVertices,gl.STATIC_DRAW);const a_position=gl.getAttribLocation(program,\"position\");gl.enableVertexAttribArray(a_position);gl.bindBuffer(gl.ARRAY_BUFFER,vertexBuffer);gl.vertexAttribPointer(a_position,2,gl.FLOAT,false,0,0);var texture=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,texture);var u_textureLocation=gl.getUniformLocation(program,\"u_texture\");gl.uniform1i(u_textureLocation,0);const indexBuffer=gl.createBuffer();const a_index=gl.getAttribLocation(program,\"index\");gl.enableVertexAttribArray(a_index);gl.bindBuffer(gl.ARRAY_BUFFER,indexBuffer);gl.vertexAttribIPointer(a_index,1,gl.INT,false,0,0);gl.vertexAttribDivisor(a_index,1);const resize=()=>{gl.uniform2fv(u_focal,new Float32Array([camera.fx,camera.fy]));projectionMatrix=getProjectionMatrix(camera.fx,camera.fy,window.innerWidth,window.innerHeight);gl.uniform2fv(u_viewport,new Float32Array([window.innerWidth,window.innerHeight]));gl.canvas.width=Math.round(window.innerWidth/downsample);gl.canvas.height=Math.round(window.innerHeight/downsample);gl.viewport(0,0,gl.canvas.width,gl.canvas.height);gl.uniformMatrix4fv(u_projection,false,projectionMatrix);};window.addEventListener(\"resize\",resize);resize();worker.onmessage=e=>{if(e.data.buffer){splatData=new Uint8Array(e.data.buffer);const blob=new Blob([splatData.buffer],{type:\"application/octet-stream\"});const link=document.createElement(\"a\");link.download=\"model.splat\";link.href=URL.createObjectURL(blob);document.body.appendChild(link);link.click();}else if(e.data.texdata){const{texdata,texwidth,texheight}=e.data;// console.log(texdata)\ngl.bindTexture(gl.TEXTURE_2D,texture);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA32UI,texwidth,texheight,0,gl.RGBA_INTEGER,gl.UNSIGNED_INT,texdata);gl.activeTexture(gl.TEXTURE0);gl.bindTexture(gl.TEXTURE_2D,texture);}else if(e.data.depthIndex){const{depthIndex,viewProj}=e.data;gl.bindBuffer(gl.ARRAY_BUFFER,indexBuffer);gl.bufferData(gl.ARRAY_BUFFER,depthIndex,gl.DYNAMIC_DRAW);vertexCount=e.data.vertexCount;}};let activeKeys=[];let currentCameraIndex=0;window.addEventListener(\"keydown\",e=>{// if (document.activeElement != document.body) return;\ncarousel=false;if(!activeKeys.includes(e.code))activeKeys.push(e.code);if(/\\d/.test(e.key)){currentCameraIndex=parseInt(e.key);camera=cameras[currentCameraIndex];viewMatrix=getViewMatrix(camera);}if(['-','_'].includes(e.key)){currentCameraIndex=(currentCameraIndex+cameras.length-1)%cameras.length;viewMatrix=getViewMatrix(cameras[currentCameraIndex]);}if(['+','='].includes(e.key)){currentCameraIndex=(currentCameraIndex+1)%cameras.length;viewMatrix=getViewMatrix(cameras[currentCameraIndex]);}// camid.innerText = \"cam  \" + currentCameraIndex;\n// if (e.code == \"KeyV\") {\n//     location.hash =\n//         \"#\" +\n//         JSON.stringify(\n//             viewMatrix.map((k) => Math.round(k * 100) / 100),\n//         );\n//         camid.innerText =\"\"\n// } else if (e.code === \"KeyP\") {\n//     carousel = true;\n//     camid.innerText =\"\"\n// }\n});window.addEventListener(\"keyup\",e=>{activeKeys=activeKeys.filter(k=>k!==e.code);});window.addEventListener(\"blur\",()=>{activeKeys=[];});// window.addEventListener(\n//     \"wheel\",\n//     (e) => {\n//         carousel = false;\n//         e.preventDefault();\n//         const lineHeight = 10;\n//         const scale =\n//             e.deltaMode == 1\n//                 ? lineHeight\n//                 : e.deltaMode == 2\n//                 ? innerHeight\n//                 : 1;\n//         let inv = invert4(viewMatrix);\n//         if (e.shiftKey) {\n//             inv = translate4(\n//                 inv,\n//                 (e.deltaX * scale) / innerWidth,\n//                 (e.deltaY * scale) / innerHeight,\n//                 0,\n//             );\n//         } else if (e.ctrlKey || e.metaKey) {\n//             // inv = rotate4(inv,  (e.deltaX * scale) / innerWidth,  0, 0, 1);\n//             // inv = translate4(inv,  0, (e.deltaY * scale) / innerHeight, 0);\n//             // let preY = inv[13];\n//             inv = translate4(\n//                 inv,\n//                 0,\n//                 0,\n//                 (-10 * (e.deltaY * scale)) / innerHeight,\n//             );\n//             // inv[13] = preY;\n//         } else {\n//             let d = 4;\n//             inv = translate4(inv, 0, 0, d);\n//             inv = rotate4(inv, -(e.deltaX * scale) / innerWidth, 0, 1, 0);\n//             inv = rotate4(inv, (e.deltaY * scale) / innerHeight, 1, 0, 0);\n//             inv = translate4(inv, 0, 0, -d);\n//         }\n//         viewMatrix = invert4(inv);\n//     },\n//     { passive: false },\n// );\nlet startX,startY,down;canvas.addEventListener(\"mousedown\",e=>{carousel=false;e.preventDefault();startX=e.clientX;startY=e.clientY;down=e.ctrlKey||e.metaKey?2:1;});canvas.addEventListener(\"contextmenu\",e=>{carousel=false;e.preventDefault();startX=e.clientX;startY=e.clientY;down=2;});canvas.addEventListener(\"mousemove\",e=>{e.preventDefault();if(down==1){let inv=invert4(viewMatrix);let dx=5*(e.clientX-startX)/window.innerWidth;let dy=5*(e.clientY-startY)/window.innerHeight;let d=4;inv=translate4(inv,0,0,d);inv=rotate4(inv,dx,0,1,0);inv=rotate4(inv,-dy,1,0,0);inv=translate4(inv,0,0,-d);// let postAngle = Math.atan2(inv[0], inv[10])\n// inv = rotate4(inv, postAngle - preAngle, 0, 0, 1)\n// console.log(postAngle)\nviewMatrix=invert4(inv);startX=e.clientX;startY=e.clientY;}else if(down==2){let inv=invert4(viewMatrix);// inv = rotateY(inv, );\n// let preY = inv[13];\ninv=translate4(inv,-10*(e.clientX-startX)/window.innerWidth,0,10*(e.clientY-startY)/window.innerHeight);// inv[13] = preY;\nviewMatrix=invert4(inv);startX=e.clientX;startY=e.clientY;}});canvas.addEventListener(\"mouseup\",e=>{e.preventDefault();down=false;startX=0;startY=0;});let altX=0,altY=0;canvas.addEventListener(\"touchstart\",e=>{e.preventDefault();if(e.touches.length===1){carousel=false;startX=e.touches[0].clientX;startY=e.touches[0].clientY;down=1;}else if(e.touches.length===2){// console.log('beep')\ncarousel=false;startX=e.touches[0].clientX;altX=e.touches[1].clientX;startY=e.touches[0].clientY;altY=e.touches[1].clientY;down=1;}},{passive:false});canvas.addEventListener(\"touchmove\",e=>{e.preventDefault();if(e.touches.length===1&&down){let inv=invert4(viewMatrix);let dx=4*(e.touches[0].clientX-startX)/window.innerWidth;let dy=4*(e.touches[0].clientY-startY)/window.innerHeight;let d=4;inv=translate4(inv,0,0,d);// inv = translate4(inv,  -x, -y, -z);\n// inv = translate4(inv,  x, y, z);\ninv=rotate4(inv,dx,0,1,0);inv=rotate4(inv,-dy,1,0,0);inv=translate4(inv,0,0,-d);viewMatrix=invert4(inv);startX=e.touches[0].clientX;startY=e.touches[0].clientY;}else if(e.touches.length===2){// alert('beep')\nconst dtheta=Math.atan2(startY-altY,startX-altX)-Math.atan2(e.touches[0].clientY-e.touches[1].clientY,e.touches[0].clientX-e.touches[1].clientX);const dscale=Math.hypot(startX-altX,startY-altY)/Math.hypot(e.touches[0].clientX-e.touches[1].clientX,e.touches[0].clientY-e.touches[1].clientY);const dx=(e.touches[0].clientX+e.touches[1].clientX-(startX+altX))/2;const dy=(e.touches[0].clientY+e.touches[1].clientY-(startY+altY))/2;let inv=invert4(viewMatrix);// inv = translate4(inv,  0, 0, d);\ninv=rotate4(inv,dtheta,0,0,1);inv=translate4(inv,-dx/window.innerWidth,-dy/window.innerHeight,0);// let preY = inv[13];\ninv=translate4(inv,0,0,3*(1-dscale));// inv[13] = preY;\nviewMatrix=invert4(inv);startX=e.touches[0].clientX;altX=e.touches[1].clientX;startY=e.touches[0].clientY;altY=e.touches[1].clientY;}},{passive:false});canvas.addEventListener(\"touchend\",e=>{e.preventDefault();down=false;startX=0;startY=0;},{passive:false});let jumpDelta=0;let vertexCount=0;let lastFrame=0;// let avgFps = 0;\nlet start=0;window.addEventListener(\"gamepadconnected\",e=>{const gp=navigator.getGamepads()[e.gamepad.index];console.log(\"Gamepad connected at index \".concat(gp.index,\": \").concat(gp.id,\". It has \").concat(gp.buttons.length,\" buttons and \").concat(gp.axes.length,\" axes.\"));});window.addEventListener(\"gamepaddisconnected\",e=>{console.log(\"Gamepad disconnected\");});let leftGamepadTrigger,rightGamepadTrigger;const frame=now=>{let inv=invert4(viewMatrix);let shiftKey=activeKeys.includes(\"Shift\")||activeKeys.includes(\"ShiftLeft\")||activeKeys.includes(\"ShiftRight\");if(activeKeys.includes(\"ArrowUp\")){if(shiftKey){inv=translate4(inv,0,-0.03,0);}else{inv=translate4(inv,0,0,0.1);}}if(activeKeys.includes(\"ArrowDown\")){if(shiftKey){inv=translate4(inv,0,0.03,0);}else{inv=translate4(inv,0,0,-0.1);}}if(activeKeys.includes(\"ArrowLeft\"))inv=translate4(inv,-0.03,0,0);//\nif(activeKeys.includes(\"ArrowRight\"))inv=translate4(inv,0.03,0,0);// inv = rotate4(inv, 0.01, 0, 1, 0);\nif(activeKeys.includes(\"KeyA\"))inv=rotate4(inv,-0.01,0,1,0);if(activeKeys.includes(\"KeyD\"))inv=rotate4(inv,0.01,0,1,0);if(activeKeys.includes(\"KeyQ\"))inv=rotate4(inv,0.01,0,0,1);if(activeKeys.includes(\"KeyE\"))inv=rotate4(inv,-0.01,0,0,1);if(activeKeys.includes(\"KeyW\"))inv=rotate4(inv,0.005,1,0,0);if(activeKeys.includes(\"KeyS\"))inv=rotate4(inv,-0.005,1,0,0);const gamepads=navigator.getGamepads?navigator.getGamepads():[];let isJumping=activeKeys.includes(\"Space\");for(let gamepad of gamepads){if(!gamepad)continue;const axisThreshold=0.1;// Threshold to detect when the axis is intentionally moved\nconst moveSpeed=0.06;const rotateSpeed=0.02;// Assuming the left stick controls translation (axes 0 and 1)\nif(Math.abs(gamepad.axes[0])>axisThreshold){inv=translate4(inv,moveSpeed*gamepad.axes[0],0,0);carousel=false;}if(Math.abs(gamepad.axes[1])>axisThreshold){inv=translate4(inv,0,0,-moveSpeed*gamepad.axes[1]);carousel=false;}if(gamepad.buttons[12].pressed||gamepad.buttons[13].pressed){inv=translate4(inv,0,-moveSpeed*(gamepad.buttons[12].pressed-gamepad.buttons[13].pressed),0);carousel=false;}if(gamepad.buttons[14].pressed||gamepad.buttons[15].pressed){inv=translate4(inv,-moveSpeed*(gamepad.buttons[14].pressed-gamepad.buttons[15].pressed),0,0);carousel=false;}// Assuming the right stick controls rotation (axes 2 and 3)\nif(Math.abs(gamepad.axes[2])>axisThreshold){inv=rotate4(inv,rotateSpeed*gamepad.axes[2],0,1,0);carousel=false;}if(Math.abs(gamepad.axes[3])>axisThreshold){inv=rotate4(inv,-rotateSpeed*gamepad.axes[3],1,0,0);carousel=false;}let tiltAxis=gamepad.buttons[6].value-gamepad.buttons[7].value;if(Math.abs(tiltAxis)>axisThreshold){inv=rotate4(inv,rotateSpeed*tiltAxis,0,0,1);carousel=false;}if(gamepad.buttons[4].pressed&&!leftGamepadTrigger){camera=cameras[(cameras.indexOf(camera)+1)%cameras.length];inv=invert4(getViewMatrix(camera));carousel=false;}if(gamepad.buttons[5].pressed&&!rightGamepadTrigger){camera=cameras[(cameras.indexOf(camera)+cameras.length-1)%cameras.length];inv=invert4(getViewMatrix(camera));carousel=false;}leftGamepadTrigger=gamepad.buttons[4].pressed;rightGamepadTrigger=gamepad.buttons[5].pressed;if(gamepad.buttons[0].pressed){isJumping=true;carousel=false;}if(gamepad.buttons[3].pressed){carousel=true;}}if([\"KeyJ\",\"KeyK\",\"KeyL\",\"KeyI\"].some(k=>activeKeys.includes(k))){let d=4;inv=translate4(inv,0,0,d);inv=rotate4(inv,activeKeys.includes(\"KeyJ\")?-0.05:activeKeys.includes(\"KeyL\")?0.05:0,0,1,0);inv=rotate4(inv,activeKeys.includes(\"KeyI\")?0.05:activeKeys.includes(\"KeyK\")?-0.05:0,1,0,0);inv=translate4(inv,0,0,-d);}viewMatrix=invert4(inv);if(carousel){let inv=invert4(defaultViewMatrix);const t=(Date.now()-start)/5000;const radius=2.5;const speed=1;const offset_x=0;const offset_z=0;// Calculate position based on orbit\nconst x=radius*Math.cos(speed*t)+offset_x;const z=radius*Math.sin(speed*t)+offset_z;console.log(x,z);// Apply translation\ninv=translate4(inv,x,0,z);// Apply rotation (optional)\nconst cameraDirection=normalize([-x,0,-z]);// Reverse direction\n// Calculate the up vector (assuming y-axis is up)\nconst upVector=[0,1,0];// Calculate the right vector (cross product of direction and up)\nconst rightVector=cross(cameraDirection,upVector);// Calculate the new up vector (cross product of right and direction)\nconst newUpVector=cross(rightVector,cameraDirection);// Create a rotation matrix using the calculated vectors\nconst rotationMatrix=[[rightVector[0],rightVector[1],rightVector[2],0],[newUpVector[0],newUpVector[1],newUpVector[2],0],[cameraDirection[0],cameraDirection[1],cameraDirection[2],0],[0,0,0,1]];// Apply rotation to the transformation matrix\ninv=multiply4(inv,rotationMatrix.flat());// You need a function to multiply matrices  \nviewMatrix=invert4(inv);}let inv2=invert4(viewMatrix);inv2=translate4(inv2,0,-jumpDelta,0);inv2=rotate4(inv2,-0.1*jumpDelta,1,0,0);let actualViewMatrix=invert4(inv2);const viewProj=multiply4(projectionMatrix,actualViewMatrix);worker.postMessage({view:viewProj});// const currentFps = 1000 / (now - lastFrame) || 0;\n// avgFps = avgFps * 0.9 + currentFps * 0.1;\nif(vertexCount>0){document.getElementById(\"spinner\"+id).style.display=\"none\";gl.uniformMatrix4fv(u_view,false,actualViewMatrix);gl.clear(gl.COLOR_BUFFER_BIT);gl.drawArraysInstanced(gl.TRIANGLE_FAN,0,4,vertexCount);}else{gl.clear(gl.COLOR_BUFFER_BIT);document.getElementById(\"spinner\"+id).style.display=\"\";start=Date.now()+2000;}const progress=100*vertexCount/(splatData.length/rowLength);if(progress<100){document.getElementById(\"progress\"+id).style.width=progress+\"%\";}else{document.getElementById(\"progress\"+id).style.display=\"none\";}// fps.innerText = Math.round(avgFps) + \" fps\";\n// if (isNaN(currentCameraIndex)){\n//     camid.innerText = \"\";\n// }\nlastFrame=now;requestAnimationFrame(frame);};frame();const selectFile=file=>{const fr=new FileReader();if(/\\.json$/i.test(file.name)){fr.onload=()=>{cameras=JSON.parse(fr.result);viewMatrix=getViewMatrix(cameras[0]);projectionMatrix=getProjectionMatrix(camera.fx/downsample,camera.fy/downsample,canvas.width,canvas.height);gl.uniformMatrix4fv(u_projection,false,projectionMatrix);console.log(\"Loaded Cameras\");};fr.readAsText(file);}else{stopLoading=true;fr.onload=()=>{splatData=new Uint8Array(fr.result);console.log(\"Loaded\",Math.floor(splatData.length/rowLength));if(splatData[0]==112&&splatData[1]==108&&splatData[2]==121&&splatData[3]==10){// ply file magic header means it should be handled differently\nworker.postMessage({ply:splatData.buffer});}else{worker.postMessage({buffer:splatData.buffer,vertexCount:Math.floor(splatData.length/rowLength)});}};fr.readAsArrayBuffer(file);}};window.addEventListener(\"hashchange\",e=>{try{viewMatrix=JSON.parse(decodeURIComponent(window.location.hash.slice(1)));carousel=false;}catch(err){}});const preventDefault=e=>{e.preventDefault();e.stopPropagation();};document.addEventListener(\"dragenter\",preventDefault);document.addEventListener(\"dragover\",preventDefault);document.addEventListener(\"dragleave\",preventDefault);document.addEventListener(\"drop\",e=>{e.preventDefault();e.stopPropagation();selectFile(e.dataTransfer.files[0]);});let bytesRead=0;let lastVertexCount=-1;let stopLoading=false;while(true){const{done,value}=await reader.read();if(done||stopLoading)break;splatData.set(value,bytesRead);bytesRead+=value.length;if(vertexCount>lastVertexCount){worker.postMessage({buffer:splatData.buffer,vertexCount:Math.floor(bytesRead/rowLength)});lastVertexCount=vertexCount;}}if(!stopLoading)worker.postMessage({buffer:splatData.buffer,vertexCount:Math.floor(bytesRead/rowLength)});}main().catch(err=>{// document.getElementById(\"message\").innerText = err.toString();\n});export default function GaussianViewer(_ref){let{id,source}=_ref;console.log(source);useEffect(()=>{main(source,id);});return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"progress\",id:\"progress\"+id}),/*#__PURE__*/_jsx(\"div\",{className:\"message\",id:\"message\"+id}),/*#__PURE__*/_jsx(\"div\",{className:\"scene\",id:\"spinner\"+id}),/*#__PURE__*/_jsx(\"canvas\",{className:\"canvas\",id:\"canvas\"+id})]});};","map":{"version":3,"names":["React","Component","useEffect","jsx","_jsx","jsxs","_jsxs","cameras","id","img_name","width","height","position","rotation","fy","fx","camera","getProjectionMatrix","znear","zfar","flat","getViewMatrix","R","t","camToWorld","normalize","vec3","length","Math","sqrt","cross","vec3a","vec3b","x","y","z","multiply4","a","b","invert4","b00","b01","b02","b03","b04","b05","b06","b07","b08","b09","b10","b11","det","rotate4","rad","len","hypot","s","sin","c","cos","b12","b20","b21","b22","slice","translate4","createWorker","self","buffer","vertexCount","viewProj","rowLength","lastProj","depthIndex","Uint32Array","lastVertexCount","_floatView","Float32Array","_int32View","Int32Array","floatToHalf","float","f","sign","exp","frac","newExp","packHalf2x16","generateTexture","f_buffer","u_buffer","Uint8Array","texwidth","texheight","ceil","texdata","texdata_c","texdata_f","i","scale","rot","M","map","k","floor","sigma","postMessage","runSort","dot","abs","maxDepth","Infinity","minDepth","sizeList","depth","depthInv","counts0","starts0","processPlyBuffer","inputBuffer","ubuf","header","TextDecoder","decode","header_end","header_end_index","indexOf","Error","parseInt","exec","console","log","row_offset","offsets","types","TYPE_MAP","double","int","uint","short","ushort","uchar","prop","split","filter","startsWith","p","type","name","arrayType","replace","dataView","DataView","row","attrs","Proxy","get","target","time","sizeIndex","size","scale_0","scale_1","scale_2","opacity","timeEnd","sort","ArrayBuffer","j","scales","rgba","Uint8ClampedArray","qlen","rot_0","rot_1","rot_2","rot_3","SH_C0","f_dc_0","f_dc_1","f_dc_2","red","green","blue","throttledSort","sortRunning","lastView","setTimeout","onmessage","e","data","ply","byteLength","view","vertexShaderSource","trim","fragmentShaderSource","defaultViewMatrix","viewMatrix","main","source","carousel","params","URLSearchParams","window","location","search","JSON","parse","decodeURIComponent","hash","err","url","URL","req","fetch","mode","credentials","status","reader","body","getReader","splatData","headers","downsample","devicePixelRatio","worker","Worker","createObjectURL","Blob","toString","canvas","document","getElementById","projectionMatrix","gl","getContext","antialias","vertexShader","createShader","VERTEX_SHADER","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","error","getShaderInfoLog","fragmentShader","FRAGMENT_SHADER","program","createProgram","attachShader","linkProgram","useProgram","getProgramParameter","LINK_STATUS","getProgramInfoLog","disable","DEPTH_TEST","enable","BLEND","blendFuncSeparate","ONE_MINUS_DST_ALPHA","ONE","blendEquationSeparate","FUNC_ADD","u_projection","getUniformLocation","u_viewport","u_focal","u_view","triangleVertices","vertexBuffer","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","STATIC_DRAW","a_position","getAttribLocation","enableVertexAttribArray","vertexAttribPointer","FLOAT","texture","createTexture","bindTexture","TEXTURE_2D","u_textureLocation","uniform1i","indexBuffer","a_index","vertexAttribIPointer","INT","vertexAttribDivisor","resize","uniform2fv","innerWidth","innerHeight","round","viewport","uniformMatrix4fv","addEventListener","blob","link","createElement","download","href","appendChild","click","texParameteri","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","TEXTURE_MIN_FILTER","NEAREST","TEXTURE_MAG_FILTER","texImage2D","RGBA32UI","RGBA_INTEGER","UNSIGNED_INT","activeTexture","TEXTURE0","DYNAMIC_DRAW","activeKeys","currentCameraIndex","includes","code","push","test","key","startX","startY","down","preventDefault","clientX","clientY","ctrlKey","metaKey","inv","dx","dy","d","altX","altY","touches","passive","dtheta","atan2","dscale","jumpDelta","lastFrame","start","gp","navigator","getGamepads","gamepad","index","concat","buttons","axes","leftGamepadTrigger","rightGamepadTrigger","frame","now","shiftKey","gamepads","isJumping","axisThreshold","moveSpeed","rotateSpeed","pressed","tiltAxis","value","some","Date","radius","speed","offset_x","offset_z","cameraDirection","upVector","rightVector","newUpVector","rotationMatrix","inv2","actualViewMatrix","style","display","clear","COLOR_BUFFER_BIT","drawArraysInstanced","TRIANGLE_FAN","progress","requestAnimationFrame","selectFile","file","fr","FileReader","onload","result","readAsText","stopLoading","readAsArrayBuffer","stopPropagation","dataTransfer","files","bytesRead","done","read","set","catch","GaussianViewer","_ref","children","className"],"sources":["/home/luka/Documents/21t/21t_software/CV_website/TechShowCase/src/components/gaussian.js"],"sourcesContent":["import React, {Component, useEffect} from \"react\";\nimport \"./gaussian.css\";\n\nlet cameras = [\n    {\n        id: 0,\n        img_name: \"00001\",\n        width: 1959,\n        height: 1090,\n        position: [\n            -3.0089893469241797, -0.11086489695181866, -3.7527640949141428,\n        ],\n        rotation: [\n            [0.876134201218856, 0.06925962026449776, 0.47706599800804744],\n            [-0.04747421839895102, 0.9972110940209488, -0.057586739349882114],\n            [-0.4797239414934443, 0.027805376500959853, 0.8769787916452908],\n        ],\n        fy: 1164.6601287484507,\n        fx: 1159.5880733038064,\n    },\n    {\n        id: 1,\n        img_name: \"00009\",\n        width: 1959,\n        height: 1090,\n        position: [\n            -2.5199776022057296, -0.09704735754873686, -3.6247725540304545,\n        ],\n        rotation: [\n            [0.9982731285632193, -0.011928707708098955, -0.05751927260507243],\n            [0.0065061360949636325, 0.9955928229282383, -0.09355533724430458],\n            [0.058381769258182864, 0.09301955098900708, 0.9939511719154457],\n        ],\n        fy: 1164.6601287484507,\n        fx: 1159.5880733038064,\n    },\n    {\n        id: 2,\n        img_name: \"00017\",\n        width: 1959,\n        height: 1090,\n        position: [\n            -0.7737533667465242, -0.3364271945329695, -2.9358969417573753,\n        ],\n        rotation: [\n            [0.9998813418672372, 0.013742375651625236, -0.0069605529394208224],\n            [-0.014268370388586709, 0.996512943252834, -0.08220929105659476],\n            [0.00580653013657589, 0.08229885200307129, 0.9965907801935302],\n        ],\n        fy: 1164.6601287484507,\n        fx: 1159.5880733038064,\n    },\n    {\n        id: 3,\n        img_name: \"00025\",\n        width: 1959,\n        height: 1090,\n        position: [\n            1.2198221749590001, -0.2196687861401182, -2.3183162007028453,\n        ],\n        rotation: [\n            [0.9208648867765482, 0.0012010625395201253, 0.389880004297208],\n            [-0.06298204172269357, 0.987319521752825, 0.14571693239364383],\n            [-0.3847611242348369, -0.1587410451475895, 0.9092635249821667],\n        ],\n        fy: 1164.6601287484507,\n        fx: 1159.5880733038064,\n    },\n    {\n        id: 4,\n        img_name: \"00033\",\n        width: 1959,\n        height: 1090,\n        position: [\n            1.742387858893817, -0.13848225198886954, -2.0566370113193146,\n        ],\n        rotation: [\n            [0.24669889292141334, -0.08370189346592856, -0.9654706879349405],\n            [0.11343747891376445, 0.9919082664242816, -0.05700815184573074],\n            [0.9624300466054861, -0.09545671285663988, 0.2541976029815521],\n        ],\n        fy: 1164.6601287484507,\n        fx: 1159.5880733038064,\n    },\n    {\n        id: 5,\n        img_name: \"00041\",\n        width: 1959,\n        height: 1090,\n        position: [\n            3.6567309419223935, -0.16470990600750707, -1.3458085590422042,\n        ],\n        rotation: [\n            [0.2341293058324528, -0.02968330457755884, -0.9717522161434825],\n            [0.10270823606832301, 0.99469554638321, -0.005638106875665722],\n            [0.9667649592295676, -0.09848690996657204, 0.2359360976431732],\n        ],\n        fy: 1164.6601287484507,\n        fx: 1159.5880733038064,\n    },\n    {\n        id: 6,\n        img_name: \"00049\",\n        width: 1959,\n        height: 1090,\n        position: [\n            3.9013554243203497, -0.2597500978038105, -0.8106154188297828,\n        ],\n        rotation: [\n            [0.6717235545638952, -0.015718162115524837, -0.7406351366386528],\n            [0.055627354673906296, 0.9980224478387622, 0.029270992841185218],\n            [0.7387104058127439, -0.060861588786650656, 0.6712695459756353],\n        ],\n        fy: 1164.6601287484507,\n        fx: 1159.5880733038064,\n    },\n    {\n        id: 7,\n        img_name: \"00057\",\n        width: 1959,\n        height: 1090,\n        position: [4.742994605467533, -0.05591660945412069, 0.9500365976084458],\n        rotation: [\n            [-0.17042655709210375, 0.01207080756938, -0.9852964448542146],\n            [0.1165090336695526, 0.9931575292530063, -0.00798543433078162],\n            [0.9784581921120181, -0.1161568667478904, -0.1706667764862097],\n        ],\n        fy: 1164.6601287484507,\n        fx: 1159.5880733038064,\n    },\n    {\n        id: 8,\n        img_name: \"00065\",\n        width: 1959,\n        height: 1090,\n        position: [4.34676307626522, 0.08168160516967145, 1.0876221470355405],\n        rotation: [\n            [-0.003575447631888379, -0.044792503246552894, -0.9989899137764799],\n            [0.10770152645126597, 0.9931680875192705, -0.04491693593046672],\n            [0.9941768441149182, -0.10775333677534978, 0.0012732004866391048],\n        ],\n        fy: 1164.6601287484507,\n        fx: 1159.5880733038064,\n    },\n    {\n        id: 9,\n        img_name: \"00073\",\n        width: 1959,\n        height: 1090,\n        position: [3.264984351114202, 0.078974937336732, 1.0117200284114904],\n        rotation: [\n            [-0.026919994628162257, -0.1565891128261527, -0.9872968974090509],\n            [0.08444552208239385, 0.983768234577625, -0.1583319754069128],\n            [0.9960643893290491, -0.0876350978794554, -0.013259786205163005],\n        ],\n        fy: 1164.6601287484507,\n        fx: 1159.5880733038064,\n    },\n];\n\nlet camera = cameras[0];\n\nfunction getProjectionMatrix(fx, fy, width, height) {\n    const znear = 0.2;\n    const zfar = 200;\n    return [\n        [(2 * fx) / width, 0, 0, 0],\n        [0, -(2 * fy) / height, 0, 0],\n        [0, 0, zfar / (zfar - znear), 1],\n        [0, 0, -(zfar * znear) / (zfar - znear), 0],\n    ].flat();\n}\n\nfunction getViewMatrix(camera) {\n    const R = camera.rotation.flat();\n    const t = camera.position;\n    const camToWorld = [\n        [R[0], R[1], R[2], 0],\n        [R[3], R[4], R[5], 0],\n        [R[6], R[7], R[8], 0],\n        [\n            -t[0] * R[0] - t[1] * R[3] - t[2] * R[6],\n            -t[0] * R[1] - t[1] * R[4] - t[2] * R[7],\n            -t[0] * R[2] - t[1] * R[5] - t[2] * R[8],\n            1,\n        ],\n    ].flat();\n    return camToWorld;\n}\n// function translate4(a, x, y, z) {\n//     return [\n//         ...a.slice(0, 12),\n//         a[0] * x + a[4] * y + a[8] * z + a[12],\n//         a[1] * x + a[5] * y + a[9] * z + a[13],\n//         a[2] * x + a[6] * y + a[10] * z + a[14],\n//         a[3] * x + a[7] * y + a[11] * z + a[15],\n//     ];\n// }\n\nfunction normalize(vec3) {\n    const length = Math.sqrt(vec3[0] * vec3[0] + vec3[1] * vec3[1] + vec3[2] * vec3[2]);\n    if (length === 0) {\n        return [0, 0, 0];\n    }\n    return [vec3[0] / length, vec3[1] / length, vec3[2] / length];\n}\n\nfunction cross(vec3a, vec3b) {\n    const x = vec3a[1] * vec3b[2] - vec3a[2] * vec3b[1];\n    const y = vec3a[2] * vec3b[0] - vec3a[0] * vec3b[2];\n    const z = vec3a[0] * vec3b[1] - vec3a[1] * vec3b[0];\n    return [x, y, z];\n}\n\nfunction multiply4(a, b) {\n    return [\n        b[0] * a[0] + b[1] * a[4] + b[2] * a[8] + b[3] * a[12],\n        b[0] * a[1] + b[1] * a[5] + b[2] * a[9] + b[3] * a[13],\n        b[0] * a[2] + b[1] * a[6] + b[2] * a[10] + b[3] * a[14],\n        b[0] * a[3] + b[1] * a[7] + b[2] * a[11] + b[3] * a[15],\n        b[4] * a[0] + b[5] * a[4] + b[6] * a[8] + b[7] * a[12],\n        b[4] * a[1] + b[5] * a[5] + b[6] * a[9] + b[7] * a[13],\n        b[4] * a[2] + b[5] * a[6] + b[6] * a[10] + b[7] * a[14],\n        b[4] * a[3] + b[5] * a[7] + b[6] * a[11] + b[7] * a[15],\n        b[8] * a[0] + b[9] * a[4] + b[10] * a[8] + b[11] * a[12],\n        b[8] * a[1] + b[9] * a[5] + b[10] * a[9] + b[11] * a[13],\n        b[8] * a[2] + b[9] * a[6] + b[10] * a[10] + b[11] * a[14],\n        b[8] * a[3] + b[9] * a[7] + b[10] * a[11] + b[11] * a[15],\n        b[12] * a[0] + b[13] * a[4] + b[14] * a[8] + b[15] * a[12],\n        b[12] * a[1] + b[13] * a[5] + b[14] * a[9] + b[15] * a[13],\n        b[12] * a[2] + b[13] * a[6] + b[14] * a[10] + b[15] * a[14],\n        b[12] * a[3] + b[13] * a[7] + b[14] * a[11] + b[15] * a[15],\n    ];\n}\n\nfunction invert4(a) {\n    let b00 = a[0] * a[5] - a[1] * a[4];\n    let b01 = a[0] * a[6] - a[2] * a[4];\n    let b02 = a[0] * a[7] - a[3] * a[4];\n    let b03 = a[1] * a[6] - a[2] * a[5];\n    let b04 = a[1] * a[7] - a[3] * a[5];\n    let b05 = a[2] * a[7] - a[3] * a[6];\n    let b06 = a[8] * a[13] - a[9] * a[12];\n    let b07 = a[8] * a[14] - a[10] * a[12];\n    let b08 = a[8] * a[15] - a[11] * a[12];\n    let b09 = a[9] * a[14] - a[10] * a[13];\n    let b10 = a[9] * a[15] - a[11] * a[13];\n    let b11 = a[10] * a[15] - a[11] * a[14];\n    let det =\n        b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n    if (!det) return null;\n    return [\n        (a[5] * b11 - a[6] * b10 + a[7] * b09) / det,\n        (a[2] * b10 - a[1] * b11 - a[3] * b09) / det,\n        (a[13] * b05 - a[14] * b04 + a[15] * b03) / det,\n        (a[10] * b04 - a[9] * b05 - a[11] * b03) / det,\n        (a[6] * b08 - a[4] * b11 - a[7] * b07) / det,\n        (a[0] * b11 - a[2] * b08 + a[3] * b07) / det,\n        (a[14] * b02 - a[12] * b05 - a[15] * b01) / det,\n        (a[8] * b05 - a[10] * b02 + a[11] * b01) / det,\n        (a[4] * b10 - a[5] * b08 + a[7] * b06) / det,\n        (a[1] * b08 - a[0] * b10 - a[3] * b06) / det,\n        (a[12] * b04 - a[13] * b02 + a[15] * b00) / det,\n        (a[9] * b02 - a[8] * b04 - a[11] * b00) / det,\n        (a[5] * b07 - a[4] * b09 - a[6] * b06) / det,\n        (a[0] * b09 - a[1] * b07 + a[2] * b06) / det,\n        (a[13] * b01 - a[12] * b03 - a[14] * b00) / det,\n        (a[8] * b03 - a[9] * b01 + a[10] * b00) / det,\n    ];\n}\n\nfunction rotate4(a, rad, x, y, z) {\n    let len = Math.hypot(x, y, z);\n    x /= len;\n    y /= len;\n    z /= len;\n    let s = Math.sin(rad);\n    let c = Math.cos(rad);\n    let t = 1 - c;\n    let b00 = x * x * t + c;\n    let b01 = y * x * t + z * s;\n    let b02 = z * x * t - y * s;\n    let b10 = x * y * t - z * s;\n    let b11 = y * y * t + c;\n    let b12 = z * y * t + x * s;\n    let b20 = x * z * t + y * s;\n    let b21 = y * z * t - x * s;\n    let b22 = z * z * t + c;\n    return [\n        a[0] * b00 + a[4] * b01 + a[8] * b02,\n        a[1] * b00 + a[5] * b01 + a[9] * b02,\n        a[2] * b00 + a[6] * b01 + a[10] * b02,\n        a[3] * b00 + a[7] * b01 + a[11] * b02,\n        a[0] * b10 + a[4] * b11 + a[8] * b12,\n        a[1] * b10 + a[5] * b11 + a[9] * b12,\n        a[2] * b10 + a[6] * b11 + a[10] * b12,\n        a[3] * b10 + a[7] * b11 + a[11] * b12,\n        a[0] * b20 + a[4] * b21 + a[8] * b22,\n        a[1] * b20 + a[5] * b21 + a[9] * b22,\n        a[2] * b20 + a[6] * b21 + a[10] * b22,\n        a[3] * b20 + a[7] * b21 + a[11] * b22,\n        ...a.slice(12, 16),\n    ];\n}\n\nfunction translate4(a, x, y, z) {\n    return [\n        ...a.slice(0, 12),\n        a[0] * x + a[4] * y + a[8] * z + a[12],\n        a[1] * x + a[5] * y + a[9] * z + a[13],\n        a[2] * x + a[6] * y + a[10] * z + a[14],\n        a[3] * x + a[7] * y + a[11] * z + a[15],\n    ];\n}\n\nfunction createWorker(self) {\n    let buffer;\n    let vertexCount = 0;\n    let viewProj;\n    // 6*4 + 4 + 4 = 8*4\n    // XYZ - Position (Float32)\n    // XYZ - Scale (Float32)\n    // RGBA - colors (uint8)\n    // IJKL - quaternion/rot (uint8)\n    const rowLength = 3 * 4 + 3 * 4 + 4 + 4;\n    let lastProj = [];\n    let depthIndex = new Uint32Array();\n    let lastVertexCount = 0;\n\n    var _floatView = new Float32Array(1);\n    var _int32View = new Int32Array(_floatView.buffer);\n\n    function floatToHalf(float) {\n        _floatView[0] = float;\n        var f = _int32View[0];\n\n        var sign = (f >> 31) & 0x0001;\n        var exp = (f >> 23) & 0x00ff;\n        var frac = f & 0x007fffff;\n\n        var newExp;\n        if (exp == 0) {\n            newExp = 0;\n        } else if (exp < 113) {\n            newExp = 0;\n            frac |= 0x00800000;\n            frac = frac >> (113 - exp);\n            if (frac & 0x01000000) {\n                newExp = 1;\n                frac = 0;\n            }\n        } else if (exp < 142) {\n            newExp = exp - 112;\n        } else {\n            newExp = 31;\n            frac = 0;\n        }\n\n        return (sign << 15) | (newExp << 10) | (frac >> 13);\n    }\n\n    function packHalf2x16(x, y) {\n        return (floatToHalf(x) | (floatToHalf(y) << 16)) >>> 0;\n    }\n\n    function generateTexture() {\n        if (!buffer) return;\n        const f_buffer = new Float32Array(buffer);\n        const u_buffer = new Uint8Array(buffer);\n\n        var texwidth = 1024 * 2; // Set to your desired width\n        var texheight = Math.ceil((2 * vertexCount) / texwidth); // Set to your desired height\n        var texdata = new Uint32Array(texwidth * texheight * 4); // 4 components per pixel (RGBA)\n        var texdata_c = new Uint8Array(texdata.buffer);\n        var texdata_f = new Float32Array(texdata.buffer);\n\n        // Here we convert from a .splat file buffer into a texture\n        // With a little bit more foresight perhaps this texture file\n        // should have been the native format as it'd be very easy to\n        // load it into webgl.\n        for (let i = 0; i < vertexCount; i++) {\n            // x, y, z\n            texdata_f[8 * i + 0] = f_buffer[8 * i + 0];\n            texdata_f[8 * i + 1] = f_buffer[8 * i + 1];\n            texdata_f[8 * i + 2] = f_buffer[8 * i + 2];\n\n            // r, g, b, a\n            texdata_c[4 * (8 * i + 7) + 0] = u_buffer[32 * i + 24 + 0];\n            texdata_c[4 * (8 * i + 7) + 1] = u_buffer[32 * i + 24 + 1];\n            texdata_c[4 * (8 * i + 7) + 2] = u_buffer[32 * i + 24 + 2];\n            texdata_c[4 * (8 * i + 7) + 3] = u_buffer[32 * i + 24 + 3];\n\n            // quaternions\n            let scale = [\n                f_buffer[8 * i + 3 + 0],\n                f_buffer[8 * i + 3 + 1],\n                f_buffer[8 * i + 3 + 2],\n            ];\n            let rot = [\n                (u_buffer[32 * i + 28 + 0] - 128) / 128,\n                (u_buffer[32 * i + 28 + 1] - 128) / 128,\n                (u_buffer[32 * i + 28 + 2] - 128) / 128,\n                (u_buffer[32 * i + 28 + 3] - 128) / 128,\n            ];\n\n            // Compute the matrix product of S and R (M = S * R)\n            const M = [\n                1.0 - 2.0 * (rot[2] * rot[2] + rot[3] * rot[3]),\n                2.0 * (rot[1] * rot[2] + rot[0] * rot[3]),\n                2.0 * (rot[1] * rot[3] - rot[0] * rot[2]),\n\n                2.0 * (rot[1] * rot[2] - rot[0] * rot[3]),\n                1.0 - 2.0 * (rot[1] * rot[1] + rot[3] * rot[3]),\n                2.0 * (rot[2] * rot[3] + rot[0] * rot[1]),\n\n                2.0 * (rot[1] * rot[3] + rot[0] * rot[2]),\n                2.0 * (rot[2] * rot[3] - rot[0] * rot[1]),\n                1.0 - 2.0 * (rot[1] * rot[1] + rot[2] * rot[2]),\n            ].map((k, i) => k * scale[Math.floor(i / 3)]);\n\n            const sigma = [\n                M[0] * M[0] + M[3] * M[3] + M[6] * M[6],\n                M[0] * M[1] + M[3] * M[4] + M[6] * M[7],\n                M[0] * M[2] + M[3] * M[5] + M[6] * M[8],\n                M[1] * M[1] + M[4] * M[4] + M[7] * M[7],\n                M[1] * M[2] + M[4] * M[5] + M[7] * M[8],\n                M[2] * M[2] + M[5] * M[5] + M[8] * M[8],\n            ];\n\n            texdata[8 * i + 4] = packHalf2x16(4 * sigma[0], 4 * sigma[1]);\n            texdata[8 * i + 5] = packHalf2x16(4 * sigma[2], 4 * sigma[3]);\n            texdata[8 * i + 6] = packHalf2x16(4 * sigma[4], 4 * sigma[5]);\n        }\n\n        self.postMessage({ texdata, texwidth, texheight }, [texdata.buffer]);\n    }\n\n    function runSort(viewProj) {\n        if (!buffer) return;\n        const f_buffer = new Float32Array(buffer);\n        if (lastVertexCount == vertexCount) {\n            let dot =\n                lastProj[2] * viewProj[2] +\n                lastProj[6] * viewProj[6] +\n                lastProj[10] * viewProj[10];\n            if (Math.abs(dot - 1) < 0.01) {\n                return;\n            }\n        } else {\n            generateTexture();\n            lastVertexCount = vertexCount;\n        }\n\n        // console.time(\"sort\");\n        let maxDepth = -Infinity;\n        let minDepth = Infinity;\n        let sizeList = new Int32Array(vertexCount);\n        for (let i = 0; i < vertexCount; i++) {\n            let depth =\n                ((viewProj[2] * f_buffer[8 * i + 0] +\n                    viewProj[6] * f_buffer[8 * i + 1] +\n                    viewProj[10] * f_buffer[8 * i + 2]) *\n                    4096) |\n                0;\n            sizeList[i] = depth;\n            if (depth > maxDepth) maxDepth = depth;\n            if (depth < minDepth) minDepth = depth;\n        }\n\n        // This is a 16 bit single-pass counting sort\n        let depthInv = (256 * 256) / (maxDepth - minDepth);\n        let counts0 = new Uint32Array(256 * 256);\n        for (let i = 0; i < vertexCount; i++) {\n            sizeList[i] = ((sizeList[i] - minDepth) * depthInv) | 0;\n            counts0[sizeList[i]]++;\n        }\n        let starts0 = new Uint32Array(256 * 256);\n        for (let i = 1; i < 256 * 256; i++)\n            starts0[i] = starts0[i - 1] + counts0[i - 1];\n        depthIndex = new Uint32Array(vertexCount);\n        for (let i = 0; i < vertexCount; i++)\n            depthIndex[starts0[sizeList[i]]++] = i;\n\n        // console.timeEnd(\"sort\");\n\n        lastProj = viewProj;\n        self.postMessage({ depthIndex, viewProj, vertexCount }, [\n            depthIndex.buffer,\n        ]);\n    }\n\n    function processPlyBuffer(inputBuffer) {\n        const ubuf = new Uint8Array(inputBuffer);\n        // 10KB ought to be enough for a header...\n        const header = new TextDecoder().decode(ubuf.slice(0, 1024 * 10));\n        const header_end = \"end_header\\n\";\n        const header_end_index = header.indexOf(header_end);\n        if (header_end_index < 0)\n            throw new Error(\"Unable to read .ply file header\");\n        const vertexCount = parseInt(/element vertex (\\d+)\\n/.exec(header)[1]);\n        console.log(\"Vertex Count\", vertexCount);\n        let row_offset = 0,\n            offsets = {},\n            types = {};\n        const TYPE_MAP = {\n            double: \"getFloat64\",\n            int: \"getInt32\",\n            uint: \"getUint32\",\n            float: \"getFloat32\",\n            short: \"getInt16\",\n            ushort: \"getUint16\",\n            uchar: \"getUint8\",\n        };\n        for (let prop of header\n            .slice(0, header_end_index)\n            .split(\"\\n\")\n            .filter((k) => k.startsWith(\"property \"))) {\n            const [p, type, name] = prop.split(\" \");\n            const arrayType = TYPE_MAP[type] || \"getInt8\";\n            types[name] = arrayType;\n            offsets[name] = row_offset;\n            row_offset += parseInt(arrayType.replace(/[^\\d]/g, \"\")) / 8;\n        }\n        console.log(\"Bytes per row\", row_offset, types, offsets);\n\n        let dataView = new DataView(\n            inputBuffer,\n            header_end_index + header_end.length,\n        );\n        let row = 0;\n        const attrs = new Proxy(\n            {},\n            {\n                get(target, prop) {\n                    if (!types[prop]) throw new Error(prop + \" not found\");\n                    return dataView[types[prop]](\n                        row * row_offset + offsets[prop],\n                        true,\n                    );\n                },\n            },\n        );\n\n        console.time(\"calculate importance\");\n        let sizeList = new Float32Array(vertexCount);\n        let sizeIndex = new Uint32Array(vertexCount);\n        for (row = 0; row < vertexCount; row++) {\n            sizeIndex[row] = row;\n            if (!types[\"scale_0\"]) continue;\n            const size =\n                Math.exp(attrs.scale_0) *\n                Math.exp(attrs.scale_1) *\n                Math.exp(attrs.scale_2);\n            const opacity = 1 / (1 + Math.exp(-attrs.opacity));\n            sizeList[row] = size * opacity;\n        }\n        console.timeEnd(\"calculate importance\");\n\n        console.time(\"sort\");\n        sizeIndex.sort((b, a) => sizeList[a] - sizeList[b]);\n        console.timeEnd(\"sort\");\n\n        // 6*4 + 4 + 4 = 8*4\n        // XYZ - Position (Float32)\n        // XYZ - Scale (Float32)\n        // RGBA - colors (uint8)\n        // IJKL - quaternion/rot (uint8)\n        const rowLength = 3 * 4 + 3 * 4 + 4 + 4;\n        const buffer = new ArrayBuffer(rowLength * vertexCount);\n\n        console.time(\"build buffer\");\n        for (let j = 0; j < vertexCount; j++) {\n            row = sizeIndex[j];\n\n            const position = new Float32Array(buffer, j * rowLength, 3);\n            const scales = new Float32Array(buffer, j * rowLength + 4 * 3, 3);\n            const rgba = new Uint8ClampedArray(\n                buffer,\n                j * rowLength + 4 * 3 + 4 * 3,\n                4,\n            );\n            const rot = new Uint8ClampedArray(\n                buffer,\n                j * rowLength + 4 * 3 + 4 * 3 + 4,\n                4,\n            );\n\n            if (types[\"scale_0\"]) {\n                const qlen = Math.sqrt(\n                    attrs.rot_0 ** 2 +\n                        attrs.rot_1 ** 2 +\n                        attrs.rot_2 ** 2 +\n                        attrs.rot_3 ** 2,\n                );\n\n                rot[0] = (attrs.rot_0 / qlen) * 128 + 128;\n                rot[1] = (attrs.rot_1 / qlen) * 128 + 128;\n                rot[2] = (attrs.rot_2 / qlen) * 128 + 128;\n                rot[3] = (attrs.rot_3 / qlen) * 128 + 128;\n\n                scales[0] = Math.exp(attrs.scale_0);\n                scales[1] = Math.exp(attrs.scale_1);\n                scales[2] = Math.exp(attrs.scale_2);\n            } else {\n                scales[0] = 0.01;\n                scales[1] = 0.01;\n                scales[2] = 0.01;\n\n                rot[0] = 255;\n                rot[1] = 0;\n                rot[2] = 0;\n                rot[3] = 0;\n            }\n\n            position[0] = attrs.x;\n            position[1] = attrs.y;\n            position[2] = attrs.z;\n\n            if (types[\"f_dc_0\"]) {\n                const SH_C0 = 0.28209479177387814;\n                rgba[0] = (0.5 + SH_C0 * attrs.f_dc_0) * 255;\n                rgba[1] = (0.5 + SH_C0 * attrs.f_dc_1) * 255;\n                rgba[2] = (0.5 + SH_C0 * attrs.f_dc_2) * 255;\n            } else {\n                rgba[0] = attrs.red;\n                rgba[1] = attrs.green;\n                rgba[2] = attrs.blue;\n            }\n            if (types[\"opacity\"]) {\n                rgba[3] = (1 / (1 + Math.exp(-attrs.opacity))) * 255;\n            } else {\n                rgba[3] = 255;\n            }\n        }\n        console.timeEnd(\"build buffer\");\n        return buffer;\n    }\n\n    const throttledSort = () => {\n        if (!sortRunning) {\n            sortRunning = true;\n            let lastView = viewProj;\n            runSort(lastView);\n            setTimeout(() => {\n                sortRunning = false;\n                if (lastView !== viewProj) {\n                    throttledSort();\n                }\n            }, 0);\n        }\n    };\n\n    let sortRunning;\n    self.onmessage = (e) => {\n        if (e.data.ply) {\n            vertexCount = 0;\n            runSort(viewProj);\n            buffer = processPlyBuffer(e.data.ply);\n            vertexCount = Math.floor(buffer.byteLength / rowLength);\n            postMessage({ buffer: buffer });\n        } else if (e.data.buffer) {\n            buffer = e.data.buffer;\n            vertexCount = e.data.vertexCount;\n        } else if (e.data.vertexCount) {\n            vertexCount = e.data.vertexCount;\n        } else if (e.data.view) {\n            viewProj = e.data.view;\n            throttledSort();\n        }\n    };\n}\n\nconst vertexShaderSource = `\n#version 300 es\nprecision highp float;\nprecision highp int;\n\nuniform highp usampler2D u_texture;\nuniform mat4 projection, view;\nuniform vec2 focal;\nuniform vec2 viewport;\n\nin vec2 position;\nin int index;\n\nout vec4 vColor;\nout vec2 vPosition;\n\nvoid main () {\n    uvec4 cen = texelFetch(u_texture, ivec2((uint(index) & 0x3ffu) << 1, uint(index) >> 10), 0);\n    vec4 cam = view * vec4(uintBitsToFloat(cen.xyz), 1);\n    vec4 pos2d = projection * cam;\n\n    float clip = 1.2 * pos2d.w;\n    if (pos2d.z < -clip || pos2d.x < -clip || pos2d.x > clip || pos2d.y < -clip || pos2d.y > clip) {\n        gl_Position = vec4(0.0, 0.0, 2.0, 1.0);\n        return;\n    }\n\n    uvec4 cov = texelFetch(u_texture, ivec2(((uint(index) & 0x3ffu) << 1) | 1u, uint(index) >> 10), 0);\n    vec2 u1 = unpackHalf2x16(cov.x), u2 = unpackHalf2x16(cov.y), u3 = unpackHalf2x16(cov.z);\n    mat3 Vrk = mat3(u1.x, u1.y, u2.x, u1.y, u2.y, u3.x, u2.x, u3.x, u3.y);\n\n    mat3 J = mat3(\n        focal.x / cam.z, 0., -(focal.x * cam.x) / (cam.z * cam.z), \n        0., -focal.y / cam.z, (focal.y * cam.y) / (cam.z * cam.z), \n        0., 0., 0.\n    );\n\n    mat3 T = transpose(mat3(view)) * J;\n    mat3 cov2d = transpose(T) * Vrk * T;\n\n    float mid = (cov2d[0][0] + cov2d[1][1]) / 2.0;\n    float radius = length(vec2((cov2d[0][0] - cov2d[1][1]) / 2.0, cov2d[0][1]));\n    float lambda1 = mid + radius, lambda2 = mid - radius;\n\n    if(lambda2 < 0.0) return;\n    vec2 diagonalVector = normalize(vec2(cov2d[0][1], lambda1 - cov2d[0][0]));\n    vec2 majorAxis = min(sqrt(2.0 * lambda1), 1024.0) * diagonalVector;\n    vec2 minorAxis = min(sqrt(2.0 * lambda2), 1024.0) * vec2(diagonalVector.y, -diagonalVector.x);\n\n    vColor = clamp(pos2d.z/pos2d.w+1.0, 0.0, 1.0) * vec4((cov.w) & 0xffu, (cov.w >> 8) & 0xffu, (cov.w >> 16) & 0xffu, (cov.w >> 24) & 0xffu) / 255.0;\n    vPosition = position;\n\n    vec2 vCenter = vec2(pos2d) / pos2d.w;\n    gl_Position = vec4(\n        vCenter \n        + position.x * majorAxis / viewport \n        + position.y * minorAxis / viewport, 0.0, 1.0);\n\n}\n`.trim();\n\nconst fragmentShaderSource = `\n#version 300 es\nprecision highp float;\n\nin vec4 vColor;\nin vec2 vPosition;\n\nout vec4 fragColor;\n\nvoid main () {\n    float A = -dot(vPosition, vPosition);\n    if (A < -4.0) discard;\n    float B = exp(A) * vColor.a;\n    fragColor = vec4(B * vColor.rgb, B);\n}\n\n`.trim();\n\nlet defaultViewMatrix = [0,0,1,0,0,1,0,0,1,0,0,0,0,0.85,0,1];\n\nlet viewMatrix = defaultViewMatrix;\n\n\nasync function main(source, id) {\n    let carousel = true;\n    const params = new URLSearchParams(window.location.search);\n    try {\n        viewMatrix = JSON.parse(decodeURIComponent(window.location.hash.slice(1)));\n        carousel = false;\n    } catch (err) {}\n    const url = new URL(\n        source\n    );\n    const req = await fetch(url, {\n        mode: \"cors\", // no-cors, *cors, same-origin\n        credentials: \"omit\", // include, *same-origin, omit\n    });\n    console.log(req);\n    if (req.status != 200)\n        throw new Error(req.status + \" Unable to load \" + req.url);\n\n    const rowLength = 3 * 4 + 3 * 4 + 4 + 4;\n    const reader = req.body.getReader();\n    let splatData = new Uint8Array(req.headers.get(\"content-length\"));\n\n    const downsample =\n        splatData.length / rowLength > 500000 ? 1 : 1 / devicePixelRatio;\n    console.log(splatData.length / rowLength, downsample);\n\n    const worker = new Worker(\n        URL.createObjectURL(\n            new Blob([\"(\", createWorker.toString(), \")(self)\"], {\n                type: \"application/javascript\",\n            }),\n        ),\n    );\n\n    const canvas = document.getElementById(\"canvas\"+id);\n    // const fps = document.getElementById(\"fps\");\n    // const camid = document.getElementById(\"camid\");\n\n    let projectionMatrix;\n\n    const gl = canvas.getContext(\"webgl2\", {\n        antialias: false,\n    });\n\n    const vertexShader = gl.createShader(gl.VERTEX_SHADER);\n    gl.shaderSource(vertexShader, vertexShaderSource);\n    gl.compileShader(vertexShader);\n    if (!gl.getShaderParameter(vertexShader, gl.COMPILE_STATUS))\n        console.error(gl.getShaderInfoLog(vertexShader));\n\n    const fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);\n    gl.shaderSource(fragmentShader, fragmentShaderSource);\n    gl.compileShader(fragmentShader);\n    if (!gl.getShaderParameter(fragmentShader, gl.COMPILE_STATUS))\n        console.error(gl.getShaderInfoLog(fragmentShader));\n\n    const program = gl.createProgram();\n    gl.attachShader(program, vertexShader);\n    gl.attachShader(program, fragmentShader);\n    gl.linkProgram(program);\n    gl.useProgram(program);\n\n    if (!gl.getProgramParameter(program, gl.LINK_STATUS))\n        console.error(gl.getProgramInfoLog(program));\n\n    gl.disable(gl.DEPTH_TEST); // Disable depth testing\n\n    // Enable blending\n    gl.enable(gl.BLEND);\n    gl.blendFuncSeparate(\n        gl.ONE_MINUS_DST_ALPHA,\n        gl.ONE,\n        gl.ONE_MINUS_DST_ALPHA,\n        gl.ONE,\n    );\n    gl.blendEquationSeparate(gl.FUNC_ADD, gl.FUNC_ADD);\n\n    const u_projection = gl.getUniformLocation(program, \"projection\");\n    const u_viewport = gl.getUniformLocation(program, \"viewport\");\n    const u_focal = gl.getUniformLocation(program, \"focal\");\n    const u_view = gl.getUniformLocation(program, \"view\");\n\n    // positions\n    const triangleVertices = new Float32Array([-2, -2, 2, -2, 2, 2, -2, 2]);\n    const vertexBuffer = gl.createBuffer();\n    gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer);\n    gl.bufferData(gl.ARRAY_BUFFER, triangleVertices, gl.STATIC_DRAW);\n    const a_position = gl.getAttribLocation(program, \"position\");\n    gl.enableVertexAttribArray(a_position);\n    gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer);\n    gl.vertexAttribPointer(a_position, 2, gl.FLOAT, false, 0, 0);\n\n    var texture = gl.createTexture();\n    gl.bindTexture(gl.TEXTURE_2D, texture);\n\n    var u_textureLocation = gl.getUniformLocation(program, \"u_texture\");\n    gl.uniform1i(u_textureLocation, 0);\n\n    const indexBuffer = gl.createBuffer();\n    const a_index = gl.getAttribLocation(program, \"index\");\n    gl.enableVertexAttribArray(a_index);\n    gl.bindBuffer(gl.ARRAY_BUFFER, indexBuffer);\n    gl.vertexAttribIPointer(a_index, 1, gl.INT, false, 0, 0);\n    gl.vertexAttribDivisor(a_index, 1);\n\n    const resize = () => {\n        gl.uniform2fv(u_focal, new Float32Array([camera.fx, camera.fy]));\n\n        projectionMatrix = getProjectionMatrix(\n            camera.fx,\n            camera.fy,\n            window.innerWidth,\n            window.innerHeight,\n        );\n\n        gl.uniform2fv(u_viewport, new Float32Array([window.innerWidth, window.innerHeight]));\n\n        gl.canvas.width = Math.round(window.innerWidth / downsample);\n        gl.canvas.height = Math.round(window.innerHeight / downsample);\n        gl.viewport(0, 0, gl.canvas.width, gl.canvas.height);\n\n        gl.uniformMatrix4fv(u_projection, false, projectionMatrix);\n    };\n\n    window.addEventListener(\"resize\", resize);\n    resize();\n\n    worker.onmessage = (e) => {\n        if (e.data.buffer) {\n            splatData = new Uint8Array(e.data.buffer);\n            const blob = new Blob([splatData.buffer], {\n                type: \"application/octet-stream\",\n            });\n            const link = document.createElement(\"a\");\n            link.download = \"model.splat\";\n            link.href = URL.createObjectURL(blob);\n            document.body.appendChild(link);\n            link.click();\n        } else if (e.data.texdata) {\n            const { texdata, texwidth, texheight } = e.data;\n            // console.log(texdata)\n            gl.bindTexture(gl.TEXTURE_2D, texture);\n            gl.texParameteri(\n                gl.TEXTURE_2D,\n                gl.TEXTURE_WRAP_S,\n                gl.CLAMP_TO_EDGE,\n            );\n            gl.texParameteri(\n                gl.TEXTURE_2D,\n                gl.TEXTURE_WRAP_T,\n                gl.CLAMP_TO_EDGE,\n            );\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n\n            gl.texImage2D(\n                gl.TEXTURE_2D,\n                0,\n                gl.RGBA32UI,\n                texwidth,\n                texheight,\n                0,\n                gl.RGBA_INTEGER,\n                gl.UNSIGNED_INT,\n                texdata,\n            );\n            gl.activeTexture(gl.TEXTURE0);\n            gl.bindTexture(gl.TEXTURE_2D, texture);\n        } else if (e.data.depthIndex) {\n            const { depthIndex, viewProj } = e.data;\n            gl.bindBuffer(gl.ARRAY_BUFFER, indexBuffer);\n            gl.bufferData(gl.ARRAY_BUFFER, depthIndex, gl.DYNAMIC_DRAW);\n            vertexCount = e.data.vertexCount;\n        }\n    };\n\n    let activeKeys = [];\n\tlet currentCameraIndex = 0;\n\n    window.addEventListener(\"keydown\", (e) => {\n        // if (document.activeElement != document.body) return;\n        carousel = false;\n        if (!activeKeys.includes(e.code)) activeKeys.push(e.code);\n        if (/\\d/.test(e.key)) {\n            currentCameraIndex = parseInt(e.key)\n            camera = cameras[currentCameraIndex];\n            viewMatrix = getViewMatrix(camera);\n        }\n\t\tif (['-', '_'].includes(e.key)){\n\t\t\tcurrentCameraIndex = (currentCameraIndex + cameras.length - 1) % cameras.length;\n\t\t\tviewMatrix = getViewMatrix(cameras[currentCameraIndex]);\n\t\t}\n\t\tif (['+', '='].includes(e.key)){\n\t\t\tcurrentCameraIndex = (currentCameraIndex + 1) % cameras.length;\n\t\t\tviewMatrix = getViewMatrix(cameras[currentCameraIndex]);\n\t\t}\n        // camid.innerText = \"cam  \" + currentCameraIndex;\n        // if (e.code == \"KeyV\") {\n        //     location.hash =\n        //         \"#\" +\n        //         JSON.stringify(\n        //             viewMatrix.map((k) => Math.round(k * 100) / 100),\n        //         );\n        //         camid.innerText =\"\"\n        // } else if (e.code === \"KeyP\") {\n        //     carousel = true;\n        //     camid.innerText =\"\"\n        // }\n    });\n    window.addEventListener(\"keyup\", (e) => {\n        activeKeys = activeKeys.filter((k) => k !== e.code);\n    });\n    window.addEventListener(\"blur\", () => {\n        activeKeys = [];\n    });\n\n    // window.addEventListener(\n    //     \"wheel\",\n    //     (e) => {\n    //         carousel = false;\n    //         e.preventDefault();\n    //         const lineHeight = 10;\n    //         const scale =\n    //             e.deltaMode == 1\n    //                 ? lineHeight\n    //                 : e.deltaMode == 2\n    //                 ? innerHeight\n    //                 : 1;\n    //         let inv = invert4(viewMatrix);\n    //         if (e.shiftKey) {\n    //             inv = translate4(\n    //                 inv,\n    //                 (e.deltaX * scale) / innerWidth,\n    //                 (e.deltaY * scale) / innerHeight,\n    //                 0,\n    //             );\n    //         } else if (e.ctrlKey || e.metaKey) {\n    //             // inv = rotate4(inv,  (e.deltaX * scale) / innerWidth,  0, 0, 1);\n    //             // inv = translate4(inv,  0, (e.deltaY * scale) / innerHeight, 0);\n    //             // let preY = inv[13];\n    //             inv = translate4(\n    //                 inv,\n    //                 0,\n    //                 0,\n    //                 (-10 * (e.deltaY * scale)) / innerHeight,\n    //             );\n    //             // inv[13] = preY;\n    //         } else {\n    //             let d = 4;\n    //             inv = translate4(inv, 0, 0, d);\n    //             inv = rotate4(inv, -(e.deltaX * scale) / innerWidth, 0, 1, 0);\n    //             inv = rotate4(inv, (e.deltaY * scale) / innerHeight, 1, 0, 0);\n    //             inv = translate4(inv, 0, 0, -d);\n    //         }\n\n    //         viewMatrix = invert4(inv);\n    //     },\n    //     { passive: false },\n    // );\n\n    let startX, startY, down;\n    canvas.addEventListener(\"mousedown\", (e) => {\n        carousel = false;\n        e.preventDefault();\n        startX = e.clientX;\n        startY = e.clientY;\n        down = e.ctrlKey || e.metaKey ? 2 : 1;\n    });\n    canvas.addEventListener(\"contextmenu\", (e) => {\n        carousel = false;\n        e.preventDefault();\n        startX = e.clientX;\n        startY = e.clientY;\n        down = 2;\n    });\n\n    canvas.addEventListener(\"mousemove\", (e) => {\n        e.preventDefault();\n        if (down == 1) {\n            let inv = invert4(viewMatrix);\n            let dx = (5 * (e.clientX - startX)) / window.innerWidth;\n            let dy = (5 * (e.clientY - startY)) / window.innerHeight;\n            let d = 4;\n\n            inv = translate4(inv, 0, 0, d);\n            inv = rotate4(inv, dx, 0, 1, 0);\n            inv = rotate4(inv, -dy, 1, 0, 0);\n            inv = translate4(inv, 0, 0, -d);\n            // let postAngle = Math.atan2(inv[0], inv[10])\n            // inv = rotate4(inv, postAngle - preAngle, 0, 0, 1)\n            // console.log(postAngle)\n            viewMatrix = invert4(inv);\n\n            startX = e.clientX;\n            startY = e.clientY;\n        } else if (down == 2) {\n            let inv = invert4(viewMatrix);\n            // inv = rotateY(inv, );\n            // let preY = inv[13];\n            inv = translate4(\n                inv,\n                (-10 * (e.clientX - startX)) / window.innerWidth,\n                0,\n                (10 * (e.clientY - startY)) / window.innerHeight,\n            );\n            // inv[13] = preY;\n            viewMatrix = invert4(inv);\n\n            startX = e.clientX;\n            startY = e.clientY;\n        }\n    });\n    canvas.addEventListener(\"mouseup\", (e) => {\n        e.preventDefault();\n        down = false;\n        startX = 0;\n        startY = 0;\n    });\n\n    let altX = 0,\n        altY = 0;\n    canvas.addEventListener(\n        \"touchstart\",\n        (e) => {\n            e.preventDefault();\n            if (e.touches.length === 1) {\n                carousel = false;\n                startX = e.touches[0].clientX;\n                startY = e.touches[0].clientY;\n                down = 1;\n            } else if (e.touches.length === 2) {\n                // console.log('beep')\n                carousel = false;\n                startX = e.touches[0].clientX;\n                altX = e.touches[1].clientX;\n                startY = e.touches[0].clientY;\n                altY = e.touches[1].clientY;\n                down = 1;\n            }\n        },\n        { passive: false },\n    );\n    canvas.addEventListener(\n        \"touchmove\",\n        (e) => {\n            e.preventDefault();\n            if (e.touches.length === 1 && down) {\n                let inv = invert4(viewMatrix);\n                let dx = (4 * (e.touches[0].clientX - startX)) / window.innerWidth;\n                let dy = (4 * (e.touches[0].clientY - startY)) / window.innerHeight;\n\n                let d = 4;\n                inv = translate4(inv, 0, 0, d);\n                // inv = translate4(inv,  -x, -y, -z);\n                // inv = translate4(inv,  x, y, z);\n                inv = rotate4(inv, dx, 0, 1, 0);\n                inv = rotate4(inv, -dy, 1, 0, 0);\n                inv = translate4(inv, 0, 0, -d);\n\n                viewMatrix = invert4(inv);\n\n                startX = e.touches[0].clientX;\n                startY = e.touches[0].clientY;\n            } else if (e.touches.length === 2) {\n                // alert('beep')\n                const dtheta =\n                    Math.atan2(startY - altY, startX - altX) -\n                    Math.atan2(\n                        e.touches[0].clientY - e.touches[1].clientY,\n                        e.touches[0].clientX - e.touches[1].clientX,\n                    );\n                const dscale =\n                    Math.hypot(startX - altX, startY - altY) /\n                    Math.hypot(\n                        e.touches[0].clientX - e.touches[1].clientX,\n                        e.touches[0].clientY - e.touches[1].clientY,\n                    );\n                const dx =\n                    (e.touches[0].clientX +\n                        e.touches[1].clientX -\n                        (startX + altX)) /\n                    2;\n                const dy =\n                    (e.touches[0].clientY +\n                        e.touches[1].clientY -\n                        (startY + altY)) /\n                    2;\n                let inv = invert4(viewMatrix);\n                // inv = translate4(inv,  0, 0, d);\n                inv = rotate4(inv, dtheta, 0, 0, 1);\n\n                inv = translate4(inv, -dx / window.innerWidth, -dy / window.innerHeight, 0);\n\n                // let preY = inv[13];\n                inv = translate4(inv, 0, 0, 3 * (1 - dscale));\n                // inv[13] = preY;\n\n                viewMatrix = invert4(inv);\n\n                startX = e.touches[0].clientX;\n                altX = e.touches[1].clientX;\n                startY = e.touches[0].clientY;\n                altY = e.touches[1].clientY;\n            }\n        },\n        { passive: false },\n    );\n    canvas.addEventListener(\n        \"touchend\",\n        (e) => {\n            e.preventDefault();\n            down = false;\n            startX = 0;\n            startY = 0;\n        },\n        { passive: false },\n    );\n\n    let jumpDelta = 0;\n    let vertexCount = 0;\n\n    let lastFrame = 0;\n    // let avgFps = 0;\n    let start = 0;\n\n    window.addEventListener(\"gamepadconnected\", (e) => {\n        const gp = navigator.getGamepads()[e.gamepad.index];\n        console.log(\n            `Gamepad connected at index ${gp.index}: ${gp.id}. It has ${gp.buttons.length} buttons and ${gp.axes.length} axes.`,\n        );\n    });\n    window.addEventListener(\"gamepaddisconnected\", (e) => {\n        console.log(\"Gamepad disconnected\");\n    });\n\n    let leftGamepadTrigger, rightGamepadTrigger;\n\n    const frame = (now) => {\n        let inv = invert4(viewMatrix);\n        let shiftKey = activeKeys.includes(\"Shift\") || activeKeys.includes(\"ShiftLeft\") || activeKeys.includes(\"ShiftRight\")\n\n        if (activeKeys.includes(\"ArrowUp\")) {\n            if (shiftKey) {\n                inv = translate4(inv, 0, -0.03, 0);\n            } else {\n                inv = translate4(inv, 0, 0, 0.1);\n            }\n        }\n        if (activeKeys.includes(\"ArrowDown\")) {\n            if (shiftKey) {\n                inv = translate4(inv, 0, 0.03, 0);\n            } else {\n                inv = translate4(inv, 0, 0, -0.1);\n            }\n        }\n        if (activeKeys.includes(\"ArrowLeft\"))\n            inv = translate4(inv, -0.03, 0, 0);\n        //\n        if (activeKeys.includes(\"ArrowRight\"))\n            inv = translate4(inv, 0.03, 0, 0);\n        // inv = rotate4(inv, 0.01, 0, 1, 0);\n        if (activeKeys.includes(\"KeyA\")) inv = rotate4(inv, -0.01, 0, 1, 0);\n        if (activeKeys.includes(\"KeyD\")) inv = rotate4(inv, 0.01, 0, 1, 0);\n        if (activeKeys.includes(\"KeyQ\")) inv = rotate4(inv, 0.01, 0, 0, 1);\n        if (activeKeys.includes(\"KeyE\")) inv = rotate4(inv, -0.01, 0, 0, 1);\n        if (activeKeys.includes(\"KeyW\")) inv = rotate4(inv, 0.005, 1, 0, 0);\n        if (activeKeys.includes(\"KeyS\")) inv = rotate4(inv, -0.005, 1, 0, 0);\n\n        const gamepads = navigator.getGamepads ? navigator.getGamepads() : [];\n        let isJumping = activeKeys.includes(\"Space\");\n        for (let gamepad of gamepads) {\n            if (!gamepad) continue;\n\n            const axisThreshold = 0.1; // Threshold to detect when the axis is intentionally moved\n            const moveSpeed = 0.06;\n            const rotateSpeed = 0.02;\n\n            // Assuming the left stick controls translation (axes 0 and 1)\n            if (Math.abs(gamepad.axes[0]) > axisThreshold) {\n                inv = translate4(inv, moveSpeed * gamepad.axes[0], 0, 0);\n                carousel = false;\n            }\n            if (Math.abs(gamepad.axes[1]) > axisThreshold) {\n                inv = translate4(inv, 0, 0, -moveSpeed * gamepad.axes[1]);\n                carousel = false;\n            }\n            if(gamepad.buttons[12].pressed || gamepad.buttons[13].pressed){\n                inv = translate4(inv, 0, -moveSpeed*(gamepad.buttons[12].pressed - gamepad.buttons[13].pressed), 0);\n                carousel = false;\n            }\n\n            if(gamepad.buttons[14].pressed || gamepad.buttons[15].pressed){\n                inv = translate4(inv, -moveSpeed*(gamepad.buttons[14].pressed - gamepad.buttons[15].pressed), 0, 0);\n                carousel = false;\n            }\n\n            // Assuming the right stick controls rotation (axes 2 and 3)\n            if (Math.abs(gamepad.axes[2]) > axisThreshold) {\n                inv = rotate4(inv, rotateSpeed * gamepad.axes[2], 0, 1, 0);\n                carousel = false;\n            }\n            if (Math.abs(gamepad.axes[3]) > axisThreshold) {\n                inv = rotate4(inv, -rotateSpeed * gamepad.axes[3], 1, 0, 0);\n                carousel = false;\n            }\n\n            let tiltAxis = gamepad.buttons[6].value - gamepad.buttons[7].value;\n            if (Math.abs(tiltAxis) > axisThreshold) {\n                inv = rotate4(inv, rotateSpeed * tiltAxis, 0, 0, 1);\n                carousel = false;\n            }\n            if (gamepad.buttons[4].pressed && !leftGamepadTrigger) {\n                camera = cameras[(cameras.indexOf(camera)+1)%cameras.length]\n                inv = invert4(getViewMatrix(camera));\n                carousel = false;\n            }\n            if (gamepad.buttons[5].pressed && !rightGamepadTrigger) {\n                camera = cameras[(cameras.indexOf(camera)+cameras.length-1)%cameras.length]\n                inv = invert4(getViewMatrix(camera));\n                carousel = false;\n            }\n            leftGamepadTrigger = gamepad.buttons[4].pressed;\n            rightGamepadTrigger = gamepad.buttons[5].pressed;\n            if (gamepad.buttons[0].pressed) {\n                isJumping = true;\n                carousel = false;\n            }\n            if(gamepad.buttons[3].pressed){\n                carousel = true;\n            }\n        }\n\n        if (\n            [\"KeyJ\", \"KeyK\", \"KeyL\", \"KeyI\"].some((k) => activeKeys.includes(k))\n        ) {\n            let d = 4;\n            inv = translate4(inv, 0, 0, d);\n            inv = rotate4(\n                inv,\n                activeKeys.includes(\"KeyJ\")\n                    ? -0.05\n                    : activeKeys.includes(\"KeyL\")\n                    ? 0.05\n                    : 0,\n                0,\n                1,\n                0,\n            );\n            inv = rotate4(\n                inv,\n                activeKeys.includes(\"KeyI\")\n                    ? 0.05\n                    : activeKeys.includes(\"KeyK\")\n                    ? -0.05\n                    : 0,\n                1,\n                0,\n                0,\n            );\n            inv = translate4(inv, 0, 0, -d);\n        }\n\n        viewMatrix = invert4(inv);\n\n        if (carousel) {\n            let inv = invert4(defaultViewMatrix);\n            const t = (Date.now() - start) / 5000;\n            const radius = 2.5;\n            const speed = 1;\n            \n            const offset_x = 0;\n            const offset_z = 0;\n            // Calculate position based on orbit\n            const x = radius * Math.cos(speed * t)+offset_x;\n            const z = radius * Math.sin(speed * t)+offset_z;\n            \n            console.log(x,z);\n            // Apply translation\n            inv = translate4(inv, x, 0, z);\n            \n            // Apply rotation (optional)\n\n            const cameraDirection = normalize([-x, 0, -z]); // Reverse direction\n\n            // Calculate the up vector (assuming y-axis is up)\n            const upVector = [0,1,0];\n            \n            // Calculate the right vector (cross product of direction and up)\n            const rightVector = cross(cameraDirection, upVector);\n            \n            // Calculate the new up vector (cross product of right and direction)\n            const newUpVector = cross(rightVector, cameraDirection);\n            \n            // Create a rotation matrix using the calculated vectors\n            const rotationMatrix = [\n                [rightVector[0], rightVector[1], rightVector[2], 0],\n                [newUpVector[0], newUpVector[1], newUpVector[2], 0],\n                [cameraDirection[0], cameraDirection[1], cameraDirection[2], 0],\n                [0, 0, 0, 1]\n            ];\n            \n            // Apply rotation to the transformation matrix\n            inv = multiply4(inv, rotationMatrix.flat()); // You need a function to multiply matrices  \n            viewMatrix = invert4(inv);\n        }\n\n        let inv2 = invert4(viewMatrix);\n        inv2 = translate4(inv2, 0, -jumpDelta, 0);\n        inv2 = rotate4(inv2, -0.1 * jumpDelta, 1, 0, 0);\n        let actualViewMatrix = invert4(inv2);\n\n        const viewProj = multiply4(projectionMatrix, actualViewMatrix);\n        worker.postMessage({ view: viewProj });\n\n        // const currentFps = 1000 / (now - lastFrame) || 0;\n        // avgFps = avgFps * 0.9 + currentFps * 0.1;\n\n        if (vertexCount > 0) {\n            document.getElementById(\"spinner\"+id).style.display = \"none\";\n            gl.uniformMatrix4fv(u_view, false, actualViewMatrix);\n            gl.clear(gl.COLOR_BUFFER_BIT);\n            gl.drawArraysInstanced(gl.TRIANGLE_FAN, 0, 4, vertexCount);\n        } else {\n            gl.clear(gl.COLOR_BUFFER_BIT);\n            document.getElementById(\"spinner\"+id).style.display = \"\";\n            start = Date.now() + 2000;\n        }\n        const progress = (100 * vertexCount) / (splatData.length / rowLength);\n        if (progress < 100) {\n            document.getElementById(\"progress\"+id).style.width = progress + \"%\";\n        } else {\n            document.getElementById(\"progress\"+id).style.display = \"none\";\n        }\n        // fps.innerText = Math.round(avgFps) + \" fps\";\n        // if (isNaN(currentCameraIndex)){\n        //     camid.innerText = \"\";\n        // }\n        lastFrame = now;\n        requestAnimationFrame(frame);\n    };\n\n    frame();\n\n    const selectFile = (file) => {\n        const fr = new FileReader();\n        if (/\\.json$/i.test(file.name)) {\n            fr.onload = () => {\n                cameras = JSON.parse(fr.result);\n                viewMatrix = getViewMatrix(cameras[0]);\n                projectionMatrix = getProjectionMatrix(\n                    camera.fx / downsample,\n                    camera.fy / downsample,\n                    canvas.width,\n                    canvas.height,\n                );\n                gl.uniformMatrix4fv(u_projection, false, projectionMatrix);\n\n                console.log(\"Loaded Cameras\");\n            };\n            fr.readAsText(file);\n        } else {\n            stopLoading = true;\n            fr.onload = () => {\n                splatData = new Uint8Array(fr.result);\n                console.log(\"Loaded\", Math.floor(splatData.length / rowLength));\n\n                if (\n                    splatData[0] == 112 &&\n                    splatData[1] == 108 &&\n                    splatData[2] == 121 &&\n                    splatData[3] == 10\n                ) {\n                    // ply file magic header means it should be handled differently\n                    worker.postMessage({ ply: splatData.buffer });\n                } else {\n                    worker.postMessage({\n                        buffer: splatData.buffer,\n                        vertexCount: Math.floor(splatData.length / rowLength),\n                    });\n                }\n            };\n            fr.readAsArrayBuffer(file);\n        }\n    };\n\n    window.addEventListener(\"hashchange\", (e) => {\n        try {\n            viewMatrix = JSON.parse(decodeURIComponent(window.location.hash.slice(1)));\n            carousel = false;\n        } catch (err) {}\n    });\n\n    const preventDefault = (e) => {\n        e.preventDefault();\n        e.stopPropagation();\n    };\n    document.addEventListener(\"dragenter\", preventDefault);\n    document.addEventListener(\"dragover\", preventDefault);\n    document.addEventListener(\"dragleave\", preventDefault);\n    document.addEventListener(\"drop\", (e) => {\n        e.preventDefault();\n        e.stopPropagation();\n        selectFile(e.dataTransfer.files[0]);\n    });\n\n    let bytesRead = 0;\n    let lastVertexCount = -1;\n    let stopLoading = false;\n\n    while (true) {\n        const { done, value } = await reader.read();\n        if (done || stopLoading) break;\n\n        splatData.set(value, bytesRead);\n        bytesRead += value.length;\n\n        if (vertexCount > lastVertexCount) {\n            worker.postMessage({\n                buffer: splatData.buffer,\n                vertexCount: Math.floor(bytesRead / rowLength),\n            });\n            lastVertexCount = vertexCount;\n        }\n    }\n    if (!stopLoading)\n        worker.postMessage({\n            buffer: splatData.buffer,\n            vertexCount: Math.floor(bytesRead / rowLength),\n        });\n}\n\nmain().catch((err) => {\n    // document.getElementById(\"message\").innerText = err.toString();\n});\n\n\n\nexport default function GaussianViewer({id, source}){\n    console.log(source)\n\n    useEffect(() => {\n        main(source,id);\n    });\n    return (\n        <div>\n            <div className=\"progress\" id={\"progress\"+id}></div>\n            <div className=\"message\" id={\"message\"+id}></div>\n            <div className=\"scene\" id={\"spinner\"+id}></div>\n            <canvas className=\"canvas\" id={\"canvas\"+id}></canvas>\n        </div>\n    );\n};"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAGC,SAAS,CAAEC,SAAS,KAAO,OAAO,CACjD,MAAO,gBAAgB,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,yBAExB,GAAI,CAAAC,OAAO,CAAG,CACV,CACIC,EAAE,CAAE,CAAC,CACLC,QAAQ,CAAE,OAAO,CACjBC,KAAK,CAAE,IAAI,CACXC,MAAM,CAAE,IAAI,CACZC,QAAQ,CAAE,CACN,CAAC,kBAAkB,CAAE,CAAC,mBAAmB,CAAE,CAAC,kBAAkB,CACjE,CACDC,QAAQ,CAAE,CACN,CAAC,iBAAiB,CAAE,mBAAmB,CAAE,mBAAmB,CAAC,CAC7D,CAAC,CAAC,mBAAmB,CAAE,kBAAkB,CAAE,CAAC,oBAAoB,CAAC,CACjE,CAAC,CAAC,kBAAkB,CAAE,oBAAoB,CAAE,kBAAkB,CAAC,CAClE,CACDC,EAAE,CAAE,kBAAkB,CACtBC,EAAE,CAAE,kBACR,CAAC,CACD,CACIP,EAAE,CAAE,CAAC,CACLC,QAAQ,CAAE,OAAO,CACjBC,KAAK,CAAE,IAAI,CACXC,MAAM,CAAE,IAAI,CACZC,QAAQ,CAAE,CACN,CAAC,kBAAkB,CAAE,CAAC,mBAAmB,CAAE,CAAC,kBAAkB,CACjE,CACDC,QAAQ,CAAE,CACN,CAAC,kBAAkB,CAAE,CAAC,oBAAoB,CAAE,CAAC,mBAAmB,CAAC,CACjE,CAAC,qBAAqB,CAAE,kBAAkB,CAAE,CAAC,mBAAmB,CAAC,CACjE,CAAC,oBAAoB,CAAE,mBAAmB,CAAE,kBAAkB,CAAC,CAClE,CACDC,EAAE,CAAE,kBAAkB,CACtBC,EAAE,CAAE,kBACR,CAAC,CACD,CACIP,EAAE,CAAE,CAAC,CACLC,QAAQ,CAAE,OAAO,CACjBC,KAAK,CAAE,IAAI,CACXC,MAAM,CAAE,IAAI,CACZC,QAAQ,CAAE,CACN,CAAC,kBAAkB,CAAE,CAAC,kBAAkB,CAAE,CAAC,kBAAkB,CAChE,CACDC,QAAQ,CAAE,CACN,CAAC,kBAAkB,CAAE,oBAAoB,CAAE,CAAC,qBAAqB,CAAC,CAClE,CAAC,CAAC,oBAAoB,CAAE,iBAAiB,CAAE,CAAC,mBAAmB,CAAC,CAChE,CAAC,mBAAmB,CAAE,mBAAmB,CAAE,kBAAkB,CAAC,CACjE,CACDC,EAAE,CAAE,kBAAkB,CACtBC,EAAE,CAAE,kBACR,CAAC,CACD,CACIP,EAAE,CAAE,CAAC,CACLC,QAAQ,CAAE,OAAO,CACjBC,KAAK,CAAE,IAAI,CACXC,MAAM,CAAE,IAAI,CACZC,QAAQ,CAAE,CACN,kBAAkB,CAAE,CAAC,kBAAkB,CAAE,CAAC,kBAAkB,CAC/D,CACDC,QAAQ,CAAE,CACN,CAAC,kBAAkB,CAAE,qBAAqB,CAAE,iBAAiB,CAAC,CAC9D,CAAC,CAAC,mBAAmB,CAAE,iBAAiB,CAAE,mBAAmB,CAAC,CAC9D,CAAC,CAAC,kBAAkB,CAAE,CAAC,kBAAkB,CAAE,kBAAkB,CAAC,CACjE,CACDC,EAAE,CAAE,kBAAkB,CACtBC,EAAE,CAAE,kBACR,CAAC,CACD,CACIP,EAAE,CAAE,CAAC,CACLC,QAAQ,CAAE,OAAO,CACjBC,KAAK,CAAE,IAAI,CACXC,MAAM,CAAE,IAAI,CACZC,QAAQ,CAAE,CACN,iBAAiB,CAAE,CAAC,mBAAmB,CAAE,CAAC,kBAAkB,CAC/D,CACDC,QAAQ,CAAE,CACN,CAAC,mBAAmB,CAAE,CAAC,mBAAmB,CAAE,CAAC,kBAAkB,CAAC,CAChE,CAAC,mBAAmB,CAAE,kBAAkB,CAAE,CAAC,mBAAmB,CAAC,CAC/D,CAAC,kBAAkB,CAAE,CAAC,mBAAmB,CAAE,kBAAkB,CAAC,CACjE,CACDC,EAAE,CAAE,kBAAkB,CACtBC,EAAE,CAAE,kBACR,CAAC,CACD,CACIP,EAAE,CAAE,CAAC,CACLC,QAAQ,CAAE,OAAO,CACjBC,KAAK,CAAE,IAAI,CACXC,MAAM,CAAE,IAAI,CACZC,QAAQ,CAAE,CACN,kBAAkB,CAAE,CAAC,mBAAmB,CAAE,CAAC,kBAAkB,CAChE,CACDC,QAAQ,CAAE,CACN,CAAC,kBAAkB,CAAE,CAAC,mBAAmB,CAAE,CAAC,kBAAkB,CAAC,CAC/D,CAAC,mBAAmB,CAAE,gBAAgB,CAAE,CAAC,oBAAoB,CAAC,CAC9D,CAAC,kBAAkB,CAAE,CAAC,mBAAmB,CAAE,kBAAkB,CAAC,CACjE,CACDC,EAAE,CAAE,kBAAkB,CACtBC,EAAE,CAAE,kBACR,CAAC,CACD,CACIP,EAAE,CAAE,CAAC,CACLC,QAAQ,CAAE,OAAO,CACjBC,KAAK,CAAE,IAAI,CACXC,MAAM,CAAE,IAAI,CACZC,QAAQ,CAAE,CACN,kBAAkB,CAAE,CAAC,kBAAkB,CAAE,CAAC,kBAAkB,CAC/D,CACDC,QAAQ,CAAE,CACN,CAAC,kBAAkB,CAAE,CAAC,oBAAoB,CAAE,CAAC,kBAAkB,CAAC,CAChE,CAAC,oBAAoB,CAAE,kBAAkB,CAAE,oBAAoB,CAAC,CAChE,CAAC,kBAAkB,CAAE,CAAC,oBAAoB,CAAE,kBAAkB,CAAC,CAClE,CACDC,EAAE,CAAE,kBAAkB,CACtBC,EAAE,CAAE,kBACR,CAAC,CACD,CACIP,EAAE,CAAE,CAAC,CACLC,QAAQ,CAAE,OAAO,CACjBC,KAAK,CAAE,IAAI,CACXC,MAAM,CAAE,IAAI,CACZC,QAAQ,CAAE,CAAC,iBAAiB,CAAE,CAAC,mBAAmB,CAAE,kBAAkB,CAAC,CACvEC,QAAQ,CAAE,CACN,CAAC,CAAC,mBAAmB,CAAE,gBAAgB,CAAE,CAAC,kBAAkB,CAAC,CAC7D,CAAC,kBAAkB,CAAE,kBAAkB,CAAE,CAAC,mBAAmB,CAAC,CAC9D,CAAC,kBAAkB,CAAE,CAAC,kBAAkB,CAAE,CAAC,kBAAkB,CAAC,CACjE,CACDC,EAAE,CAAE,kBAAkB,CACtBC,EAAE,CAAE,kBACR,CAAC,CACD,CACIP,EAAE,CAAE,CAAC,CACLC,QAAQ,CAAE,OAAO,CACjBC,KAAK,CAAE,IAAI,CACXC,MAAM,CAAE,IAAI,CACZC,QAAQ,CAAE,CAAC,gBAAgB,CAAE,mBAAmB,CAAE,kBAAkB,CAAC,CACrEC,QAAQ,CAAE,CACN,CAAC,CAAC,oBAAoB,CAAE,CAAC,oBAAoB,CAAE,CAAC,kBAAkB,CAAC,CACnE,CAAC,mBAAmB,CAAE,kBAAkB,CAAE,CAAC,mBAAmB,CAAC,CAC/D,CAAC,kBAAkB,CAAE,CAAC,mBAAmB,CAAE,qBAAqB,CAAC,CACpE,CACDC,EAAE,CAAE,kBAAkB,CACtBC,EAAE,CAAE,kBACR,CAAC,CACD,CACIP,EAAE,CAAE,CAAC,CACLC,QAAQ,CAAE,OAAO,CACjBC,KAAK,CAAE,IAAI,CACXC,MAAM,CAAE,IAAI,CACZC,QAAQ,CAAE,CAAC,iBAAiB,CAAE,iBAAiB,CAAE,kBAAkB,CAAC,CACpEC,QAAQ,CAAE,CACN,CAAC,CAAC,oBAAoB,CAAE,CAAC,kBAAkB,CAAE,CAAC,kBAAkB,CAAC,CACjE,CAAC,mBAAmB,CAAE,iBAAiB,CAAE,CAAC,kBAAkB,CAAC,CAC7D,CAAC,kBAAkB,CAAE,CAAC,kBAAkB,CAAE,CAAC,oBAAoB,CAAC,CACnE,CACDC,EAAE,CAAE,kBAAkB,CACtBC,EAAE,CAAE,kBACR,CAAC,CACJ,CAED,GAAI,CAAAC,MAAM,CAAGT,OAAO,CAAC,CAAC,CAAC,CAEvB,QAAS,CAAAU,mBAAmBA,CAACF,EAAE,CAAED,EAAE,CAAEJ,KAAK,CAAEC,MAAM,CAAE,CAChD,KAAM,CAAAO,KAAK,CAAG,GAAG,CACjB,KAAM,CAAAC,IAAI,CAAG,GAAG,CAChB,MAAO,CACH,CAAE,CAAC,CAAGJ,EAAE,CAAIL,KAAK,CAAE,CAAC,CAAE,CAAC,CAAE,CAAC,CAAC,CAC3B,CAAC,CAAC,CAAE,EAAE,CAAC,CAAGI,EAAE,CAAC,CAAGH,MAAM,CAAE,CAAC,CAAE,CAAC,CAAC,CAC7B,CAAC,CAAC,CAAE,CAAC,CAAEQ,IAAI,EAAIA,IAAI,CAAGD,KAAK,CAAC,CAAE,CAAC,CAAC,CAChC,CAAC,CAAC,CAAE,CAAC,CAAE,EAAEC,IAAI,CAAGD,KAAK,CAAC,EAAIC,IAAI,CAAGD,KAAK,CAAC,CAAE,CAAC,CAAC,CAC9C,CAACE,IAAI,CAAC,CAAC,CACZ,CAEA,QAAS,CAAAC,aAAaA,CAACL,MAAM,CAAE,CAC3B,KAAM,CAAAM,CAAC,CAAGN,MAAM,CAACH,QAAQ,CAACO,IAAI,CAAC,CAAC,CAChC,KAAM,CAAAG,CAAC,CAAGP,MAAM,CAACJ,QAAQ,CACzB,KAAM,CAAAY,UAAU,CAAG,CACf,CAACF,CAAC,CAAC,CAAC,CAAC,CAAEA,CAAC,CAAC,CAAC,CAAC,CAAEA,CAAC,CAAC,CAAC,CAAC,CAAE,CAAC,CAAC,CACrB,CAACA,CAAC,CAAC,CAAC,CAAC,CAAEA,CAAC,CAAC,CAAC,CAAC,CAAEA,CAAC,CAAC,CAAC,CAAC,CAAE,CAAC,CAAC,CACrB,CAACA,CAAC,CAAC,CAAC,CAAC,CAAEA,CAAC,CAAC,CAAC,CAAC,CAAEA,CAAC,CAAC,CAAC,CAAC,CAAE,CAAC,CAAC,CACrB,CACI,CAACC,CAAC,CAAC,CAAC,CAAC,CAAGD,CAAC,CAAC,CAAC,CAAC,CAAGC,CAAC,CAAC,CAAC,CAAC,CAAGD,CAAC,CAAC,CAAC,CAAC,CAAGC,CAAC,CAAC,CAAC,CAAC,CAAGD,CAAC,CAAC,CAAC,CAAC,CACxC,CAACC,CAAC,CAAC,CAAC,CAAC,CAAGD,CAAC,CAAC,CAAC,CAAC,CAAGC,CAAC,CAAC,CAAC,CAAC,CAAGD,CAAC,CAAC,CAAC,CAAC,CAAGC,CAAC,CAAC,CAAC,CAAC,CAAGD,CAAC,CAAC,CAAC,CAAC,CACxC,CAACC,CAAC,CAAC,CAAC,CAAC,CAAGD,CAAC,CAAC,CAAC,CAAC,CAAGC,CAAC,CAAC,CAAC,CAAC,CAAGD,CAAC,CAAC,CAAC,CAAC,CAAGC,CAAC,CAAC,CAAC,CAAC,CAAGD,CAAC,CAAC,CAAC,CAAC,CACxC,CAAC,CACJ,CACJ,CAACF,IAAI,CAAC,CAAC,CACR,MAAO,CAAAI,UAAU,CACrB,CACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA,QAAS,CAAAC,SAASA,CAACC,IAAI,CAAE,CACrB,KAAM,CAAAC,MAAM,CAAGC,IAAI,CAACC,IAAI,CAACH,IAAI,CAAC,CAAC,CAAC,CAAGA,IAAI,CAAC,CAAC,CAAC,CAAGA,IAAI,CAAC,CAAC,CAAC,CAAGA,IAAI,CAAC,CAAC,CAAC,CAAGA,IAAI,CAAC,CAAC,CAAC,CAAGA,IAAI,CAAC,CAAC,CAAC,CAAC,CACnF,GAAIC,MAAM,GAAK,CAAC,CAAE,CACd,MAAO,CAAC,CAAC,CAAE,CAAC,CAAE,CAAC,CAAC,CACpB,CACA,MAAO,CAACD,IAAI,CAAC,CAAC,CAAC,CAAGC,MAAM,CAAED,IAAI,CAAC,CAAC,CAAC,CAAGC,MAAM,CAAED,IAAI,CAAC,CAAC,CAAC,CAAGC,MAAM,CAAC,CACjE,CAEA,QAAS,CAAAG,KAAKA,CAACC,KAAK,CAAEC,KAAK,CAAE,CACzB,KAAM,CAAAC,CAAC,CAAGF,KAAK,CAAC,CAAC,CAAC,CAAGC,KAAK,CAAC,CAAC,CAAC,CAAGD,KAAK,CAAC,CAAC,CAAC,CAAGC,KAAK,CAAC,CAAC,CAAC,CACnD,KAAM,CAAAE,CAAC,CAAGH,KAAK,CAAC,CAAC,CAAC,CAAGC,KAAK,CAAC,CAAC,CAAC,CAAGD,KAAK,CAAC,CAAC,CAAC,CAAGC,KAAK,CAAC,CAAC,CAAC,CACnD,KAAM,CAAAG,CAAC,CAAGJ,KAAK,CAAC,CAAC,CAAC,CAAGC,KAAK,CAAC,CAAC,CAAC,CAAGD,KAAK,CAAC,CAAC,CAAC,CAAGC,KAAK,CAAC,CAAC,CAAC,CACnD,MAAO,CAACC,CAAC,CAAEC,CAAC,CAAEC,CAAC,CAAC,CACpB,CAEA,QAAS,CAAAC,SAASA,CAACC,CAAC,CAAEC,CAAC,CAAE,CACrB,MAAO,CACHA,CAAC,CAAC,CAAC,CAAC,CAAGD,CAAC,CAAC,CAAC,CAAC,CAAGC,CAAC,CAAC,CAAC,CAAC,CAAGD,CAAC,CAAC,CAAC,CAAC,CAAGC,CAAC,CAAC,CAAC,CAAC,CAAGD,CAAC,CAAC,CAAC,CAAC,CAAGC,CAAC,CAAC,CAAC,CAAC,CAAGD,CAAC,CAAC,EAAE,CAAC,CACtDC,CAAC,CAAC,CAAC,CAAC,CAAGD,CAAC,CAAC,CAAC,CAAC,CAAGC,CAAC,CAAC,CAAC,CAAC,CAAGD,CAAC,CAAC,CAAC,CAAC,CAAGC,CAAC,CAAC,CAAC,CAAC,CAAGD,CAAC,CAAC,CAAC,CAAC,CAAGC,CAAC,CAAC,CAAC,CAAC,CAAGD,CAAC,CAAC,EAAE,CAAC,CACtDC,CAAC,CAAC,CAAC,CAAC,CAAGD,CAAC,CAAC,CAAC,CAAC,CAAGC,CAAC,CAAC,CAAC,CAAC,CAAGD,CAAC,CAAC,CAAC,CAAC,CAAGC,CAAC,CAAC,CAAC,CAAC,CAAGD,CAAC,CAAC,EAAE,CAAC,CAAGC,CAAC,CAAC,CAAC,CAAC,CAAGD,CAAC,CAAC,EAAE,CAAC,CACvDC,CAAC,CAAC,CAAC,CAAC,CAAGD,CAAC,CAAC,CAAC,CAAC,CAAGC,CAAC,CAAC,CAAC,CAAC,CAAGD,CAAC,CAAC,CAAC,CAAC,CAAGC,CAAC,CAAC,CAAC,CAAC,CAAGD,CAAC,CAAC,EAAE,CAAC,CAAGC,CAAC,CAAC,CAAC,CAAC,CAAGD,CAAC,CAAC,EAAE,CAAC,CACvDC,CAAC,CAAC,CAAC,CAAC,CAAGD,CAAC,CAAC,CAAC,CAAC,CAAGC,CAAC,CAAC,CAAC,CAAC,CAAGD,CAAC,CAAC,CAAC,CAAC,CAAGC,CAAC,CAAC,CAAC,CAAC,CAAGD,CAAC,CAAC,CAAC,CAAC,CAAGC,CAAC,CAAC,CAAC,CAAC,CAAGD,CAAC,CAAC,EAAE,CAAC,CACtDC,CAAC,CAAC,CAAC,CAAC,CAAGD,CAAC,CAAC,CAAC,CAAC,CAAGC,CAAC,CAAC,CAAC,CAAC,CAAGD,CAAC,CAAC,CAAC,CAAC,CAAGC,CAAC,CAAC,CAAC,CAAC,CAAGD,CAAC,CAAC,CAAC,CAAC,CAAGC,CAAC,CAAC,CAAC,CAAC,CAAGD,CAAC,CAAC,EAAE,CAAC,CACtDC,CAAC,CAAC,CAAC,CAAC,CAAGD,CAAC,CAAC,CAAC,CAAC,CAAGC,CAAC,CAAC,CAAC,CAAC,CAAGD,CAAC,CAAC,CAAC,CAAC,CAAGC,CAAC,CAAC,CAAC,CAAC,CAAGD,CAAC,CAAC,EAAE,CAAC,CAAGC,CAAC,CAAC,CAAC,CAAC,CAAGD,CAAC,CAAC,EAAE,CAAC,CACvDC,CAAC,CAAC,CAAC,CAAC,CAAGD,CAAC,CAAC,CAAC,CAAC,CAAGC,CAAC,CAAC,CAAC,CAAC,CAAGD,CAAC,CAAC,CAAC,CAAC,CAAGC,CAAC,CAAC,CAAC,CAAC,CAAGD,CAAC,CAAC,EAAE,CAAC,CAAGC,CAAC,CAAC,CAAC,CAAC,CAAGD,CAAC,CAAC,EAAE,CAAC,CACvDC,CAAC,CAAC,CAAC,CAAC,CAAGD,CAAC,CAAC,CAAC,CAAC,CAAGC,CAAC,CAAC,CAAC,CAAC,CAAGD,CAAC,CAAC,CAAC,CAAC,CAAGC,CAAC,CAAC,EAAE,CAAC,CAAGD,CAAC,CAAC,CAAC,CAAC,CAAGC,CAAC,CAAC,EAAE,CAAC,CAAGD,CAAC,CAAC,EAAE,CAAC,CACxDC,CAAC,CAAC,CAAC,CAAC,CAAGD,CAAC,CAAC,CAAC,CAAC,CAAGC,CAAC,CAAC,CAAC,CAAC,CAAGD,CAAC,CAAC,CAAC,CAAC,CAAGC,CAAC,CAAC,EAAE,CAAC,CAAGD,CAAC,CAAC,CAAC,CAAC,CAAGC,CAAC,CAAC,EAAE,CAAC,CAAGD,CAAC,CAAC,EAAE,CAAC,CACxDC,CAAC,CAAC,CAAC,CAAC,CAAGD,CAAC,CAAC,CAAC,CAAC,CAAGC,CAAC,CAAC,CAAC,CAAC,CAAGD,CAAC,CAAC,CAAC,CAAC,CAAGC,CAAC,CAAC,EAAE,CAAC,CAAGD,CAAC,CAAC,EAAE,CAAC,CAAGC,CAAC,CAAC,EAAE,CAAC,CAAGD,CAAC,CAAC,EAAE,CAAC,CACzDC,CAAC,CAAC,CAAC,CAAC,CAAGD,CAAC,CAAC,CAAC,CAAC,CAAGC,CAAC,CAAC,CAAC,CAAC,CAAGD,CAAC,CAAC,CAAC,CAAC,CAAGC,CAAC,CAAC,EAAE,CAAC,CAAGD,CAAC,CAAC,EAAE,CAAC,CAAGC,CAAC,CAAC,EAAE,CAAC,CAAGD,CAAC,CAAC,EAAE,CAAC,CACzDC,CAAC,CAAC,EAAE,CAAC,CAAGD,CAAC,CAAC,CAAC,CAAC,CAAGC,CAAC,CAAC,EAAE,CAAC,CAAGD,CAAC,CAAC,CAAC,CAAC,CAAGC,CAAC,CAAC,EAAE,CAAC,CAAGD,CAAC,CAAC,CAAC,CAAC,CAAGC,CAAC,CAAC,EAAE,CAAC,CAAGD,CAAC,CAAC,EAAE,CAAC,CAC1DC,CAAC,CAAC,EAAE,CAAC,CAAGD,CAAC,CAAC,CAAC,CAAC,CAAGC,CAAC,CAAC,EAAE,CAAC,CAAGD,CAAC,CAAC,CAAC,CAAC,CAAGC,CAAC,CAAC,EAAE,CAAC,CAAGD,CAAC,CAAC,CAAC,CAAC,CAAGC,CAAC,CAAC,EAAE,CAAC,CAAGD,CAAC,CAAC,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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}