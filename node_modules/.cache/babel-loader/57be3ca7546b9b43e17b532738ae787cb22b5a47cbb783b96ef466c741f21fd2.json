{"ast":null,"code":"var _jsxFileName = \"/home/luka/Documents/21t/21t_software/CV_website/cv-website/src/components/gaussian.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { Component, useEffect } from \"react\";\nimport \"./gaussian.css\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nlet cameras = [{\n  id: 0,\n  img_name: \"00001\",\n  width: 1959,\n  height: 1090,\n  position: [-3.0089893469241797, -0.11086489695181866, -3.7527640949141428],\n  rotation: [[0.876134201218856, 0.06925962026449776, 0.47706599800804744], [-0.04747421839895102, 0.9972110940209488, -0.057586739349882114], [-0.4797239414934443, 0.027805376500959853, 0.8769787916452908]],\n  fy: 1164.6601287484507,\n  fx: 1159.5880733038064\n}, {\n  id: 1,\n  img_name: \"00009\",\n  width: 1959,\n  height: 1090,\n  position: [-2.5199776022057296, -0.09704735754873686, -3.6247725540304545],\n  rotation: [[0.9982731285632193, -0.011928707708098955, -0.05751927260507243], [0.0065061360949636325, 0.9955928229282383, -0.09355533724430458], [0.058381769258182864, 0.09301955098900708, 0.9939511719154457]],\n  fy: 1164.6601287484507,\n  fx: 1159.5880733038064\n}, {\n  id: 2,\n  img_name: \"00017\",\n  width: 1959,\n  height: 1090,\n  position: [-0.7737533667465242, -0.3364271945329695, -2.9358969417573753],\n  rotation: [[0.9998813418672372, 0.013742375651625236, -0.0069605529394208224], [-0.014268370388586709, 0.996512943252834, -0.08220929105659476], [0.00580653013657589, 0.08229885200307129, 0.9965907801935302]],\n  fy: 1164.6601287484507,\n  fx: 1159.5880733038064\n}, {\n  id: 3,\n  img_name: \"00025\",\n  width: 1959,\n  height: 1090,\n  position: [1.2198221749590001, -0.2196687861401182, -2.3183162007028453],\n  rotation: [[0.9208648867765482, 0.0012010625395201253, 0.389880004297208], [-0.06298204172269357, 0.987319521752825, 0.14571693239364383], [-0.3847611242348369, -0.1587410451475895, 0.9092635249821667]],\n  fy: 1164.6601287484507,\n  fx: 1159.5880733038064\n}, {\n  id: 4,\n  img_name: \"00033\",\n  width: 1959,\n  height: 1090,\n  position: [1.742387858893817, -0.13848225198886954, -2.0566370113193146],\n  rotation: [[0.24669889292141334, -0.08370189346592856, -0.9654706879349405], [0.11343747891376445, 0.9919082664242816, -0.05700815184573074], [0.9624300466054861, -0.09545671285663988, 0.2541976029815521]],\n  fy: 1164.6601287484507,\n  fx: 1159.5880733038064\n}, {\n  id: 5,\n  img_name: \"00041\",\n  width: 1959,\n  height: 1090,\n  position: [3.6567309419223935, -0.16470990600750707, -1.3458085590422042],\n  rotation: [[0.2341293058324528, -0.02968330457755884, -0.9717522161434825], [0.10270823606832301, 0.99469554638321, -0.005638106875665722], [0.9667649592295676, -0.09848690996657204, 0.2359360976431732]],\n  fy: 1164.6601287484507,\n  fx: 1159.5880733038064\n}, {\n  id: 6,\n  img_name: \"00049\",\n  width: 1959,\n  height: 1090,\n  position: [3.9013554243203497, -0.2597500978038105, -0.8106154188297828],\n  rotation: [[0.6717235545638952, -0.015718162115524837, -0.7406351366386528], [0.055627354673906296, 0.9980224478387622, 0.029270992841185218], [0.7387104058127439, -0.060861588786650656, 0.6712695459756353]],\n  fy: 1164.6601287484507,\n  fx: 1159.5880733038064\n}, {\n  id: 7,\n  img_name: \"00057\",\n  width: 1959,\n  height: 1090,\n  position: [4.742994605467533, -0.05591660945412069, 0.9500365976084458],\n  rotation: [[-0.17042655709210375, 0.01207080756938, -0.9852964448542146], [0.1165090336695526, 0.9931575292530063, -0.00798543433078162], [0.9784581921120181, -0.1161568667478904, -0.1706667764862097]],\n  fy: 1164.6601287484507,\n  fx: 1159.5880733038064\n}, {\n  id: 8,\n  img_name: \"00065\",\n  width: 1959,\n  height: 1090,\n  position: [4.34676307626522, 0.08168160516967145, 1.0876221470355405],\n  rotation: [[-0.003575447631888379, -0.044792503246552894, -0.9989899137764799], [0.10770152645126597, 0.9931680875192705, -0.04491693593046672], [0.9941768441149182, -0.10775333677534978, 0.0012732004866391048]],\n  fy: 1164.6601287484507,\n  fx: 1159.5880733038064\n}, {\n  id: 9,\n  img_name: \"00073\",\n  width: 1959,\n  height: 1090,\n  position: [3.264984351114202, 0.078974937336732, 1.0117200284114904],\n  rotation: [[-0.026919994628162257, -0.1565891128261527, -0.9872968974090509], [0.08444552208239385, 0.983768234577625, -0.1583319754069128], [0.9960643893290491, -0.0876350978794554, -0.013259786205163005]],\n  fy: 1164.6601287484507,\n  fx: 1159.5880733038064\n}];\nlet camera = cameras[0];\nfunction getProjectionMatrix(fx, fy, width, height) {\n  const znear = 0.2;\n  const zfar = 200;\n  return [[2 * fx / width, 0, 0, 0], [0, -(2 * fy) / height, 0, 0], [0, 0, zfar / (zfar - znear), 1], [0, 0, -(zfar * znear) / (zfar - znear), 0]].flat();\n}\nfunction getViewMatrix(camera) {\n  const R = camera.rotation.flat();\n  const t = camera.position;\n  const camToWorld = [[R[0], R[1], R[2], 0], [R[3], R[4], R[5], 0], [R[6], R[7], R[8], 0], [-t[0] * R[0] - t[1] * R[3] - t[2] * R[6], -t[0] * R[1] - t[1] * R[4] - t[2] * R[7], -t[0] * R[2] - t[1] * R[5] - t[2] * R[8], 1]].flat();\n  return camToWorld;\n}\n// function translate4(a, x, y, z) {\n//     return [\n//         ...a.slice(0, 12),\n//         a[0] * x + a[4] * y + a[8] * z + a[12],\n//         a[1] * x + a[5] * y + a[9] * z + a[13],\n//         a[2] * x + a[6] * y + a[10] * z + a[14],\n//         a[3] * x + a[7] * y + a[11] * z + a[15],\n//     ];\n// }\n\nfunction multiply4(a, b) {\n  return [b[0] * a[0] + b[1] * a[4] + b[2] * a[8] + b[3] * a[12], b[0] * a[1] + b[1] * a[5] + b[2] * a[9] + b[3] * a[13], b[0] * a[2] + b[1] * a[6] + b[2] * a[10] + b[3] * a[14], b[0] * a[3] + b[1] * a[7] + b[2] * a[11] + b[3] * a[15], b[4] * a[0] + b[5] * a[4] + b[6] * a[8] + b[7] * a[12], b[4] * a[1] + b[5] * a[5] + b[6] * a[9] + b[7] * a[13], b[4] * a[2] + b[5] * a[6] + b[6] * a[10] + b[7] * a[14], b[4] * a[3] + b[5] * a[7] + b[6] * a[11] + b[7] * a[15], b[8] * a[0] + b[9] * a[4] + b[10] * a[8] + b[11] * a[12], b[8] * a[1] + b[9] * a[5] + b[10] * a[9] + b[11] * a[13], b[8] * a[2] + b[9] * a[6] + b[10] * a[10] + b[11] * a[14], b[8] * a[3] + b[9] * a[7] + b[10] * a[11] + b[11] * a[15], b[12] * a[0] + b[13] * a[4] + b[14] * a[8] + b[15] * a[12], b[12] * a[1] + b[13] * a[5] + b[14] * a[9] + b[15] * a[13], b[12] * a[2] + b[13] * a[6] + b[14] * a[10] + b[15] * a[14], b[12] * a[3] + b[13] * a[7] + b[14] * a[11] + b[15] * a[15]];\n}\nfunction invert4(a) {\n  let b00 = a[0] * a[5] - a[1] * a[4];\n  let b01 = a[0] * a[6] - a[2] * a[4];\n  let b02 = a[0] * a[7] - a[3] * a[4];\n  let b03 = a[1] * a[6] - a[2] * a[5];\n  let b04 = a[1] * a[7] - a[3] * a[5];\n  let b05 = a[2] * a[7] - a[3] * a[6];\n  let b06 = a[8] * a[13] - a[9] * a[12];\n  let b07 = a[8] * a[14] - a[10] * a[12];\n  let b08 = a[8] * a[15] - a[11] * a[12];\n  let b09 = a[9] * a[14] - a[10] * a[13];\n  let b10 = a[9] * a[15] - a[11] * a[13];\n  let b11 = a[10] * a[15] - a[11] * a[14];\n  let det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n  if (!det) return null;\n  return [(a[5] * b11 - a[6] * b10 + a[7] * b09) / det, (a[2] * b10 - a[1] * b11 - a[3] * b09) / det, (a[13] * b05 - a[14] * b04 + a[15] * b03) / det, (a[10] * b04 - a[9] * b05 - a[11] * b03) / det, (a[6] * b08 - a[4] * b11 - a[7] * b07) / det, (a[0] * b11 - a[2] * b08 + a[3] * b07) / det, (a[14] * b02 - a[12] * b05 - a[15] * b01) / det, (a[8] * b05 - a[10] * b02 + a[11] * b01) / det, (a[4] * b10 - a[5] * b08 + a[7] * b06) / det, (a[1] * b08 - a[0] * b10 - a[3] * b06) / det, (a[12] * b04 - a[13] * b02 + a[15] * b00) / det, (a[9] * b02 - a[8] * b04 - a[11] * b00) / det, (a[5] * b07 - a[4] * b09 - a[6] * b06) / det, (a[0] * b09 - a[1] * b07 + a[2] * b06) / det, (a[13] * b01 - a[12] * b03 - a[14] * b00) / det, (a[8] * b03 - a[9] * b01 + a[10] * b00) / det];\n}\nfunction rotate4(a, rad, x, y, z) {\n  let len = Math.hypot(x, y, z);\n  x /= len;\n  y /= len;\n  z /= len;\n  let s = Math.sin(rad);\n  let c = Math.cos(rad);\n  let t = 1 - c;\n  let b00 = x * x * t + c;\n  let b01 = y * x * t + z * s;\n  let b02 = z * x * t - y * s;\n  let b10 = x * y * t - z * s;\n  let b11 = y * y * t + c;\n  let b12 = z * y * t + x * s;\n  let b20 = x * z * t + y * s;\n  let b21 = y * z * t - x * s;\n  let b22 = z * z * t + c;\n  return [a[0] * b00 + a[4] * b01 + a[8] * b02, a[1] * b00 + a[5] * b01 + a[9] * b02, a[2] * b00 + a[6] * b01 + a[10] * b02, a[3] * b00 + a[7] * b01 + a[11] * b02, a[0] * b10 + a[4] * b11 + a[8] * b12, a[1] * b10 + a[5] * b11 + a[9] * b12, a[2] * b10 + a[6] * b11 + a[10] * b12, a[3] * b10 + a[7] * b11 + a[11] * b12, a[0] * b20 + a[4] * b21 + a[8] * b22, a[1] * b20 + a[5] * b21 + a[9] * b22, a[2] * b20 + a[6] * b21 + a[10] * b22, a[3] * b20 + a[7] * b21 + a[11] * b22, ...a.slice(12, 16)];\n}\nfunction translate4(a, x, y, z) {\n  return [...a.slice(0, 12), a[0] * x + a[4] * y + a[8] * z + a[12], a[1] * x + a[5] * y + a[9] * z + a[13], a[2] * x + a[6] * y + a[10] * z + a[14], a[3] * x + a[7] * y + a[11] * z + a[15]];\n}\nfunction createWorker(self) {\n  let buffer;\n  let vertexCount = 0;\n  let viewProj;\n  // 6*4 + 4 + 4 = 8*4\n  // XYZ - Position (Float32)\n  // XYZ - Scale (Float32)\n  // RGBA - colors (uint8)\n  // IJKL - quaternion/rot (uint8)\n  const rowLength = 3 * 4 + 3 * 4 + 4 + 4;\n  let lastProj = [];\n  let depthIndex = new Uint32Array();\n  let lastVertexCount = 0;\n  var _floatView = new Float32Array(1);\n  var _int32View = new Int32Array(_floatView.buffer);\n  function floatToHalf(float) {\n    _floatView[0] = float;\n    var f = _int32View[0];\n    var sign = f >> 31 & 0x0001;\n    var exp = f >> 23 & 0x00ff;\n    var frac = f & 0x007fffff;\n    var newExp;\n    if (exp == 0) {\n      newExp = 0;\n    } else if (exp < 113) {\n      newExp = 0;\n      frac |= 0x00800000;\n      frac = frac >> 113 - exp;\n      if (frac & 0x01000000) {\n        newExp = 1;\n        frac = 0;\n      }\n    } else if (exp < 142) {\n      newExp = exp - 112;\n    } else {\n      newExp = 31;\n      frac = 0;\n    }\n    return sign << 15 | newExp << 10 | frac >> 13;\n  }\n  function packHalf2x16(x, y) {\n    return (floatToHalf(x) | floatToHalf(y) << 16) >>> 0;\n  }\n  function generateTexture() {\n    if (!buffer) return;\n    const f_buffer = new Float32Array(buffer);\n    const u_buffer = new Uint8Array(buffer);\n    var texwidth = 1024 * 2; // Set to your desired width\n    var texheight = Math.ceil(2 * vertexCount / texwidth); // Set to your desired height\n    var texdata = new Uint32Array(texwidth * texheight * 4); // 4 components per pixel (RGBA)\n    var texdata_c = new Uint8Array(texdata.buffer);\n    var texdata_f = new Float32Array(texdata.buffer);\n\n    // Here we convert from a .splat file buffer into a texture\n    // With a little bit more foresight perhaps this texture file\n    // should have been the native format as it'd be very easy to\n    // load it into webgl.\n    for (let i = 0; i < vertexCount; i++) {\n      // x, y, z\n      texdata_f[8 * i + 0] = f_buffer[8 * i + 0];\n      texdata_f[8 * i + 1] = f_buffer[8 * i + 1];\n      texdata_f[8 * i + 2] = f_buffer[8 * i + 2];\n\n      // r, g, b, a\n      texdata_c[4 * (8 * i + 7) + 0] = u_buffer[32 * i + 24 + 0];\n      texdata_c[4 * (8 * i + 7) + 1] = u_buffer[32 * i + 24 + 1];\n      texdata_c[4 * (8 * i + 7) + 2] = u_buffer[32 * i + 24 + 2];\n      texdata_c[4 * (8 * i + 7) + 3] = u_buffer[32 * i + 24 + 3];\n\n      // quaternions\n      let scale = [f_buffer[8 * i + 3 + 0], f_buffer[8 * i + 3 + 1], f_buffer[8 * i + 3 + 2]];\n      let rot = [(u_buffer[32 * i + 28 + 0] - 128) / 128, (u_buffer[32 * i + 28 + 1] - 128) / 128, (u_buffer[32 * i + 28 + 2] - 128) / 128, (u_buffer[32 * i + 28 + 3] - 128) / 128];\n\n      // Compute the matrix product of S and R (M = S * R)\n      const M = [1.0 - 2.0 * (rot[2] * rot[2] + rot[3] * rot[3]), 2.0 * (rot[1] * rot[2] + rot[0] * rot[3]), 2.0 * (rot[1] * rot[3] - rot[0] * rot[2]), 2.0 * (rot[1] * rot[2] - rot[0] * rot[3]), 1.0 - 2.0 * (rot[1] * rot[1] + rot[3] * rot[3]), 2.0 * (rot[2] * rot[3] + rot[0] * rot[1]), 2.0 * (rot[1] * rot[3] + rot[0] * rot[2]), 2.0 * (rot[2] * rot[3] - rot[0] * rot[1]), 1.0 - 2.0 * (rot[1] * rot[1] + rot[2] * rot[2])].map((k, i) => k * scale[Math.floor(i / 3)]);\n      const sigma = [M[0] * M[0] + M[3] * M[3] + M[6] * M[6], M[0] * M[1] + M[3] * M[4] + M[6] * M[7], M[0] * M[2] + M[3] * M[5] + M[6] * M[8], M[1] * M[1] + M[4] * M[4] + M[7] * M[7], M[1] * M[2] + M[4] * M[5] + M[7] * M[8], M[2] * M[2] + M[5] * M[5] + M[8] * M[8]];\n      texdata[8 * i + 4] = packHalf2x16(4 * sigma[0], 4 * sigma[1]);\n      texdata[8 * i + 5] = packHalf2x16(4 * sigma[2], 4 * sigma[3]);\n      texdata[8 * i + 6] = packHalf2x16(4 * sigma[4], 4 * sigma[5]);\n    }\n    self.postMessage({\n      texdata,\n      texwidth,\n      texheight\n    }, [texdata.buffer]);\n  }\n  function runSort(viewProj) {\n    if (!buffer) return;\n    const f_buffer = new Float32Array(buffer);\n    if (lastVertexCount == vertexCount) {\n      let dot = lastProj[2] * viewProj[2] + lastProj[6] * viewProj[6] + lastProj[10] * viewProj[10];\n      if (Math.abs(dot - 1) < 0.01) {\n        return;\n      }\n    } else {\n      generateTexture();\n      lastVertexCount = vertexCount;\n    }\n\n    // console.time(\"sort\");\n    let maxDepth = -Infinity;\n    let minDepth = Infinity;\n    let sizeList = new Int32Array(vertexCount);\n    for (let i = 0; i < vertexCount; i++) {\n      let depth = (viewProj[2] * f_buffer[8 * i + 0] + viewProj[6] * f_buffer[8 * i + 1] + viewProj[10] * f_buffer[8 * i + 2]) * 4096 | 0;\n      sizeList[i] = depth;\n      if (depth > maxDepth) maxDepth = depth;\n      if (depth < minDepth) minDepth = depth;\n    }\n\n    // This is a 16 bit single-pass counting sort\n    let depthInv = 256 * 256 / (maxDepth - minDepth);\n    let counts0 = new Uint32Array(256 * 256);\n    for (let i = 0; i < vertexCount; i++) {\n      sizeList[i] = (sizeList[i] - minDepth) * depthInv | 0;\n      counts0[sizeList[i]]++;\n    }\n    let starts0 = new Uint32Array(256 * 256);\n    for (let i = 1; i < 256 * 256; i++) starts0[i] = starts0[i - 1] + counts0[i - 1];\n    depthIndex = new Uint32Array(vertexCount);\n    for (let i = 0; i < vertexCount; i++) depthIndex[starts0[sizeList[i]]++] = i;\n\n    // console.timeEnd(\"sort\");\n\n    lastProj = viewProj;\n    self.postMessage({\n      depthIndex,\n      viewProj,\n      vertexCount\n    }, [depthIndex.buffer]);\n  }\n  function processPlyBuffer(inputBuffer) {\n    const ubuf = new Uint8Array(inputBuffer);\n    // 10KB ought to be enough for a header...\n    const header = new TextDecoder().decode(ubuf.slice(0, 1024 * 10));\n    const header_end = \"end_header\\n\";\n    const header_end_index = header.indexOf(header_end);\n    if (header_end_index < 0) throw new Error(\"Unable to read .ply file header\");\n    const vertexCount = parseInt(/element vertex (\\d+)\\n/.exec(header)[1]);\n    console.log(\"Vertex Count\", vertexCount);\n    let row_offset = 0,\n      offsets = {},\n      types = {};\n    const TYPE_MAP = {\n      double: \"getFloat64\",\n      int: \"getInt32\",\n      uint: \"getUint32\",\n      float: \"getFloat32\",\n      short: \"getInt16\",\n      ushort: \"getUint16\",\n      uchar: \"getUint8\"\n    };\n    for (let prop of header.slice(0, header_end_index).split(\"\\n\").filter(k => k.startsWith(\"property \"))) {\n      const [p, type, name] = prop.split(\" \");\n      const arrayType = TYPE_MAP[type] || \"getInt8\";\n      types[name] = arrayType;\n      offsets[name] = row_offset;\n      row_offset += parseInt(arrayType.replace(/[^\\d]/g, \"\")) / 8;\n    }\n    console.log(\"Bytes per row\", row_offset, types, offsets);\n    let dataView = new DataView(inputBuffer, header_end_index + header_end.length);\n    let row = 0;\n    const attrs = new Proxy({}, {\n      get(target, prop) {\n        if (!types[prop]) throw new Error(prop + \" not found\");\n        return dataView[types[prop]](row * row_offset + offsets[prop], true);\n      }\n    });\n    console.time(\"calculate importance\");\n    let sizeList = new Float32Array(vertexCount);\n    let sizeIndex = new Uint32Array(vertexCount);\n    for (row = 0; row < vertexCount; row++) {\n      sizeIndex[row] = row;\n      if (!types[\"scale_0\"]) continue;\n      const size = Math.exp(attrs.scale_0) * Math.exp(attrs.scale_1) * Math.exp(attrs.scale_2);\n      const opacity = 1 / (1 + Math.exp(-attrs.opacity));\n      sizeList[row] = size * opacity;\n    }\n    console.timeEnd(\"calculate importance\");\n    console.time(\"sort\");\n    sizeIndex.sort((b, a) => sizeList[a] - sizeList[b]);\n    console.timeEnd(\"sort\");\n\n    // 6*4 + 4 + 4 = 8*4\n    // XYZ - Position (Float32)\n    // XYZ - Scale (Float32)\n    // RGBA - colors (uint8)\n    // IJKL - quaternion/rot (uint8)\n    const rowLength = 3 * 4 + 3 * 4 + 4 + 4;\n    const buffer = new ArrayBuffer(rowLength * vertexCount);\n    console.time(\"build buffer\");\n    for (let j = 0; j < vertexCount; j++) {\n      row = sizeIndex[j];\n      const position = new Float32Array(buffer, j * rowLength, 3);\n      const scales = new Float32Array(buffer, j * rowLength + 4 * 3, 3);\n      const rgba = new Uint8ClampedArray(buffer, j * rowLength + 4 * 3 + 4 * 3, 4);\n      const rot = new Uint8ClampedArray(buffer, j * rowLength + 4 * 3 + 4 * 3 + 4, 4);\n      if (types[\"scale_0\"]) {\n        const qlen = Math.sqrt(attrs.rot_0 ** 2 + attrs.rot_1 ** 2 + attrs.rot_2 ** 2 + attrs.rot_3 ** 2);\n        rot[0] = attrs.rot_0 / qlen * 128 + 128;\n        rot[1] = attrs.rot_1 / qlen * 128 + 128;\n        rot[2] = attrs.rot_2 / qlen * 128 + 128;\n        rot[3] = attrs.rot_3 / qlen * 128 + 128;\n        scales[0] = Math.exp(attrs.scale_0);\n        scales[1] = Math.exp(attrs.scale_1);\n        scales[2] = Math.exp(attrs.scale_2);\n      } else {\n        scales[0] = 0.01;\n        scales[1] = 0.01;\n        scales[2] = 0.01;\n        rot[0] = 255;\n        rot[1] = 0;\n        rot[2] = 0;\n        rot[3] = 0;\n      }\n      position[0] = attrs.x;\n      position[1] = attrs.y;\n      position[2] = attrs.z;\n      if (types[\"f_dc_0\"]) {\n        const SH_C0 = 0.28209479177387814;\n        rgba[0] = (0.5 + SH_C0 * attrs.f_dc_0) * 255;\n        rgba[1] = (0.5 + SH_C0 * attrs.f_dc_1) * 255;\n        rgba[2] = (0.5 + SH_C0 * attrs.f_dc_2) * 255;\n      } else {\n        rgba[0] = attrs.red;\n        rgba[1] = attrs.green;\n        rgba[2] = attrs.blue;\n      }\n      if (types[\"opacity\"]) {\n        rgba[3] = 1 / (1 + Math.exp(-attrs.opacity)) * 255;\n      } else {\n        rgba[3] = 255;\n      }\n    }\n    console.timeEnd(\"build buffer\");\n    return buffer;\n  }\n  const throttledSort = () => {\n    if (!sortRunning) {\n      sortRunning = true;\n      let lastView = viewProj;\n      runSort(lastView);\n      setTimeout(() => {\n        sortRunning = false;\n        if (lastView !== viewProj) {\n          throttledSort();\n        }\n      }, 0);\n    }\n  };\n  let sortRunning;\n  self.onmessage = e => {\n    if (e.data.ply) {\n      vertexCount = 0;\n      runSort(viewProj);\n      buffer = processPlyBuffer(e.data.ply);\n      vertexCount = Math.floor(buffer.byteLength / rowLength);\n      postMessage({\n        buffer: buffer\n      });\n    } else if (e.data.buffer) {\n      buffer = e.data.buffer;\n      vertexCount = e.data.vertexCount;\n    } else if (e.data.vertexCount) {\n      vertexCount = e.data.vertexCount;\n    } else if (e.data.view) {\n      viewProj = e.data.view;\n      throttledSort();\n    }\n  };\n}\nconst vertexShaderSource = `\n#version 300 es\nprecision highp float;\nprecision highp int;\n\nuniform highp usampler2D u_texture;\nuniform mat4 projection, view;\nuniform vec2 focal;\nuniform vec2 viewport;\n\nin vec2 position;\nin int index;\n\nout vec4 vColor;\nout vec2 vPosition;\n\nvoid main () {\n    uvec4 cen = texelFetch(u_texture, ivec2((uint(index) & 0x3ffu) << 1, uint(index) >> 10), 0);\n    vec4 cam = view * vec4(uintBitsToFloat(cen.xyz), 1);\n    vec4 pos2d = projection * cam;\n\n    float clip = 1.2 * pos2d.w;\n    if (pos2d.z < -clip || pos2d.x < -clip || pos2d.x > clip || pos2d.y < -clip || pos2d.y > clip) {\n        gl_Position = vec4(0.0, 0.0, 2.0, 1.0);\n        return;\n    }\n\n    uvec4 cov = texelFetch(u_texture, ivec2(((uint(index) & 0x3ffu) << 1) | 1u, uint(index) >> 10), 0);\n    vec2 u1 = unpackHalf2x16(cov.x), u2 = unpackHalf2x16(cov.y), u3 = unpackHalf2x16(cov.z);\n    mat3 Vrk = mat3(u1.x, u1.y, u2.x, u1.y, u2.y, u3.x, u2.x, u3.x, u3.y);\n\n    mat3 J = mat3(\n        focal.x / cam.z, 0., -(focal.x * cam.x) / (cam.z * cam.z), \n        0., -focal.y / cam.z, (focal.y * cam.y) / (cam.z * cam.z), \n        0., 0., 0.\n    );\n\n    mat3 T = transpose(mat3(view)) * J;\n    mat3 cov2d = transpose(T) * Vrk * T;\n\n    float mid = (cov2d[0][0] + cov2d[1][1]) / 2.0;\n    float radius = length(vec2((cov2d[0][0] - cov2d[1][1]) / 2.0, cov2d[0][1]));\n    float lambda1 = mid + radius, lambda2 = mid - radius;\n\n    if(lambda2 < 0.0) return;\n    vec2 diagonalVector = normalize(vec2(cov2d[0][1], lambda1 - cov2d[0][0]));\n    vec2 majorAxis = min(sqrt(2.0 * lambda1), 1024.0) * diagonalVector;\n    vec2 minorAxis = min(sqrt(2.0 * lambda2), 1024.0) * vec2(diagonalVector.y, -diagonalVector.x);\n\n    vColor = clamp(pos2d.z/pos2d.w+1.0, 0.0, 1.0) * vec4((cov.w) & 0xffu, (cov.w >> 8) & 0xffu, (cov.w >> 16) & 0xffu, (cov.w >> 24) & 0xffu) / 255.0;\n    vPosition = position;\n\n    vec2 vCenter = vec2(pos2d) / pos2d.w;\n    gl_Position = vec4(\n        vCenter \n        + position.x * majorAxis / viewport \n        + position.y * minorAxis / viewport, 0.0, 1.0);\n\n}\n`.trim();\nconst fragmentShaderSource = `\n#version 300 es\nprecision highp float;\n\nin vec4 vColor;\nin vec2 vPosition;\n\nout vec4 fragColor;\n\nvoid main () {\n    float A = -dot(vPosition, vPosition);\n    if (A < -4.0) discard;\n    float B = exp(A) * vColor.a;\n    fragColor = vec4(B * vColor.rgb, B);\n}\n\n`.trim();\nlet defaultViewMatrix = [0.47, 0.04, 0.88, 0, -0.11, 0.99, 0.02, 0, -0.88, -0.11, 0.47, 0, 0.07, 0.03, 6.55, 1];\nlet viewMatrix = defaultViewMatrix;\nasync function main(source, id) {\n  _s();\n  let carousel = true;\n  const params = new URLSearchParams(window.location.search);\n  try {\n    viewMatrix = JSON.parse(decodeURIComponent(window.location.hash.slice(1)));\n    carousel = false;\n  } catch (err) {}\n  const url = new URL(source);\n  const req = await fetch(url, {\n    mode: \"cors\",\n    // no-cors, *cors, same-origin\n    credentials: \"omit\" // include, *same-origin, omit\n  });\n  console.log(req);\n  if (req.status != 200) throw new Error(req.status + \" Unable to load \" + req.url);\n  const rowLength = 3 * 4 + 3 * 4 + 4 + 4;\n  const reader = req.body.getReader();\n  let splatData = new Uint8Array(req.headers.get(\"content-length\"));\n  const downsample = splatData.length / rowLength > 500000 ? 1 : 1 / devicePixelRatio;\n  console.log(splatData.length / rowLength, downsample);\n  const worker = new Worker(URL.createObjectURL(new Blob([\"(\", createWorker.toString(), \")(self)\"], {\n    type: \"application/javascript\"\n  })));\n  const canvas = document.getElementById(\"canvas\" + id);\n  // const fps = document.getElementById(\"fps\");\n  // const camid = document.getElementById(\"camid\");\n\n  let projectionMatrix;\n  const gl = canvas.getContext(\"webgl2\", {\n    antialias: false\n  });\n  const vertexShader = gl.createShader(gl.VERTEX_SHADER);\n  gl.shaderSource(vertexShader, vertexShaderSource);\n  gl.compileShader(vertexShader);\n  if (!gl.getShaderParameter(vertexShader, gl.COMPILE_STATUS)) console.error(gl.getShaderInfoLog(vertexShader));\n  const fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);\n  gl.shaderSource(fragmentShader, fragmentShaderSource);\n  gl.compileShader(fragmentShader);\n  if (!gl.getShaderParameter(fragmentShader, gl.COMPILE_STATUS)) console.error(gl.getShaderInfoLog(fragmentShader));\n  const program = gl.createProgram();\n  gl.attachShader(program, vertexShader);\n  gl.attachShader(program, fragmentShader);\n  gl.linkProgram(program);\n  gl.useProgram(program);\n  if (!gl.getProgramParameter(program, gl.LINK_STATUS)) console.error(gl.getProgramInfoLog(program));\n  gl.disable(gl.DEPTH_TEST); // Disable depth testing\n\n  // Enable blending\n  gl.enable(gl.BLEND);\n  gl.blendFuncSeparate(gl.ONE_MINUS_DST_ALPHA, gl.ONE, gl.ONE_MINUS_DST_ALPHA, gl.ONE);\n  gl.blendEquationSeparate(gl.FUNC_ADD, gl.FUNC_ADD);\n  const u_projection = gl.getUniformLocation(program, \"projection\");\n  const u_viewport = gl.getUniformLocation(program, \"viewport\");\n  const u_focal = gl.getUniformLocation(program, \"focal\");\n  const u_view = gl.getUniformLocation(program, \"view\");\n\n  // positions\n  const triangleVertices = new Float32Array([-2, -2, 2, -2, 2, 2, -2, 2]);\n  const vertexBuffer = gl.createBuffer();\n  gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer);\n  gl.bufferData(gl.ARRAY_BUFFER, triangleVertices, gl.STATIC_DRAW);\n  const a_position = gl.getAttribLocation(program, \"position\");\n  gl.enableVertexAttribArray(a_position);\n  gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer);\n  gl.vertexAttribPointer(a_position, 2, gl.FLOAT, false, 0, 0);\n  var texture = gl.createTexture();\n  gl.bindTexture(gl.TEXTURE_2D, texture);\n  var u_textureLocation = gl.getUniformLocation(program, \"u_texture\");\n  gl.uniform1i(u_textureLocation, 0);\n  const indexBuffer = gl.createBuffer();\n  const a_index = gl.getAttribLocation(program, \"index\");\n  gl.enableVertexAttribArray(a_index);\n  gl.bindBuffer(gl.ARRAY_BUFFER, indexBuffer);\n  gl.vertexAttribIPointer(a_index, 1, gl.INT, false, 0, 0);\n  gl.vertexAttribDivisor(a_index, 1);\n  const resize = () => {\n    gl.uniform2fv(u_focal, new Float32Array([camera.fx, camera.fy]));\n    projectionMatrix = getProjectionMatrix(camera.fx, camera.fy, window.innerWidth, window.innerHeight);\n    gl.uniform2fv(u_viewport, new Float32Array([window.innerWidth, window.innerHeight]));\n    gl.canvas.width = Math.round(window.innerWidth / downsample);\n    gl.canvas.height = Math.round(window.innerHeight / downsample);\n    gl.viewport(0, 0, gl.canvas.width, gl.canvas.height);\n    gl.uniformMatrix4fv(u_projection, false, projectionMatrix);\n  };\n  window.addEventListener(\"resize\", resize);\n  resize();\n  worker.onmessage = e => {\n    if (e.data.buffer) {\n      splatData = new Uint8Array(e.data.buffer);\n      const blob = new Blob([splatData.buffer], {\n        type: \"application/octet-stream\"\n      });\n      const link = document.createElement(\"a\");\n      link.download = \"model.splat\";\n      link.href = URL.createObjectURL(blob);\n      document.body.appendChild(link);\n      link.click();\n    } else if (e.data.texdata) {\n      const {\n        texdata,\n        texwidth,\n        texheight\n      } = e.data;\n      // console.log(texdata)\n      gl.bindTexture(gl.TEXTURE_2D, texture);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n      gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA32UI, texwidth, texheight, 0, gl.RGBA_INTEGER, gl.UNSIGNED_INT, texdata);\n      gl.activeTexture(gl.TEXTURE0);\n      gl.bindTexture(gl.TEXTURE_2D, texture);\n    } else if (e.data.depthIndex) {\n      const {\n        depthIndex,\n        viewProj\n      } = e.data;\n      gl.bindBuffer(gl.ARRAY_BUFFER, indexBuffer);\n      gl.bufferData(gl.ARRAY_BUFFER, depthIndex, gl.DYNAMIC_DRAW);\n      vertexCount = e.data.vertexCount;\n    }\n  };\n  let activeKeys = [];\n  let currentCameraIndex = 0;\n  window.addEventListener(\"keydown\", e => {\n    // if (document.activeElement != document.body) return;\n    carousel = false;\n    if (!activeKeys.includes(e.code)) activeKeys.push(e.code);\n    if (/\\d/.test(e.key)) {\n      currentCameraIndex = parseInt(e.key);\n      camera = cameras[currentCameraIndex];\n      viewMatrix = getViewMatrix(camera);\n    }\n    if (['-', '_'].includes(e.key)) {\n      currentCameraIndex = (currentCameraIndex + cameras.length - 1) % cameras.length;\n      viewMatrix = getViewMatrix(cameras[currentCameraIndex]);\n    }\n    if (['+', '='].includes(e.key)) {\n      currentCameraIndex = (currentCameraIndex + 1) % cameras.length;\n      viewMatrix = getViewMatrix(cameras[currentCameraIndex]);\n    }\n    // camid.innerText = \"cam  \" + currentCameraIndex;\n    // if (e.code == \"KeyV\") {\n    //     location.hash =\n    //         \"#\" +\n    //         JSON.stringify(\n    //             viewMatrix.map((k) => Math.round(k * 100) / 100),\n    //         );\n    //         camid.innerText =\"\"\n    // } else if (e.code === \"KeyP\") {\n    //     carousel = true;\n    //     camid.innerText =\"\"\n    // }\n  });\n  window.addEventListener(\"keyup\", e => {\n    activeKeys = activeKeys.filter(k => k !== e.code);\n  });\n  window.addEventListener(\"blur\", () => {\n    activeKeys = [];\n  });\n\n  // window.addEventListener(\n  //     \"wheel\",\n  //     (e) => {\n  //         carousel = false;\n  //         e.preventDefault();\n  //         const lineHeight = 10;\n  //         const scale =\n  //             e.deltaMode == 1\n  //                 ? lineHeight\n  //                 : e.deltaMode == 2\n  //                 ? innerHeight\n  //                 : 1;\n  //         let inv = invert4(viewMatrix);\n  //         if (e.shiftKey) {\n  //             inv = translate4(\n  //                 inv,\n  //                 (e.deltaX * scale) / innerWidth,\n  //                 (e.deltaY * scale) / innerHeight,\n  //                 0,\n  //             );\n  //         } else if (e.ctrlKey || e.metaKey) {\n  //             // inv = rotate4(inv,  (e.deltaX * scale) / innerWidth,  0, 0, 1);\n  //             // inv = translate4(inv,  0, (e.deltaY * scale) / innerHeight, 0);\n  //             // let preY = inv[13];\n  //             inv = translate4(\n  //                 inv,\n  //                 0,\n  //                 0,\n  //                 (-10 * (e.deltaY * scale)) / innerHeight,\n  //             );\n  //             // inv[13] = preY;\n  //         } else {\n  //             let d = 4;\n  //             inv = translate4(inv, 0, 0, d);\n  //             inv = rotate4(inv, -(e.deltaX * scale) / innerWidth, 0, 1, 0);\n  //             inv = rotate4(inv, (e.deltaY * scale) / innerHeight, 1, 0, 0);\n  //             inv = translate4(inv, 0, 0, -d);\n  //         }\n\n  //         viewMatrix = invert4(inv);\n  //     },\n  //     { passive: false },\n  // );\n\n  let startX, startY, down;\n  canvas.addEventListener(\"mousedown\", e => {\n    carousel = false;\n    e.preventDefault();\n    startX = e.clientX;\n    startY = e.clientY;\n    down = e.ctrlKey || e.metaKey ? 2 : 1;\n  });\n  canvas.addEventListener(\"contextmenu\", e => {\n    carousel = false;\n    e.preventDefault();\n    startX = e.clientX;\n    startY = e.clientY;\n    down = 2;\n  });\n  canvas.addEventListener(\"mousemove\", e => {\n    e.preventDefault();\n    if (down == 1) {\n      let inv = invert4(viewMatrix);\n      let dx = 5 * (e.clientX - startX) / window.innerWidth;\n      let dy = 5 * (e.clientY - startY) / window.innerHeight;\n      let d = 4;\n      inv = translate4(inv, 0, 0, d);\n      inv = rotate4(inv, dx, 0, 1, 0);\n      inv = rotate4(inv, -dy, 1, 0, 0);\n      inv = translate4(inv, 0, 0, -d);\n      // let postAngle = Math.atan2(inv[0], inv[10])\n      // inv = rotate4(inv, postAngle - preAngle, 0, 0, 1)\n      // console.log(postAngle)\n      viewMatrix = invert4(inv);\n      startX = e.clientX;\n      startY = e.clientY;\n    } else if (down == 2) {\n      let inv = invert4(viewMatrix);\n      // inv = rotateY(inv, );\n      // let preY = inv[13];\n      inv = translate4(inv, -10 * (e.clientX - startX) / window.innerWidth, 0, 10 * (e.clientY - startY) / innerHeight);\n      // inv[13] = preY;\n      viewMatrix = invert4(inv);\n      startX = e.clientX;\n      startY = e.clientY;\n    }\n  });\n  canvas.addEventListener(\"mouseup\", e => {\n    e.preventDefault();\n    down = false;\n    startX = 0;\n    startY = 0;\n  });\n  let altX = 0,\n    altY = 0;\n  canvas.addEventListener(\"touchstart\", e => {\n    e.preventDefault();\n    if (e.touches.length === 1) {\n      carousel = false;\n      startX = e.touches[0].clientX;\n      startY = e.touches[0].clientY;\n      down = 1;\n    } else if (e.touches.length === 2) {\n      // console.log('beep')\n      carousel = false;\n      startX = e.touches[0].clientX;\n      altX = e.touches[1].clientX;\n      startY = e.touches[0].clientY;\n      altY = e.touches[1].clientY;\n      down = 1;\n    }\n  }, {\n    passive: false\n  });\n  canvas.addEventListener(\"touchmove\", e => {\n    e.preventDefault();\n    if (e.touches.length === 1 && down) {\n      let inv = invert4(viewMatrix);\n      let dx = 4 * (e.touches[0].clientX - startX) / innerWidth;\n      let dy = 4 * (e.touches[0].clientY - startY) / innerHeight;\n      let d = 4;\n      inv = translate4(inv, 0, 0, d);\n      // inv = translate4(inv,  -x, -y, -z);\n      // inv = translate4(inv,  x, y, z);\n      inv = rotate4(inv, dx, 0, 1, 0);\n      inv = rotate4(inv, -dy, 1, 0, 0);\n      inv = translate4(inv, 0, 0, -d);\n      viewMatrix = invert4(inv);\n      startX = e.touches[0].clientX;\n      startY = e.touches[0].clientY;\n    } else if (e.touches.length === 2) {\n      // alert('beep')\n      const dtheta = Math.atan2(startY - altY, startX - altX) - Math.atan2(e.touches[0].clientY - e.touches[1].clientY, e.touches[0].clientX - e.touches[1].clientX);\n      const dscale = Math.hypot(startX - altX, startY - altY) / Math.hypot(e.touches[0].clientX - e.touches[1].clientX, e.touches[0].clientY - e.touches[1].clientY);\n      const dx = (e.touches[0].clientX + e.touches[1].clientX - (startX + altX)) / 2;\n      const dy = (e.touches[0].clientY + e.touches[1].clientY - (startY + altY)) / 2;\n      let inv = invert4(viewMatrix);\n      // inv = translate4(inv,  0, 0, d);\n      inv = rotate4(inv, dtheta, 0, 0, 1);\n      inv = translate4(inv, -dx / innerWidth, -dy / innerHeight, 0);\n\n      // let preY = inv[13];\n      inv = translate4(inv, 0, 0, 3 * (1 - dscale));\n      // inv[13] = preY;\n\n      viewMatrix = invert4(inv);\n      startX = e.touches[0].clientX;\n      altX = e.touches[1].clientX;\n      startY = e.touches[0].clientY;\n      altY = e.touches[1].clientY;\n    }\n  }, {\n    passive: false\n  });\n  canvas.addEventListener(\"touchend\", e => {\n    e.preventDefault();\n    down = false;\n    startX = 0;\n    startY = 0;\n  }, {\n    passive: false\n  });\n  let jumpDelta = 0;\n  let vertexCount = 0;\n  let lastFrame = 0;\n  // let avgFps = 0;\n  let start = 0;\n  window.addEventListener(\"gamepadconnected\", e => {\n    const gp = navigator.getGamepads()[e.gamepad.index];\n    console.log(`Gamepad connected at index ${gp.index}: ${gp.id}. It has ${gp.buttons.length} buttons and ${gp.axes.length} axes.`);\n  });\n  window.addEventListener(\"gamepaddisconnected\", e => {\n    console.log(\"Gamepad disconnected\");\n  });\n  let leftGamepadTrigger, rightGamepadTrigger;\n  const frame = now => {\n    let inv = invert4(viewMatrix);\n    let shiftKey = activeKeys.includes(\"Shift\") || activeKeys.includes(\"ShiftLeft\") || activeKeys.includes(\"ShiftRight\");\n    if (activeKeys.includes(\"ArrowUp\")) {\n      if (shiftKey) {\n        inv = translate4(inv, 0, -0.03, 0);\n      } else {\n        inv = translate4(inv, 0, 0, 0.1);\n      }\n    }\n    if (activeKeys.includes(\"ArrowDown\")) {\n      if (shiftKey) {\n        inv = translate4(inv, 0, 0.03, 0);\n      } else {\n        inv = translate4(inv, 0, 0, -0.1);\n      }\n    }\n    if (activeKeys.includes(\"ArrowLeft\")) inv = translate4(inv, -0.03, 0, 0);\n    //\n    if (activeKeys.includes(\"ArrowRight\")) inv = translate4(inv, 0.03, 0, 0);\n    // inv = rotate4(inv, 0.01, 0, 1, 0);\n    if (activeKeys.includes(\"KeyA\")) inv = rotate4(inv, -0.01, 0, 1, 0);\n    if (activeKeys.includes(\"KeyD\")) inv = rotate4(inv, 0.01, 0, 1, 0);\n    if (activeKeys.includes(\"KeyQ\")) inv = rotate4(inv, 0.01, 0, 0, 1);\n    if (activeKeys.includes(\"KeyE\")) inv = rotate4(inv, -0.01, 0, 0, 1);\n    if (activeKeys.includes(\"KeyW\")) inv = rotate4(inv, 0.005, 1, 0, 0);\n    if (activeKeys.includes(\"KeyS\")) inv = rotate4(inv, -0.005, 1, 0, 0);\n    const gamepads = navigator.getGamepads ? navigator.getGamepads() : [];\n    let isJumping = activeKeys.includes(\"Space\");\n    for (let gamepad of gamepads) {\n      if (!gamepad) continue;\n      const axisThreshold = 0.1; // Threshold to detect when the axis is intentionally moved\n      const moveSpeed = 0.06;\n      const rotateSpeed = 0.02;\n\n      // Assuming the left stick controls translation (axes 0 and 1)\n      if (Math.abs(gamepad.axes[0]) > axisThreshold) {\n        inv = translate4(inv, moveSpeed * gamepad.axes[0], 0, 0);\n        carousel = false;\n      }\n      if (Math.abs(gamepad.axes[1]) > axisThreshold) {\n        inv = translate4(inv, 0, 0, -moveSpeed * gamepad.axes[1]);\n        carousel = false;\n      }\n      if (gamepad.buttons[12].pressed || gamepad.buttons[13].pressed) {\n        inv = translate4(inv, 0, -moveSpeed * (gamepad.buttons[12].pressed - gamepad.buttons[13].pressed), 0);\n        carousel = false;\n      }\n      if (gamepad.buttons[14].pressed || gamepad.buttons[15].pressed) {\n        inv = translate4(inv, -moveSpeed * (gamepad.buttons[14].pressed - gamepad.buttons[15].pressed), 0, 0);\n        carousel = false;\n      }\n\n      // Assuming the right stick controls rotation (axes 2 and 3)\n      if (Math.abs(gamepad.axes[2]) > axisThreshold) {\n        inv = rotate4(inv, rotateSpeed * gamepad.axes[2], 0, 1, 0);\n        carousel = false;\n      }\n      if (Math.abs(gamepad.axes[3]) > axisThreshold) {\n        inv = rotate4(inv, -rotateSpeed * gamepad.axes[3], 1, 0, 0);\n        carousel = false;\n      }\n      let tiltAxis = gamepad.buttons[6].value - gamepad.buttons[7].value;\n      if (Math.abs(tiltAxis) > axisThreshold) {\n        inv = rotate4(inv, rotateSpeed * tiltAxis, 0, 0, 1);\n        carousel = false;\n      }\n      if (gamepad.buttons[4].pressed && !leftGamepadTrigger) {\n        camera = cameras[(cameras.indexOf(camera) + 1) % cameras.length];\n        inv = invert4(getViewMatrix(camera));\n        carousel = false;\n      }\n      if (gamepad.buttons[5].pressed && !rightGamepadTrigger) {\n        camera = cameras[(cameras.indexOf(camera) + cameras.length - 1) % cameras.length];\n        inv = invert4(getViewMatrix(camera));\n        carousel = false;\n      }\n      leftGamepadTrigger = gamepad.buttons[4].pressed;\n      rightGamepadTrigger = gamepad.buttons[5].pressed;\n      if (gamepad.buttons[0].pressed) {\n        isJumping = true;\n        carousel = false;\n      }\n      if (gamepad.buttons[3].pressed) {\n        carousel = true;\n      }\n    }\n    if ([\"KeyJ\", \"KeyK\", \"KeyL\", \"KeyI\"].some(k => activeKeys.includes(k))) {\n      let d = 4;\n      inv = translate4(inv, 0, 0, d);\n      inv = rotate4(inv, activeKeys.includes(\"KeyJ\") ? -0.05 : activeKeys.includes(\"KeyL\") ? 0.05 : 0, 0, 1, 0);\n      inv = rotate4(inv, activeKeys.includes(\"KeyI\") ? 0.05 : activeKeys.includes(\"KeyK\") ? -0.05 : 0, 1, 0, 0);\n      inv = translate4(inv, 0, 0, -d);\n    }\n    viewMatrix = invert4(inv);\n    if (carousel) {\n      let inv = invert4(defaultViewMatrix);\n      const t = Math.sin((Date.now() - start) / 5000);\n      inv = translate4(inv, 2.5 * t, 0, 6 * (1 - Math.cos(t)));\n      inv = rotate4(inv, -0.6 * t, 0, 1, 0);\n      viewMatrix = invert4(inv);\n    }\n    if (isJumping) {\n      jumpDelta = Math.min(1, jumpDelta + 0.05);\n    } else {\n      jumpDelta = Math.max(0, jumpDelta - 0.05);\n    }\n    let inv2 = invert4(viewMatrix);\n    inv2 = translate4(inv2, 0, -jumpDelta, 0);\n    inv2 = rotate4(inv2, -0.1 * jumpDelta, 1, 0, 0);\n    let actualViewMatrix = invert4(inv2);\n    const viewProj = multiply4(projectionMatrix, actualViewMatrix);\n    worker.postMessage({\n      view: viewProj\n    });\n\n    // const currentFps = 1000 / (now - lastFrame) || 0;\n    // avgFps = avgFps * 0.9 + currentFps * 0.1;\n\n    if (vertexCount > 0) {\n      document.getElementById(\"spinner\" + id).style.display = \"none\";\n      gl.uniformMatrix4fv(u_view, false, actualViewMatrix);\n      gl.clear(gl.COLOR_BUFFER_BIT);\n      gl.drawArraysInstanced(gl.TRIANGLE_FAN, 0, 4, vertexCount);\n    } else {\n      gl.clear(gl.COLOR_BUFFER_BIT);\n      document.getElementById(\"spinner\" + id).style.display = \"\";\n      start = Date.now() + 2000;\n    }\n    const progress = 100 * vertexCount / (splatData.length / rowLength);\n    if (progress < 100) {\n      document.getElementById(\"progress\" + id).style.width = progress + \"%\";\n    } else {\n      document.getElementById(\"progress\" + id).style.display = \"none\";\n    }\n    // fps.innerText = Math.round(avgFps) + \" fps\";\n    // if (isNaN(currentCameraIndex)){\n    //     camid.innerText = \"\";\n    // }\n    lastFrame = now;\n    requestAnimationFrame(frame);\n  };\n  frame();\n  const selectFile = file => {\n    const fr = new FileReader();\n    if (/\\.json$/i.test(file.name)) {\n      fr.onload = () => {\n        cameras = JSON.parse(fr.result);\n        viewMatrix = getViewMatrix(cameras[0]);\n        projectionMatrix = getProjectionMatrix(camera.fx / downsample, camera.fy / downsample, canvas.width, canvas.height);\n        gl.uniformMatrix4fv(u_projection, false, projectionMatrix);\n        console.log(\"Loaded Cameras\");\n      };\n      fr.readAsText(file);\n    } else {\n      stopLoading = true;\n      fr.onload = () => {\n        splatData = new Uint8Array(fr.result);\n        console.log(\"Loaded\", Math.floor(splatData.length / rowLength));\n        if (splatData[0] == 112 && splatData[1] == 108 && splatData[2] == 121 && splatData[3] == 10) {\n          // ply file magic header means it should be handled differently\n          worker.postMessage({\n            ply: splatData.buffer\n          });\n        } else {\n          worker.postMessage({\n            buffer: splatData.buffer,\n            vertexCount: Math.floor(splatData.length / rowLength)\n          });\n        }\n      };\n      fr.readAsArrayBuffer(file);\n    }\n  };\n  window.addEventListener(\"hashchange\", e => {\n    try {\n      viewMatrix = JSON.parse(decodeURIComponent(location.hash.slice(1)));\n      carousel = false;\n    } catch (err) {}\n  });\n  const preventDefault = e => {\n    e.preventDefault();\n    e.stopPropagation();\n  };\n  document.addEventListener(\"dragenter\", preventDefault);\n  document.addEventListener(\"dragover\", preventDefault);\n  document.addEventListener(\"dragleave\", preventDefault);\n  document.addEventListener(\"drop\", e => {\n    e.preventDefault();\n    e.stopPropagation();\n    selectFile(e.dataTransfer.files[0]);\n  });\n  let bytesRead = 0;\n  let lastVertexCount = -1;\n  let stopLoading = false;\n  while (true) {\n    const {\n      done,\n      value\n    } = await reader.read();\n    if (done || stopLoading) break;\n    splatData.set(value, bytesRead);\n    bytesRead += value.length;\n    if (vertexCount > lastVertexCount) {\n      worker.postMessage({\n        buffer: splatData.buffer,\n        vertexCount: Math.floor(bytesRead / rowLength)\n      });\n      lastVertexCount = vertexCount;\n    }\n  }\n  if (!stopLoading) worker.postMessage({\n    buffer: splatData.buffer,\n    vertexCount: Math.floor(bytesRead / rowLength)\n  });\n}\n_s(main, \"ZdQBZ3rq7bWAAMQq6hlVCmYF0jM=\", false, function () {\n  return [gl.useProgram];\n});\nmain().catch(err => {\n  // document.getElementById(\"message\").innerText = err.toString();\n});\nexport default function GaussianViewer({\n  id,\n  source\n}) {\n  _s2();\n  console.log(source);\n  useEffect(() => {\n    main(source, id);\n  });\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"progress\",\n      id: \"progress\" + id\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1463,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"message\",\n      id: \"message\" + id\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1464,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"scene\",\n      id: \"spinner\" + id\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1465,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"canvas\", {\n      className: \"canvas\",\n      id: \"canvas\" + id\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1466,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 1462,\n    columnNumber: 9\n  }, this);\n}\n_s2(GaussianViewer, \"OD7bBpZva5O2jO+Puf00hKivP7c=\");\n_c = GaussianViewer;\n;\nvar _c;\n$RefreshReg$(_c, \"GaussianViewer\");","map":{"version":3,"names":["React","Component","useEffect","jsxDEV","_jsxDEV","cameras","id","img_name","width","height","position","rotation","fy","fx","camera","getProjectionMatrix","znear","zfar","flat","getViewMatrix","R","t","camToWorld","multiply4","a","b","invert4","b00","b01","b02","b03","b04","b05","b06","b07","b08","b09","b10","b11","det","rotate4","rad","x","y","z","len","Math","hypot","s","sin","c","cos","b12","b20","b21","b22","slice","translate4","createWorker","self","buffer","vertexCount","viewProj","rowLength","lastProj","depthIndex","Uint32Array","lastVertexCount","_floatView","Float32Array","_int32View","Int32Array","floatToHalf","float","f","sign","exp","frac","newExp","packHalf2x16","generateTexture","f_buffer","u_buffer","Uint8Array","texwidth","texheight","ceil","texdata","texdata_c","texdata_f","i","scale","rot","M","map","k","floor","sigma","postMessage","runSort","dot","abs","maxDepth","Infinity","minDepth","sizeList","depth","depthInv","counts0","starts0","processPlyBuffer","inputBuffer","ubuf","header","TextDecoder","decode","header_end","header_end_index","indexOf","Error","parseInt","exec","console","log","row_offset","offsets","types","TYPE_MAP","double","int","uint","short","ushort","uchar","prop","split","filter","startsWith","p","type","name","arrayType","replace","dataView","DataView","length","row","attrs","Proxy","get","target","time","sizeIndex","size","scale_0","scale_1","scale_2","opacity","timeEnd","sort","ArrayBuffer","j","scales","rgba","Uint8ClampedArray","qlen","sqrt","rot_0","rot_1","rot_2","rot_3","SH_C0","f_dc_0","f_dc_1","f_dc_2","red","green","blue","throttledSort","sortRunning","lastView","setTimeout","onmessage","e","data","ply","byteLength","view","vertexShaderSource","trim","fragmentShaderSource","defaultViewMatrix","viewMatrix","main","source","_s","carousel","params","URLSearchParams","window","location","search","JSON","parse","decodeURIComponent","hash","err","url","URL","req","fetch","mode","credentials","status","reader","body","getReader","splatData","headers","downsample","devicePixelRatio","worker","Worker","createObjectURL","Blob","toString","canvas","document","getElementById","projectionMatrix","gl","getContext","antialias","vertexShader","createShader","VERTEX_SHADER","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","error","getShaderInfoLog","fragmentShader","FRAGMENT_SHADER","program","createProgram","attachShader","linkProgram","useProgram","getProgramParameter","LINK_STATUS","getProgramInfoLog","disable","DEPTH_TEST","enable","BLEND","blendFuncSeparate","ONE_MINUS_DST_ALPHA","ONE","blendEquationSeparate","FUNC_ADD","u_projection","getUniformLocation","u_viewport","u_focal","u_view","triangleVertices","vertexBuffer","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","STATIC_DRAW","a_position","getAttribLocation","enableVertexAttribArray","vertexAttribPointer","FLOAT","texture","createTexture","bindTexture","TEXTURE_2D","u_textureLocation","uniform1i","indexBuffer","a_index","vertexAttribIPointer","INT","vertexAttribDivisor","resize","uniform2fv","innerWidth","innerHeight","round","viewport","uniformMatrix4fv","addEventListener","blob","link","createElement","download","href","appendChild","click","texParameteri","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","TEXTURE_MIN_FILTER","NEAREST","TEXTURE_MAG_FILTER","texImage2D","RGBA32UI","RGBA_INTEGER","UNSIGNED_INT","activeTexture","TEXTURE0","DYNAMIC_DRAW","activeKeys","currentCameraIndex","includes","code","push","test","key","startX","startY","down","preventDefault","clientX","clientY","ctrlKey","metaKey","inv","dx","dy","d","altX","altY","touches","passive","dtheta","atan2","dscale","jumpDelta","lastFrame","start","gp","navigator","getGamepads","gamepad","index","buttons","axes","leftGamepadTrigger","rightGamepadTrigger","frame","now","shiftKey","gamepads","isJumping","axisThreshold","moveSpeed","rotateSpeed","pressed","tiltAxis","value","some","Date","min","max","inv2","actualViewMatrix","style","display","clear","COLOR_BUFFER_BIT","drawArraysInstanced","TRIANGLE_FAN","progress","requestAnimationFrame","selectFile","file","fr","FileReader","onload","result","readAsText","stopLoading","readAsArrayBuffer","stopPropagation","dataTransfer","files","bytesRead","done","read","set","catch","GaussianViewer","_s2","children","className","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["/home/luka/Documents/21t/21t_software/CV_website/cv-website/src/components/gaussian.js"],"sourcesContent":["import React, {Component, useEffect} from \"react\";\nimport \"./gaussian.css\";\n\nlet cameras = [\n    {\n        id: 0,\n        img_name: \"00001\",\n        width: 1959,\n        height: 1090,\n        position: [\n            -3.0089893469241797, -0.11086489695181866, -3.7527640949141428,\n        ],\n        rotation: [\n            [0.876134201218856, 0.06925962026449776, 0.47706599800804744],\n            [-0.04747421839895102, 0.9972110940209488, -0.057586739349882114],\n            [-0.4797239414934443, 0.027805376500959853, 0.8769787916452908],\n        ],\n        fy: 1164.6601287484507,\n        fx: 1159.5880733038064,\n    },\n    {\n        id: 1,\n        img_name: \"00009\",\n        width: 1959,\n        height: 1090,\n        position: [\n            -2.5199776022057296, -0.09704735754873686, -3.6247725540304545,\n        ],\n        rotation: [\n            [0.9982731285632193, -0.011928707708098955, -0.05751927260507243],\n            [0.0065061360949636325, 0.9955928229282383, -0.09355533724430458],\n            [0.058381769258182864, 0.09301955098900708, 0.9939511719154457],\n        ],\n        fy: 1164.6601287484507,\n        fx: 1159.5880733038064,\n    },\n    {\n        id: 2,\n        img_name: \"00017\",\n        width: 1959,\n        height: 1090,\n        position: [\n            -0.7737533667465242, -0.3364271945329695, -2.9358969417573753,\n        ],\n        rotation: [\n            [0.9998813418672372, 0.013742375651625236, -0.0069605529394208224],\n            [-0.014268370388586709, 0.996512943252834, -0.08220929105659476],\n            [0.00580653013657589, 0.08229885200307129, 0.9965907801935302],\n        ],\n        fy: 1164.6601287484507,\n        fx: 1159.5880733038064,\n    },\n    {\n        id: 3,\n        img_name: \"00025\",\n        width: 1959,\n        height: 1090,\n        position: [\n            1.2198221749590001, -0.2196687861401182, -2.3183162007028453,\n        ],\n        rotation: [\n            [0.9208648867765482, 0.0012010625395201253, 0.389880004297208],\n            [-0.06298204172269357, 0.987319521752825, 0.14571693239364383],\n            [-0.3847611242348369, -0.1587410451475895, 0.9092635249821667],\n        ],\n        fy: 1164.6601287484507,\n        fx: 1159.5880733038064,\n    },\n    {\n        id: 4,\n        img_name: \"00033\",\n        width: 1959,\n        height: 1090,\n        position: [\n            1.742387858893817, -0.13848225198886954, -2.0566370113193146,\n        ],\n        rotation: [\n            [0.24669889292141334, -0.08370189346592856, -0.9654706879349405],\n            [0.11343747891376445, 0.9919082664242816, -0.05700815184573074],\n            [0.9624300466054861, -0.09545671285663988, 0.2541976029815521],\n        ],\n        fy: 1164.6601287484507,\n        fx: 1159.5880733038064,\n    },\n    {\n        id: 5,\n        img_name: \"00041\",\n        width: 1959,\n        height: 1090,\n        position: [\n            3.6567309419223935, -0.16470990600750707, -1.3458085590422042,\n        ],\n        rotation: [\n            [0.2341293058324528, -0.02968330457755884, -0.9717522161434825],\n            [0.10270823606832301, 0.99469554638321, -0.005638106875665722],\n            [0.9667649592295676, -0.09848690996657204, 0.2359360976431732],\n        ],\n        fy: 1164.6601287484507,\n        fx: 1159.5880733038064,\n    },\n    {\n        id: 6,\n        img_name: \"00049\",\n        width: 1959,\n        height: 1090,\n        position: [\n            3.9013554243203497, -0.2597500978038105, -0.8106154188297828,\n        ],\n        rotation: [\n            [0.6717235545638952, -0.015718162115524837, -0.7406351366386528],\n            [0.055627354673906296, 0.9980224478387622, 0.029270992841185218],\n            [0.7387104058127439, -0.060861588786650656, 0.6712695459756353],\n        ],\n        fy: 1164.6601287484507,\n        fx: 1159.5880733038064,\n    },\n    {\n        id: 7,\n        img_name: \"00057\",\n        width: 1959,\n        height: 1090,\n        position: [4.742994605467533, -0.05591660945412069, 0.9500365976084458],\n        rotation: [\n            [-0.17042655709210375, 0.01207080756938, -0.9852964448542146],\n            [0.1165090336695526, 0.9931575292530063, -0.00798543433078162],\n            [0.9784581921120181, -0.1161568667478904, -0.1706667764862097],\n        ],\n        fy: 1164.6601287484507,\n        fx: 1159.5880733038064,\n    },\n    {\n        id: 8,\n        img_name: \"00065\",\n        width: 1959,\n        height: 1090,\n        position: [4.34676307626522, 0.08168160516967145, 1.0876221470355405],\n        rotation: [\n            [-0.003575447631888379, -0.044792503246552894, -0.9989899137764799],\n            [0.10770152645126597, 0.9931680875192705, -0.04491693593046672],\n            [0.9941768441149182, -0.10775333677534978, 0.0012732004866391048],\n        ],\n        fy: 1164.6601287484507,\n        fx: 1159.5880733038064,\n    },\n    {\n        id: 9,\n        img_name: \"00073\",\n        width: 1959,\n        height: 1090,\n        position: [3.264984351114202, 0.078974937336732, 1.0117200284114904],\n        rotation: [\n            [-0.026919994628162257, -0.1565891128261527, -0.9872968974090509],\n            [0.08444552208239385, 0.983768234577625, -0.1583319754069128],\n            [0.9960643893290491, -0.0876350978794554, -0.013259786205163005],\n        ],\n        fy: 1164.6601287484507,\n        fx: 1159.5880733038064,\n    },\n];\n\nlet camera = cameras[0];\n\nfunction getProjectionMatrix(fx, fy, width, height) {\n    const znear = 0.2;\n    const zfar = 200;\n    return [\n        [(2 * fx) / width, 0, 0, 0],\n        [0, -(2 * fy) / height, 0, 0],\n        [0, 0, zfar / (zfar - znear), 1],\n        [0, 0, -(zfar * znear) / (zfar - znear), 0],\n    ].flat();\n}\n\nfunction getViewMatrix(camera) {\n    const R = camera.rotation.flat();\n    const t = camera.position;\n    const camToWorld = [\n        [R[0], R[1], R[2], 0],\n        [R[3], R[4], R[5], 0],\n        [R[6], R[7], R[8], 0],\n        [\n            -t[0] * R[0] - t[1] * R[3] - t[2] * R[6],\n            -t[0] * R[1] - t[1] * R[4] - t[2] * R[7],\n            -t[0] * R[2] - t[1] * R[5] - t[2] * R[8],\n            1,\n        ],\n    ].flat();\n    return camToWorld;\n}\n// function translate4(a, x, y, z) {\n//     return [\n//         ...a.slice(0, 12),\n//         a[0] * x + a[4] * y + a[8] * z + a[12],\n//         a[1] * x + a[5] * y + a[9] * z + a[13],\n//         a[2] * x + a[6] * y + a[10] * z + a[14],\n//         a[3] * x + a[7] * y + a[11] * z + a[15],\n//     ];\n// }\n\nfunction multiply4(a, b) {\n    return [\n        b[0] * a[0] + b[1] * a[4] + b[2] * a[8] + b[3] * a[12],\n        b[0] * a[1] + b[1] * a[5] + b[2] * a[9] + b[3] * a[13],\n        b[0] * a[2] + b[1] * a[6] + b[2] * a[10] + b[3] * a[14],\n        b[0] * a[3] + b[1] * a[7] + b[2] * a[11] + b[3] * a[15],\n        b[4] * a[0] + b[5] * a[4] + b[6] * a[8] + b[7] * a[12],\n        b[4] * a[1] + b[5] * a[5] + b[6] * a[9] + b[7] * a[13],\n        b[4] * a[2] + b[5] * a[6] + b[6] * a[10] + b[7] * a[14],\n        b[4] * a[3] + b[5] * a[7] + b[6] * a[11] + b[7] * a[15],\n        b[8] * a[0] + b[9] * a[4] + b[10] * a[8] + b[11] * a[12],\n        b[8] * a[1] + b[9] * a[5] + b[10] * a[9] + b[11] * a[13],\n        b[8] * a[2] + b[9] * a[6] + b[10] * a[10] + b[11] * a[14],\n        b[8] * a[3] + b[9] * a[7] + b[10] * a[11] + b[11] * a[15],\n        b[12] * a[0] + b[13] * a[4] + b[14] * a[8] + b[15] * a[12],\n        b[12] * a[1] + b[13] * a[5] + b[14] * a[9] + b[15] * a[13],\n        b[12] * a[2] + b[13] * a[6] + b[14] * a[10] + b[15] * a[14],\n        b[12] * a[3] + b[13] * a[7] + b[14] * a[11] + b[15] * a[15],\n    ];\n}\n\nfunction invert4(a) {\n    let b00 = a[0] * a[5] - a[1] * a[4];\n    let b01 = a[0] * a[6] - a[2] * a[4];\n    let b02 = a[0] * a[7] - a[3] * a[4];\n    let b03 = a[1] * a[6] - a[2] * a[5];\n    let b04 = a[1] * a[7] - a[3] * a[5];\n    let b05 = a[2] * a[7] - a[3] * a[6];\n    let b06 = a[8] * a[13] - a[9] * a[12];\n    let b07 = a[8] * a[14] - a[10] * a[12];\n    let b08 = a[8] * a[15] - a[11] * a[12];\n    let b09 = a[9] * a[14] - a[10] * a[13];\n    let b10 = a[9] * a[15] - a[11] * a[13];\n    let b11 = a[10] * a[15] - a[11] * a[14];\n    let det =\n        b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n    if (!det) return null;\n    return [\n        (a[5] * b11 - a[6] * b10 + a[7] * b09) / det,\n        (a[2] * b10 - a[1] * b11 - a[3] * b09) / det,\n        (a[13] * b05 - a[14] * b04 + a[15] * b03) / det,\n        (a[10] * b04 - a[9] * b05 - a[11] * b03) / det,\n        (a[6] * b08 - a[4] * b11 - a[7] * b07) / det,\n        (a[0] * b11 - a[2] * b08 + a[3] * b07) / det,\n        (a[14] * b02 - a[12] * b05 - a[15] * b01) / det,\n        (a[8] * b05 - a[10] * b02 + a[11] * b01) / det,\n        (a[4] * b10 - a[5] * b08 + a[7] * b06) / det,\n        (a[1] * b08 - a[0] * b10 - a[3] * b06) / det,\n        (a[12] * b04 - a[13] * b02 + a[15] * b00) / det,\n        (a[9] * b02 - a[8] * b04 - a[11] * b00) / det,\n        (a[5] * b07 - a[4] * b09 - a[6] * b06) / det,\n        (a[0] * b09 - a[1] * b07 + a[2] * b06) / det,\n        (a[13] * b01 - a[12] * b03 - a[14] * b00) / det,\n        (a[8] * b03 - a[9] * b01 + a[10] * b00) / det,\n    ];\n}\n\nfunction rotate4(a, rad, x, y, z) {\n    let len = Math.hypot(x, y, z);\n    x /= len;\n    y /= len;\n    z /= len;\n    let s = Math.sin(rad);\n    let c = Math.cos(rad);\n    let t = 1 - c;\n    let b00 = x * x * t + c;\n    let b01 = y * x * t + z * s;\n    let b02 = z * x * t - y * s;\n    let b10 = x * y * t - z * s;\n    let b11 = y * y * t + c;\n    let b12 = z * y * t + x * s;\n    let b20 = x * z * t + y * s;\n    let b21 = y * z * t - x * s;\n    let b22 = z * z * t + c;\n    return [\n        a[0] * b00 + a[4] * b01 + a[8] * b02,\n        a[1] * b00 + a[5] * b01 + a[9] * b02,\n        a[2] * b00 + a[6] * b01 + a[10] * b02,\n        a[3] * b00 + a[7] * b01 + a[11] * b02,\n        a[0] * b10 + a[4] * b11 + a[8] * b12,\n        a[1] * b10 + a[5] * b11 + a[9] * b12,\n        a[2] * b10 + a[6] * b11 + a[10] * b12,\n        a[3] * b10 + a[7] * b11 + a[11] * b12,\n        a[0] * b20 + a[4] * b21 + a[8] * b22,\n        a[1] * b20 + a[5] * b21 + a[9] * b22,\n        a[2] * b20 + a[6] * b21 + a[10] * b22,\n        a[3] * b20 + a[7] * b21 + a[11] * b22,\n        ...a.slice(12, 16),\n    ];\n}\n\nfunction translate4(a, x, y, z) {\n    return [\n        ...a.slice(0, 12),\n        a[0] * x + a[4] * y + a[8] * z + a[12],\n        a[1] * x + a[5] * y + a[9] * z + a[13],\n        a[2] * x + a[6] * y + a[10] * z + a[14],\n        a[3] * x + a[7] * y + a[11] * z + a[15],\n    ];\n}\n\nfunction createWorker(self) {\n    let buffer;\n    let vertexCount = 0;\n    let viewProj;\n    // 6*4 + 4 + 4 = 8*4\n    // XYZ - Position (Float32)\n    // XYZ - Scale (Float32)\n    // RGBA - colors (uint8)\n    // IJKL - quaternion/rot (uint8)\n    const rowLength = 3 * 4 + 3 * 4 + 4 + 4;\n    let lastProj = [];\n    let depthIndex = new Uint32Array();\n    let lastVertexCount = 0;\n\n    var _floatView = new Float32Array(1);\n    var _int32View = new Int32Array(_floatView.buffer);\n\n    function floatToHalf(float) {\n        _floatView[0] = float;\n        var f = _int32View[0];\n\n        var sign = (f >> 31) & 0x0001;\n        var exp = (f >> 23) & 0x00ff;\n        var frac = f & 0x007fffff;\n\n        var newExp;\n        if (exp == 0) {\n            newExp = 0;\n        } else if (exp < 113) {\n            newExp = 0;\n            frac |= 0x00800000;\n            frac = frac >> (113 - exp);\n            if (frac & 0x01000000) {\n                newExp = 1;\n                frac = 0;\n            }\n        } else if (exp < 142) {\n            newExp = exp - 112;\n        } else {\n            newExp = 31;\n            frac = 0;\n        }\n\n        return (sign << 15) | (newExp << 10) | (frac >> 13);\n    }\n\n    function packHalf2x16(x, y) {\n        return (floatToHalf(x) | (floatToHalf(y) << 16)) >>> 0;\n    }\n\n    function generateTexture() {\n        if (!buffer) return;\n        const f_buffer = new Float32Array(buffer);\n        const u_buffer = new Uint8Array(buffer);\n\n        var texwidth = 1024 * 2; // Set to your desired width\n        var texheight = Math.ceil((2 * vertexCount) / texwidth); // Set to your desired height\n        var texdata = new Uint32Array(texwidth * texheight * 4); // 4 components per pixel (RGBA)\n        var texdata_c = new Uint8Array(texdata.buffer);\n        var texdata_f = new Float32Array(texdata.buffer);\n\n        // Here we convert from a .splat file buffer into a texture\n        // With a little bit more foresight perhaps this texture file\n        // should have been the native format as it'd be very easy to\n        // load it into webgl.\n        for (let i = 0; i < vertexCount; i++) {\n            // x, y, z\n            texdata_f[8 * i + 0] = f_buffer[8 * i + 0];\n            texdata_f[8 * i + 1] = f_buffer[8 * i + 1];\n            texdata_f[8 * i + 2] = f_buffer[8 * i + 2];\n\n            // r, g, b, a\n            texdata_c[4 * (8 * i + 7) + 0] = u_buffer[32 * i + 24 + 0];\n            texdata_c[4 * (8 * i + 7) + 1] = u_buffer[32 * i + 24 + 1];\n            texdata_c[4 * (8 * i + 7) + 2] = u_buffer[32 * i + 24 + 2];\n            texdata_c[4 * (8 * i + 7) + 3] = u_buffer[32 * i + 24 + 3];\n\n            // quaternions\n            let scale = [\n                f_buffer[8 * i + 3 + 0],\n                f_buffer[8 * i + 3 + 1],\n                f_buffer[8 * i + 3 + 2],\n            ];\n            let rot = [\n                (u_buffer[32 * i + 28 + 0] - 128) / 128,\n                (u_buffer[32 * i + 28 + 1] - 128) / 128,\n                (u_buffer[32 * i + 28 + 2] - 128) / 128,\n                (u_buffer[32 * i + 28 + 3] - 128) / 128,\n            ];\n\n            // Compute the matrix product of S and R (M = S * R)\n            const M = [\n                1.0 - 2.0 * (rot[2] * rot[2] + rot[3] * rot[3]),\n                2.0 * (rot[1] * rot[2] + rot[0] * rot[3]),\n                2.0 * (rot[1] * rot[3] - rot[0] * rot[2]),\n\n                2.0 * (rot[1] * rot[2] - rot[0] * rot[3]),\n                1.0 - 2.0 * (rot[1] * rot[1] + rot[3] * rot[3]),\n                2.0 * (rot[2] * rot[3] + rot[0] * rot[1]),\n\n                2.0 * (rot[1] * rot[3] + rot[0] * rot[2]),\n                2.0 * (rot[2] * rot[3] - rot[0] * rot[1]),\n                1.0 - 2.0 * (rot[1] * rot[1] + rot[2] * rot[2]),\n            ].map((k, i) => k * scale[Math.floor(i / 3)]);\n\n            const sigma = [\n                M[0] * M[0] + M[3] * M[3] + M[6] * M[6],\n                M[0] * M[1] + M[3] * M[4] + M[6] * M[7],\n                M[0] * M[2] + M[3] * M[5] + M[6] * M[8],\n                M[1] * M[1] + M[4] * M[4] + M[7] * M[7],\n                M[1] * M[2] + M[4] * M[5] + M[7] * M[8],\n                M[2] * M[2] + M[5] * M[5] + M[8] * M[8],\n            ];\n\n            texdata[8 * i + 4] = packHalf2x16(4 * sigma[0], 4 * sigma[1]);\n            texdata[8 * i + 5] = packHalf2x16(4 * sigma[2], 4 * sigma[3]);\n            texdata[8 * i + 6] = packHalf2x16(4 * sigma[4], 4 * sigma[5]);\n        }\n\n        self.postMessage({ texdata, texwidth, texheight }, [texdata.buffer]);\n    }\n\n    function runSort(viewProj) {\n        if (!buffer) return;\n        const f_buffer = new Float32Array(buffer);\n        if (lastVertexCount == vertexCount) {\n            let dot =\n                lastProj[2] * viewProj[2] +\n                lastProj[6] * viewProj[6] +\n                lastProj[10] * viewProj[10];\n            if (Math.abs(dot - 1) < 0.01) {\n                return;\n            }\n        } else {\n            generateTexture();\n            lastVertexCount = vertexCount;\n        }\n\n        // console.time(\"sort\");\n        let maxDepth = -Infinity;\n        let minDepth = Infinity;\n        let sizeList = new Int32Array(vertexCount);\n        for (let i = 0; i < vertexCount; i++) {\n            let depth =\n                ((viewProj[2] * f_buffer[8 * i + 0] +\n                    viewProj[6] * f_buffer[8 * i + 1] +\n                    viewProj[10] * f_buffer[8 * i + 2]) *\n                    4096) |\n                0;\n            sizeList[i] = depth;\n            if (depth > maxDepth) maxDepth = depth;\n            if (depth < minDepth) minDepth = depth;\n        }\n\n        // This is a 16 bit single-pass counting sort\n        let depthInv = (256 * 256) / (maxDepth - minDepth);\n        let counts0 = new Uint32Array(256 * 256);\n        for (let i = 0; i < vertexCount; i++) {\n            sizeList[i] = ((sizeList[i] - minDepth) * depthInv) | 0;\n            counts0[sizeList[i]]++;\n        }\n        let starts0 = new Uint32Array(256 * 256);\n        for (let i = 1; i < 256 * 256; i++)\n            starts0[i] = starts0[i - 1] + counts0[i - 1];\n        depthIndex = new Uint32Array(vertexCount);\n        for (let i = 0; i < vertexCount; i++)\n            depthIndex[starts0[sizeList[i]]++] = i;\n\n        // console.timeEnd(\"sort\");\n\n        lastProj = viewProj;\n        self.postMessage({ depthIndex, viewProj, vertexCount }, [\n            depthIndex.buffer,\n        ]);\n    }\n\n    function processPlyBuffer(inputBuffer) {\n        const ubuf = new Uint8Array(inputBuffer);\n        // 10KB ought to be enough for a header...\n        const header = new TextDecoder().decode(ubuf.slice(0, 1024 * 10));\n        const header_end = \"end_header\\n\";\n        const header_end_index = header.indexOf(header_end);\n        if (header_end_index < 0)\n            throw new Error(\"Unable to read .ply file header\");\n        const vertexCount = parseInt(/element vertex (\\d+)\\n/.exec(header)[1]);\n        console.log(\"Vertex Count\", vertexCount);\n        let row_offset = 0,\n            offsets = {},\n            types = {};\n        const TYPE_MAP = {\n            double: \"getFloat64\",\n            int: \"getInt32\",\n            uint: \"getUint32\",\n            float: \"getFloat32\",\n            short: \"getInt16\",\n            ushort: \"getUint16\",\n            uchar: \"getUint8\",\n        };\n        for (let prop of header\n            .slice(0, header_end_index)\n            .split(\"\\n\")\n            .filter((k) => k.startsWith(\"property \"))) {\n            const [p, type, name] = prop.split(\" \");\n            const arrayType = TYPE_MAP[type] || \"getInt8\";\n            types[name] = arrayType;\n            offsets[name] = row_offset;\n            row_offset += parseInt(arrayType.replace(/[^\\d]/g, \"\")) / 8;\n        }\n        console.log(\"Bytes per row\", row_offset, types, offsets);\n\n        let dataView = new DataView(\n            inputBuffer,\n            header_end_index + header_end.length,\n        );\n        let row = 0;\n        const attrs = new Proxy(\n            {},\n            {\n                get(target, prop) {\n                    if (!types[prop]) throw new Error(prop + \" not found\");\n                    return dataView[types[prop]](\n                        row * row_offset + offsets[prop],\n                        true,\n                    );\n                },\n            },\n        );\n\n        console.time(\"calculate importance\");\n        let sizeList = new Float32Array(vertexCount);\n        let sizeIndex = new Uint32Array(vertexCount);\n        for (row = 0; row < vertexCount; row++) {\n            sizeIndex[row] = row;\n            if (!types[\"scale_0\"]) continue;\n            const size =\n                Math.exp(attrs.scale_0) *\n                Math.exp(attrs.scale_1) *\n                Math.exp(attrs.scale_2);\n            const opacity = 1 / (1 + Math.exp(-attrs.opacity));\n            sizeList[row] = size * opacity;\n        }\n        console.timeEnd(\"calculate importance\");\n\n        console.time(\"sort\");\n        sizeIndex.sort((b, a) => sizeList[a] - sizeList[b]);\n        console.timeEnd(\"sort\");\n\n        // 6*4 + 4 + 4 = 8*4\n        // XYZ - Position (Float32)\n        // XYZ - Scale (Float32)\n        // RGBA - colors (uint8)\n        // IJKL - quaternion/rot (uint8)\n        const rowLength = 3 * 4 + 3 * 4 + 4 + 4;\n        const buffer = new ArrayBuffer(rowLength * vertexCount);\n\n        console.time(\"build buffer\");\n        for (let j = 0; j < vertexCount; j++) {\n            row = sizeIndex[j];\n\n            const position = new Float32Array(buffer, j * rowLength, 3);\n            const scales = new Float32Array(buffer, j * rowLength + 4 * 3, 3);\n            const rgba = new Uint8ClampedArray(\n                buffer,\n                j * rowLength + 4 * 3 + 4 * 3,\n                4,\n            );\n            const rot = new Uint8ClampedArray(\n                buffer,\n                j * rowLength + 4 * 3 + 4 * 3 + 4,\n                4,\n            );\n\n            if (types[\"scale_0\"]) {\n                const qlen = Math.sqrt(\n                    attrs.rot_0 ** 2 +\n                        attrs.rot_1 ** 2 +\n                        attrs.rot_2 ** 2 +\n                        attrs.rot_3 ** 2,\n                );\n\n                rot[0] = (attrs.rot_0 / qlen) * 128 + 128;\n                rot[1] = (attrs.rot_1 / qlen) * 128 + 128;\n                rot[2] = (attrs.rot_2 / qlen) * 128 + 128;\n                rot[3] = (attrs.rot_3 / qlen) * 128 + 128;\n\n                scales[0] = Math.exp(attrs.scale_0);\n                scales[1] = Math.exp(attrs.scale_1);\n                scales[2] = Math.exp(attrs.scale_2);\n            } else {\n                scales[0] = 0.01;\n                scales[1] = 0.01;\n                scales[2] = 0.01;\n\n                rot[0] = 255;\n                rot[1] = 0;\n                rot[2] = 0;\n                rot[3] = 0;\n            }\n\n            position[0] = attrs.x;\n            position[1] = attrs.y;\n            position[2] = attrs.z;\n\n            if (types[\"f_dc_0\"]) {\n                const SH_C0 = 0.28209479177387814;\n                rgba[0] = (0.5 + SH_C0 * attrs.f_dc_0) * 255;\n                rgba[1] = (0.5 + SH_C0 * attrs.f_dc_1) * 255;\n                rgba[2] = (0.5 + SH_C0 * attrs.f_dc_2) * 255;\n            } else {\n                rgba[0] = attrs.red;\n                rgba[1] = attrs.green;\n                rgba[2] = attrs.blue;\n            }\n            if (types[\"opacity\"]) {\n                rgba[3] = (1 / (1 + Math.exp(-attrs.opacity))) * 255;\n            } else {\n                rgba[3] = 255;\n            }\n        }\n        console.timeEnd(\"build buffer\");\n        return buffer;\n    }\n\n    const throttledSort = () => {\n        if (!sortRunning) {\n            sortRunning = true;\n            let lastView = viewProj;\n            runSort(lastView);\n            setTimeout(() => {\n                sortRunning = false;\n                if (lastView !== viewProj) {\n                    throttledSort();\n                }\n            }, 0);\n        }\n    };\n\n    let sortRunning;\n    self.onmessage = (e) => {\n        if (e.data.ply) {\n            vertexCount = 0;\n            runSort(viewProj);\n            buffer = processPlyBuffer(e.data.ply);\n            vertexCount = Math.floor(buffer.byteLength / rowLength);\n            postMessage({ buffer: buffer });\n        } else if (e.data.buffer) {\n            buffer = e.data.buffer;\n            vertexCount = e.data.vertexCount;\n        } else if (e.data.vertexCount) {\n            vertexCount = e.data.vertexCount;\n        } else if (e.data.view) {\n            viewProj = e.data.view;\n            throttledSort();\n        }\n    };\n}\n\nconst vertexShaderSource = `\n#version 300 es\nprecision highp float;\nprecision highp int;\n\nuniform highp usampler2D u_texture;\nuniform mat4 projection, view;\nuniform vec2 focal;\nuniform vec2 viewport;\n\nin vec2 position;\nin int index;\n\nout vec4 vColor;\nout vec2 vPosition;\n\nvoid main () {\n    uvec4 cen = texelFetch(u_texture, ivec2((uint(index) & 0x3ffu) << 1, uint(index) >> 10), 0);\n    vec4 cam = view * vec4(uintBitsToFloat(cen.xyz), 1);\n    vec4 pos2d = projection * cam;\n\n    float clip = 1.2 * pos2d.w;\n    if (pos2d.z < -clip || pos2d.x < -clip || pos2d.x > clip || pos2d.y < -clip || pos2d.y > clip) {\n        gl_Position = vec4(0.0, 0.0, 2.0, 1.0);\n        return;\n    }\n\n    uvec4 cov = texelFetch(u_texture, ivec2(((uint(index) & 0x3ffu) << 1) | 1u, uint(index) >> 10), 0);\n    vec2 u1 = unpackHalf2x16(cov.x), u2 = unpackHalf2x16(cov.y), u3 = unpackHalf2x16(cov.z);\n    mat3 Vrk = mat3(u1.x, u1.y, u2.x, u1.y, u2.y, u3.x, u2.x, u3.x, u3.y);\n\n    mat3 J = mat3(\n        focal.x / cam.z, 0., -(focal.x * cam.x) / (cam.z * cam.z), \n        0., -focal.y / cam.z, (focal.y * cam.y) / (cam.z * cam.z), \n        0., 0., 0.\n    );\n\n    mat3 T = transpose(mat3(view)) * J;\n    mat3 cov2d = transpose(T) * Vrk * T;\n\n    float mid = (cov2d[0][0] + cov2d[1][1]) / 2.0;\n    float radius = length(vec2((cov2d[0][0] - cov2d[1][1]) / 2.0, cov2d[0][1]));\n    float lambda1 = mid + radius, lambda2 = mid - radius;\n\n    if(lambda2 < 0.0) return;\n    vec2 diagonalVector = normalize(vec2(cov2d[0][1], lambda1 - cov2d[0][0]));\n    vec2 majorAxis = min(sqrt(2.0 * lambda1), 1024.0) * diagonalVector;\n    vec2 minorAxis = min(sqrt(2.0 * lambda2), 1024.0) * vec2(diagonalVector.y, -diagonalVector.x);\n\n    vColor = clamp(pos2d.z/pos2d.w+1.0, 0.0, 1.0) * vec4((cov.w) & 0xffu, (cov.w >> 8) & 0xffu, (cov.w >> 16) & 0xffu, (cov.w >> 24) & 0xffu) / 255.0;\n    vPosition = position;\n\n    vec2 vCenter = vec2(pos2d) / pos2d.w;\n    gl_Position = vec4(\n        vCenter \n        + position.x * majorAxis / viewport \n        + position.y * minorAxis / viewport, 0.0, 1.0);\n\n}\n`.trim();\n\nconst fragmentShaderSource = `\n#version 300 es\nprecision highp float;\n\nin vec4 vColor;\nin vec2 vPosition;\n\nout vec4 fragColor;\n\nvoid main () {\n    float A = -dot(vPosition, vPosition);\n    if (A < -4.0) discard;\n    float B = exp(A) * vColor.a;\n    fragColor = vec4(B * vColor.rgb, B);\n}\n\n`.trim();\n\nlet defaultViewMatrix = [\n    0.47, 0.04, 0.88, 0, -0.11, 0.99, 0.02, 0, -0.88, -0.11, 0.47, 0, 0.07,\n    0.03, 6.55, 1,\n];\nlet viewMatrix = defaultViewMatrix;\n\n\nasync function main(source, id) {\n    let carousel = true;\n    const params = new URLSearchParams(window.location.search);\n    try {\n        viewMatrix = JSON.parse(decodeURIComponent(window.location.hash.slice(1)));\n        carousel = false;\n    } catch (err) {}\n    const url = new URL(\n        source\n    );\n    const req = await fetch(url, {\n        mode: \"cors\", // no-cors, *cors, same-origin\n        credentials: \"omit\", // include, *same-origin, omit\n    });\n    console.log(req);\n    if (req.status != 200)\n        throw new Error(req.status + \" Unable to load \" + req.url);\n\n    const rowLength = 3 * 4 + 3 * 4 + 4 + 4;\n    const reader = req.body.getReader();\n    let splatData = new Uint8Array(req.headers.get(\"content-length\"));\n\n    const downsample =\n        splatData.length / rowLength > 500000 ? 1 : 1 / devicePixelRatio;\n    console.log(splatData.length / rowLength, downsample);\n\n    const worker = new Worker(\n        URL.createObjectURL(\n            new Blob([\"(\", createWorker.toString(), \")(self)\"], {\n                type: \"application/javascript\",\n            }),\n        ),\n    );\n\n    const canvas = document.getElementById(\"canvas\"+id);\n    // const fps = document.getElementById(\"fps\");\n    // const camid = document.getElementById(\"camid\");\n\n    let projectionMatrix;\n\n    const gl = canvas.getContext(\"webgl2\", {\n        antialias: false,\n    });\n\n    const vertexShader = gl.createShader(gl.VERTEX_SHADER);\n    gl.shaderSource(vertexShader, vertexShaderSource);\n    gl.compileShader(vertexShader);\n    if (!gl.getShaderParameter(vertexShader, gl.COMPILE_STATUS))\n        console.error(gl.getShaderInfoLog(vertexShader));\n\n    const fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);\n    gl.shaderSource(fragmentShader, fragmentShaderSource);\n    gl.compileShader(fragmentShader);\n    if (!gl.getShaderParameter(fragmentShader, gl.COMPILE_STATUS))\n        console.error(gl.getShaderInfoLog(fragmentShader));\n\n    const program = gl.createProgram();\n    gl.attachShader(program, vertexShader);\n    gl.attachShader(program, fragmentShader);\n    gl.linkProgram(program);\n    gl.useProgram(program);\n\n    if (!gl.getProgramParameter(program, gl.LINK_STATUS))\n        console.error(gl.getProgramInfoLog(program));\n\n    gl.disable(gl.DEPTH_TEST); // Disable depth testing\n\n    // Enable blending\n    gl.enable(gl.BLEND);\n    gl.blendFuncSeparate(\n        gl.ONE_MINUS_DST_ALPHA,\n        gl.ONE,\n        gl.ONE_MINUS_DST_ALPHA,\n        gl.ONE,\n    );\n    gl.blendEquationSeparate(gl.FUNC_ADD, gl.FUNC_ADD);\n\n    const u_projection = gl.getUniformLocation(program, \"projection\");\n    const u_viewport = gl.getUniformLocation(program, \"viewport\");\n    const u_focal = gl.getUniformLocation(program, \"focal\");\n    const u_view = gl.getUniformLocation(program, \"view\");\n\n    // positions\n    const triangleVertices = new Float32Array([-2, -2, 2, -2, 2, 2, -2, 2]);\n    const vertexBuffer = gl.createBuffer();\n    gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer);\n    gl.bufferData(gl.ARRAY_BUFFER, triangleVertices, gl.STATIC_DRAW);\n    const a_position = gl.getAttribLocation(program, \"position\");\n    gl.enableVertexAttribArray(a_position);\n    gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer);\n    gl.vertexAttribPointer(a_position, 2, gl.FLOAT, false, 0, 0);\n\n    var texture = gl.createTexture();\n    gl.bindTexture(gl.TEXTURE_2D, texture);\n\n    var u_textureLocation = gl.getUniformLocation(program, \"u_texture\");\n    gl.uniform1i(u_textureLocation, 0);\n\n    const indexBuffer = gl.createBuffer();\n    const a_index = gl.getAttribLocation(program, \"index\");\n    gl.enableVertexAttribArray(a_index);\n    gl.bindBuffer(gl.ARRAY_BUFFER, indexBuffer);\n    gl.vertexAttribIPointer(a_index, 1, gl.INT, false, 0, 0);\n    gl.vertexAttribDivisor(a_index, 1);\n\n    const resize = () => {\n        gl.uniform2fv(u_focal, new Float32Array([camera.fx, camera.fy]));\n\n        projectionMatrix = getProjectionMatrix(\n            camera.fx,\n            camera.fy,\n            window.innerWidth,\n            window.innerHeight,\n        );\n\n        gl.uniform2fv(u_viewport, new Float32Array([window.innerWidth, window.innerHeight]));\n\n        gl.canvas.width = Math.round(window.innerWidth / downsample);\n        gl.canvas.height = Math.round(window.innerHeight / downsample);\n        gl.viewport(0, 0, gl.canvas.width, gl.canvas.height);\n\n        gl.uniformMatrix4fv(u_projection, false, projectionMatrix);\n    };\n\n    window.addEventListener(\"resize\", resize);\n    resize();\n\n    worker.onmessage = (e) => {\n        if (e.data.buffer) {\n            splatData = new Uint8Array(e.data.buffer);\n            const blob = new Blob([splatData.buffer], {\n                type: \"application/octet-stream\",\n            });\n            const link = document.createElement(\"a\");\n            link.download = \"model.splat\";\n            link.href = URL.createObjectURL(blob);\n            document.body.appendChild(link);\n            link.click();\n        } else if (e.data.texdata) {\n            const { texdata, texwidth, texheight } = e.data;\n            // console.log(texdata)\n            gl.bindTexture(gl.TEXTURE_2D, texture);\n            gl.texParameteri(\n                gl.TEXTURE_2D,\n                gl.TEXTURE_WRAP_S,\n                gl.CLAMP_TO_EDGE,\n            );\n            gl.texParameteri(\n                gl.TEXTURE_2D,\n                gl.TEXTURE_WRAP_T,\n                gl.CLAMP_TO_EDGE,\n            );\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n\n            gl.texImage2D(\n                gl.TEXTURE_2D,\n                0,\n                gl.RGBA32UI,\n                texwidth,\n                texheight,\n                0,\n                gl.RGBA_INTEGER,\n                gl.UNSIGNED_INT,\n                texdata,\n            );\n            gl.activeTexture(gl.TEXTURE0);\n            gl.bindTexture(gl.TEXTURE_2D, texture);\n        } else if (e.data.depthIndex) {\n            const { depthIndex, viewProj } = e.data;\n            gl.bindBuffer(gl.ARRAY_BUFFER, indexBuffer);\n            gl.bufferData(gl.ARRAY_BUFFER, depthIndex, gl.DYNAMIC_DRAW);\n            vertexCount = e.data.vertexCount;\n        }\n    };\n\n    let activeKeys = [];\n\tlet currentCameraIndex = 0;\n\n    window.addEventListener(\"keydown\", (e) => {\n        // if (document.activeElement != document.body) return;\n        carousel = false;\n        if (!activeKeys.includes(e.code)) activeKeys.push(e.code);\n        if (/\\d/.test(e.key)) {\n            currentCameraIndex = parseInt(e.key)\n            camera = cameras[currentCameraIndex];\n            viewMatrix = getViewMatrix(camera);\n        }\n\t\tif (['-', '_'].includes(e.key)){\n\t\t\tcurrentCameraIndex = (currentCameraIndex + cameras.length - 1) % cameras.length;\n\t\t\tviewMatrix = getViewMatrix(cameras[currentCameraIndex]);\n\t\t}\n\t\tif (['+', '='].includes(e.key)){\n\t\t\tcurrentCameraIndex = (currentCameraIndex + 1) % cameras.length;\n\t\t\tviewMatrix = getViewMatrix(cameras[currentCameraIndex]);\n\t\t}\n        // camid.innerText = \"cam  \" + currentCameraIndex;\n        // if (e.code == \"KeyV\") {\n        //     location.hash =\n        //         \"#\" +\n        //         JSON.stringify(\n        //             viewMatrix.map((k) => Math.round(k * 100) / 100),\n        //         );\n        //         camid.innerText =\"\"\n        // } else if (e.code === \"KeyP\") {\n        //     carousel = true;\n        //     camid.innerText =\"\"\n        // }\n    });\n    window.addEventListener(\"keyup\", (e) => {\n        activeKeys = activeKeys.filter((k) => k !== e.code);\n    });\n    window.addEventListener(\"blur\", () => {\n        activeKeys = [];\n    });\n\n    // window.addEventListener(\n    //     \"wheel\",\n    //     (e) => {\n    //         carousel = false;\n    //         e.preventDefault();\n    //         const lineHeight = 10;\n    //         const scale =\n    //             e.deltaMode == 1\n    //                 ? lineHeight\n    //                 : e.deltaMode == 2\n    //                 ? innerHeight\n    //                 : 1;\n    //         let inv = invert4(viewMatrix);\n    //         if (e.shiftKey) {\n    //             inv = translate4(\n    //                 inv,\n    //                 (e.deltaX * scale) / innerWidth,\n    //                 (e.deltaY * scale) / innerHeight,\n    //                 0,\n    //             );\n    //         } else if (e.ctrlKey || e.metaKey) {\n    //             // inv = rotate4(inv,  (e.deltaX * scale) / innerWidth,  0, 0, 1);\n    //             // inv = translate4(inv,  0, (e.deltaY * scale) / innerHeight, 0);\n    //             // let preY = inv[13];\n    //             inv = translate4(\n    //                 inv,\n    //                 0,\n    //                 0,\n    //                 (-10 * (e.deltaY * scale)) / innerHeight,\n    //             );\n    //             // inv[13] = preY;\n    //         } else {\n    //             let d = 4;\n    //             inv = translate4(inv, 0, 0, d);\n    //             inv = rotate4(inv, -(e.deltaX * scale) / innerWidth, 0, 1, 0);\n    //             inv = rotate4(inv, (e.deltaY * scale) / innerHeight, 1, 0, 0);\n    //             inv = translate4(inv, 0, 0, -d);\n    //         }\n\n    //         viewMatrix = invert4(inv);\n    //     },\n    //     { passive: false },\n    // );\n\n    let startX, startY, down;\n    canvas.addEventListener(\"mousedown\", (e) => {\n        carousel = false;\n        e.preventDefault();\n        startX = e.clientX;\n        startY = e.clientY;\n        down = e.ctrlKey || e.metaKey ? 2 : 1;\n    });\n    canvas.addEventListener(\"contextmenu\", (e) => {\n        carousel = false;\n        e.preventDefault();\n        startX = e.clientX;\n        startY = e.clientY;\n        down = 2;\n    });\n\n    canvas.addEventListener(\"mousemove\", (e) => {\n        e.preventDefault();\n        if (down == 1) {\n            let inv = invert4(viewMatrix);\n            let dx = (5 * (e.clientX - startX)) / window.innerWidth;\n            let dy = (5 * (e.clientY - startY)) / window.innerHeight;\n            let d = 4;\n\n            inv = translate4(inv, 0, 0, d);\n            inv = rotate4(inv, dx, 0, 1, 0);\n            inv = rotate4(inv, -dy, 1, 0, 0);\n            inv = translate4(inv, 0, 0, -d);\n            // let postAngle = Math.atan2(inv[0], inv[10])\n            // inv = rotate4(inv, postAngle - preAngle, 0, 0, 1)\n            // console.log(postAngle)\n            viewMatrix = invert4(inv);\n\n            startX = e.clientX;\n            startY = e.clientY;\n        } else if (down == 2) {\n            let inv = invert4(viewMatrix);\n            // inv = rotateY(inv, );\n            // let preY = inv[13];\n            inv = translate4(\n                inv,\n                (-10 * (e.clientX - startX)) / window.innerWidth,\n                0,\n                (10 * (e.clientY - startY)) / innerHeight,\n            );\n            // inv[13] = preY;\n            viewMatrix = invert4(inv);\n\n            startX = e.clientX;\n            startY = e.clientY;\n        }\n    });\n    canvas.addEventListener(\"mouseup\", (e) => {\n        e.preventDefault();\n        down = false;\n        startX = 0;\n        startY = 0;\n    });\n\n    let altX = 0,\n        altY = 0;\n    canvas.addEventListener(\n        \"touchstart\",\n        (e) => {\n            e.preventDefault();\n            if (e.touches.length === 1) {\n                carousel = false;\n                startX = e.touches[0].clientX;\n                startY = e.touches[0].clientY;\n                down = 1;\n            } else if (e.touches.length === 2) {\n                // console.log('beep')\n                carousel = false;\n                startX = e.touches[0].clientX;\n                altX = e.touches[1].clientX;\n                startY = e.touches[0].clientY;\n                altY = e.touches[1].clientY;\n                down = 1;\n            }\n        },\n        { passive: false },\n    );\n    canvas.addEventListener(\n        \"touchmove\",\n        (e) => {\n            e.preventDefault();\n            if (e.touches.length === 1 && down) {\n                let inv = invert4(viewMatrix);\n                let dx = (4 * (e.touches[0].clientX - startX)) / innerWidth;\n                let dy = (4 * (e.touches[0].clientY - startY)) / innerHeight;\n\n                let d = 4;\n                inv = translate4(inv, 0, 0, d);\n                // inv = translate4(inv,  -x, -y, -z);\n                // inv = translate4(inv,  x, y, z);\n                inv = rotate4(inv, dx, 0, 1, 0);\n                inv = rotate4(inv, -dy, 1, 0, 0);\n                inv = translate4(inv, 0, 0, -d);\n\n                viewMatrix = invert4(inv);\n\n                startX = e.touches[0].clientX;\n                startY = e.touches[0].clientY;\n            } else if (e.touches.length === 2) {\n                // alert('beep')\n                const dtheta =\n                    Math.atan2(startY - altY, startX - altX) -\n                    Math.atan2(\n                        e.touches[0].clientY - e.touches[1].clientY,\n                        e.touches[0].clientX - e.touches[1].clientX,\n                    );\n                const dscale =\n                    Math.hypot(startX - altX, startY - altY) /\n                    Math.hypot(\n                        e.touches[0].clientX - e.touches[1].clientX,\n                        e.touches[0].clientY - e.touches[1].clientY,\n                    );\n                const dx =\n                    (e.touches[0].clientX +\n                        e.touches[1].clientX -\n                        (startX + altX)) /\n                    2;\n                const dy =\n                    (e.touches[0].clientY +\n                        e.touches[1].clientY -\n                        (startY + altY)) /\n                    2;\n                let inv = invert4(viewMatrix);\n                // inv = translate4(inv,  0, 0, d);\n                inv = rotate4(inv, dtheta, 0, 0, 1);\n\n                inv = translate4(inv, -dx / innerWidth, -dy / innerHeight, 0);\n\n                // let preY = inv[13];\n                inv = translate4(inv, 0, 0, 3 * (1 - dscale));\n                // inv[13] = preY;\n\n                viewMatrix = invert4(inv);\n\n                startX = e.touches[0].clientX;\n                altX = e.touches[1].clientX;\n                startY = e.touches[0].clientY;\n                altY = e.touches[1].clientY;\n            }\n        },\n        { passive: false },\n    );\n    canvas.addEventListener(\n        \"touchend\",\n        (e) => {\n            e.preventDefault();\n            down = false;\n            startX = 0;\n            startY = 0;\n        },\n        { passive: false },\n    );\n\n    let jumpDelta = 0;\n    let vertexCount = 0;\n\n    let lastFrame = 0;\n    // let avgFps = 0;\n    let start = 0;\n\n    window.addEventListener(\"gamepadconnected\", (e) => {\n        const gp = navigator.getGamepads()[e.gamepad.index];\n        console.log(\n            `Gamepad connected at index ${gp.index}: ${gp.id}. It has ${gp.buttons.length} buttons and ${gp.axes.length} axes.`,\n        );\n    });\n    window.addEventListener(\"gamepaddisconnected\", (e) => {\n        console.log(\"Gamepad disconnected\");\n    });\n\n    let leftGamepadTrigger, rightGamepadTrigger;\n\n    const frame = (now) => {\n        let inv = invert4(viewMatrix);\n        let shiftKey = activeKeys.includes(\"Shift\") || activeKeys.includes(\"ShiftLeft\") || activeKeys.includes(\"ShiftRight\")\n\n        if (activeKeys.includes(\"ArrowUp\")) {\n            if (shiftKey) {\n                inv = translate4(inv, 0, -0.03, 0);\n            } else {\n                inv = translate4(inv, 0, 0, 0.1);\n            }\n        }\n        if (activeKeys.includes(\"ArrowDown\")) {\n            if (shiftKey) {\n                inv = translate4(inv, 0, 0.03, 0);\n            } else {\n                inv = translate4(inv, 0, 0, -0.1);\n            }\n        }\n        if (activeKeys.includes(\"ArrowLeft\"))\n            inv = translate4(inv, -0.03, 0, 0);\n        //\n        if (activeKeys.includes(\"ArrowRight\"))\n            inv = translate4(inv, 0.03, 0, 0);\n        // inv = rotate4(inv, 0.01, 0, 1, 0);\n        if (activeKeys.includes(\"KeyA\")) inv = rotate4(inv, -0.01, 0, 1, 0);\n        if (activeKeys.includes(\"KeyD\")) inv = rotate4(inv, 0.01, 0, 1, 0);\n        if (activeKeys.includes(\"KeyQ\")) inv = rotate4(inv, 0.01, 0, 0, 1);\n        if (activeKeys.includes(\"KeyE\")) inv = rotate4(inv, -0.01, 0, 0, 1);\n        if (activeKeys.includes(\"KeyW\")) inv = rotate4(inv, 0.005, 1, 0, 0);\n        if (activeKeys.includes(\"KeyS\")) inv = rotate4(inv, -0.005, 1, 0, 0);\n\n        const gamepads = navigator.getGamepads ? navigator.getGamepads() : [];\n        let isJumping = activeKeys.includes(\"Space\");\n        for (let gamepad of gamepads) {\n            if (!gamepad) continue;\n\n            const axisThreshold = 0.1; // Threshold to detect when the axis is intentionally moved\n            const moveSpeed = 0.06;\n            const rotateSpeed = 0.02;\n\n            // Assuming the left stick controls translation (axes 0 and 1)\n            if (Math.abs(gamepad.axes[0]) > axisThreshold) {\n                inv = translate4(inv, moveSpeed * gamepad.axes[0], 0, 0);\n                carousel = false;\n            }\n            if (Math.abs(gamepad.axes[1]) > axisThreshold) {\n                inv = translate4(inv, 0, 0, -moveSpeed * gamepad.axes[1]);\n                carousel = false;\n            }\n            if(gamepad.buttons[12].pressed || gamepad.buttons[13].pressed){\n                inv = translate4(inv, 0, -moveSpeed*(gamepad.buttons[12].pressed - gamepad.buttons[13].pressed), 0);\n                carousel = false;\n            }\n\n            if(gamepad.buttons[14].pressed || gamepad.buttons[15].pressed){\n                inv = translate4(inv, -moveSpeed*(gamepad.buttons[14].pressed - gamepad.buttons[15].pressed), 0, 0);\n                carousel = false;\n            }\n\n            // Assuming the right stick controls rotation (axes 2 and 3)\n            if (Math.abs(gamepad.axes[2]) > axisThreshold) {\n                inv = rotate4(inv, rotateSpeed * gamepad.axes[2], 0, 1, 0);\n                carousel = false;\n            }\n            if (Math.abs(gamepad.axes[3]) > axisThreshold) {\n                inv = rotate4(inv, -rotateSpeed * gamepad.axes[3], 1, 0, 0);\n                carousel = false;\n            }\n\n            let tiltAxis = gamepad.buttons[6].value - gamepad.buttons[7].value;\n            if (Math.abs(tiltAxis) > axisThreshold) {\n                inv = rotate4(inv, rotateSpeed * tiltAxis, 0, 0, 1);\n                carousel = false;\n            }\n            if (gamepad.buttons[4].pressed && !leftGamepadTrigger) {\n                camera = cameras[(cameras.indexOf(camera)+1)%cameras.length]\n                inv = invert4(getViewMatrix(camera));\n                carousel = false;\n            }\n            if (gamepad.buttons[5].pressed && !rightGamepadTrigger) {\n                camera = cameras[(cameras.indexOf(camera)+cameras.length-1)%cameras.length]\n                inv = invert4(getViewMatrix(camera));\n                carousel = false;\n            }\n            leftGamepadTrigger = gamepad.buttons[4].pressed;\n            rightGamepadTrigger = gamepad.buttons[5].pressed;\n            if (gamepad.buttons[0].pressed) {\n                isJumping = true;\n                carousel = false;\n            }\n            if(gamepad.buttons[3].pressed){\n                carousel = true;\n            }\n        }\n\n        if (\n            [\"KeyJ\", \"KeyK\", \"KeyL\", \"KeyI\"].some((k) => activeKeys.includes(k))\n        ) {\n            let d = 4;\n            inv = translate4(inv, 0, 0, d);\n            inv = rotate4(\n                inv,\n                activeKeys.includes(\"KeyJ\")\n                    ? -0.05\n                    : activeKeys.includes(\"KeyL\")\n                    ? 0.05\n                    : 0,\n                0,\n                1,\n                0,\n            );\n            inv = rotate4(\n                inv,\n                activeKeys.includes(\"KeyI\")\n                    ? 0.05\n                    : activeKeys.includes(\"KeyK\")\n                    ? -0.05\n                    : 0,\n                1,\n                0,\n                0,\n            );\n            inv = translate4(inv, 0, 0, -d);\n        }\n\n        viewMatrix = invert4(inv);\n\n        if (carousel) {\n            let inv = invert4(defaultViewMatrix);\n\n            const t = Math.sin((Date.now() - start) / 5000);\n            inv = translate4(inv, 2.5 * t, 0, 6 * (1 - Math.cos(t)));\n            inv = rotate4(inv, -0.6 * t, 0, 1, 0);\n\n            viewMatrix = invert4(inv);\n        }\n\n        if (isJumping) {\n            jumpDelta = Math.min(1, jumpDelta + 0.05);\n        } else {\n            jumpDelta = Math.max(0, jumpDelta - 0.05);\n        }\n\n        let inv2 = invert4(viewMatrix);\n        inv2 = translate4(inv2, 0, -jumpDelta, 0);\n        inv2 = rotate4(inv2, -0.1 * jumpDelta, 1, 0, 0);\n        let actualViewMatrix = invert4(inv2);\n\n        const viewProj = multiply4(projectionMatrix, actualViewMatrix);\n        worker.postMessage({ view: viewProj });\n\n        // const currentFps = 1000 / (now - lastFrame) || 0;\n        // avgFps = avgFps * 0.9 + currentFps * 0.1;\n\n        if (vertexCount > 0) {\n            document.getElementById(\"spinner\"+id).style.display = \"none\";\n            gl.uniformMatrix4fv(u_view, false, actualViewMatrix);\n            gl.clear(gl.COLOR_BUFFER_BIT);\n            gl.drawArraysInstanced(gl.TRIANGLE_FAN, 0, 4, vertexCount);\n        } else {\n            gl.clear(gl.COLOR_BUFFER_BIT);\n            document.getElementById(\"spinner\"+id).style.display = \"\";\n            start = Date.now() + 2000;\n        }\n        const progress = (100 * vertexCount) / (splatData.length / rowLength);\n        if (progress < 100) {\n            document.getElementById(\"progress\"+id).style.width = progress + \"%\";\n        } else {\n            document.getElementById(\"progress\"+id).style.display = \"none\";\n        }\n        // fps.innerText = Math.round(avgFps) + \" fps\";\n        // if (isNaN(currentCameraIndex)){\n        //     camid.innerText = \"\";\n        // }\n        lastFrame = now;\n        requestAnimationFrame(frame);\n    };\n\n    frame();\n\n    const selectFile = (file) => {\n        const fr = new FileReader();\n        if (/\\.json$/i.test(file.name)) {\n            fr.onload = () => {\n                cameras = JSON.parse(fr.result);\n                viewMatrix = getViewMatrix(cameras[0]);\n                projectionMatrix = getProjectionMatrix(\n                    camera.fx / downsample,\n                    camera.fy / downsample,\n                    canvas.width,\n                    canvas.height,\n                );\n                gl.uniformMatrix4fv(u_projection, false, projectionMatrix);\n\n                console.log(\"Loaded Cameras\");\n            };\n            fr.readAsText(file);\n        } else {\n            stopLoading = true;\n            fr.onload = () => {\n                splatData = new Uint8Array(fr.result);\n                console.log(\"Loaded\", Math.floor(splatData.length / rowLength));\n\n                if (\n                    splatData[0] == 112 &&\n                    splatData[1] == 108 &&\n                    splatData[2] == 121 &&\n                    splatData[3] == 10\n                ) {\n                    // ply file magic header means it should be handled differently\n                    worker.postMessage({ ply: splatData.buffer });\n                } else {\n                    worker.postMessage({\n                        buffer: splatData.buffer,\n                        vertexCount: Math.floor(splatData.length / rowLength),\n                    });\n                }\n            };\n            fr.readAsArrayBuffer(file);\n        }\n    };\n\n    window.addEventListener(\"hashchange\", (e) => {\n        try {\n            viewMatrix = JSON.parse(decodeURIComponent(location.hash.slice(1)));\n            carousel = false;\n        } catch (err) {}\n    });\n\n    const preventDefault = (e) => {\n        e.preventDefault();\n        e.stopPropagation();\n    };\n    document.addEventListener(\"dragenter\", preventDefault);\n    document.addEventListener(\"dragover\", preventDefault);\n    document.addEventListener(\"dragleave\", preventDefault);\n    document.addEventListener(\"drop\", (e) => {\n        e.preventDefault();\n        e.stopPropagation();\n        selectFile(e.dataTransfer.files[0]);\n    });\n\n    let bytesRead = 0;\n    let lastVertexCount = -1;\n    let stopLoading = false;\n\n    while (true) {\n        const { done, value } = await reader.read();\n        if (done || stopLoading) break;\n\n        splatData.set(value, bytesRead);\n        bytesRead += value.length;\n\n        if (vertexCount > lastVertexCount) {\n            worker.postMessage({\n                buffer: splatData.buffer,\n                vertexCount: Math.floor(bytesRead / rowLength),\n            });\n            lastVertexCount = vertexCount;\n        }\n    }\n    if (!stopLoading)\n        worker.postMessage({\n            buffer: splatData.buffer,\n            vertexCount: Math.floor(bytesRead / rowLength),\n        });\n}\n\nmain().catch((err) => {\n    // document.getElementById(\"message\").innerText = err.toString();\n});\n\n\n\nexport default function GaussianViewer({id, source}){\n    console.log(source)\n\n    useEffect(() => {\n        main(source,id);\n    });\n    return (\n        <div>\n            <div className=\"progress\" id={\"progress\"+id}></div>\n            <div className=\"message\" id={\"message\"+id}></div>\n            <div className=\"scene\" id={\"spinner\"+id}></div>\n            <canvas className=\"canvas\" id={\"canvas\"+id}></canvas>\n        </div>\n    );\n};"],"mappings":"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,CAAC,CAAC,CAAC,CAAC,GAAGC,CAAC,CAAC,CAAC,CAAC,GAAGD,CAAC,CAAC,EAAE,CAAC,EACtDC,CAAC,CAAC,CAAC,CAAC,GAAGD,CAAC,CAAC,CAAC,CAAC,GAAGC,CAAC,CAAC,CAAC,CAAC,GAAGD,CAAC,CAAC,CAAC,CAAC,GAAGC,CAAC,CAAC,CAAC,CAAC,GAAGD,CAAC,CAAC,EAAE,CAAC,GAAGC,CAAC,CAAC,CAAC,CAAC,GAAGD,CAAC,CAAC,EAAE,CAAC,EACvDC,CAAC,CAAC,CAAC,CAAC,GAAGD,CAAC,CAAC,CAAC,CAAC,GAAGC,CAAC,CAAC,CAAC,CAAC,GAAGD,CAAC,CAAC,CAAC,CAAC,GAAGC,CAAC,CAAC,CAAC,CAAC,GAAGD,CAAC,CAAC,EAAE,CAAC,GAAGC,CAAC,CAAC,CAAC,CAAC,GAAGD,CAAC,CAAC,EAAE,CAAC,EACvDC,CAAC,CAAC,CAAC,CAAC,GAAGD,CAAC,CAAC,CAAC,CAAC,GAAGC,CAAC,CAAC,CAAC,CAAC,GAAGD,CAAC,CAAC,CAAC,CAAC,GAAGC,CAAC,CAAC,CAAC,CAAC,GAAGD,CAAC,CAAC,CAAC,CAAC,GAAGC,CAAC,CAAC,CAAC,CAAC,GAAGD,CAAC,CAAC,EAAE,CAAC,EACtDC,CAAC,CAAC,CAAC,CAAC,GAAGD,CAAC,CAAC,CAAC,CAAC,GAAGC,CAAC,CAAC,CAAC,CAAC,GAAGD,CAAC,CAAC,CAAC,CAAC,GAAGC,CAAC,CAAC,CAAC,CAAC,GAAGD,CAAC,CAAC,CAAC,CAAC,GAAGC,CAAC,CAAC,CAAC,CAAC,GAAGD,CAAC,CAAC,EAAE,CAAC,EACtDC,CAAC,CAAC,CAAC,CAAC,GAAGD,CAAC,CAAC,CAAC,CAAC,GAAGC,CAAC,CAAC,CAAC,CAAC,GAAGD,CAAC,CAAC,CAAC,CAAC,GAAGC,CAAC,CAAC,CAAC,CAAC,GAAGD,CAAC,CAAC,EAAE,CAAC,GAAGC,CAAC,CAAC,CAAC,CAAC,GAAGD,CAAC,CAAC,EAAE,CAAC,EACvDC,CAAC,CAAC,CAAC,CAAC,GAAGD,CAAC,CAAC,CAAC,CAAC,GAAGC,CAAC,CAAC,CAAC,CAAC,GAAGD,CAAC,CAAC,CAAC,CAAC,GAAGC,CAAC,CAAC,CAAC,CAAC,GAAGD,CAAC,CAAC,EAAE,CAAC,GAAGC,CAAC,CAAC,CAAC,CAAC,GAAGD,CAAC,CAAC,EAAE,CAAC,EACvDC,CAAC,CAAC,CAAC,CAAC,GAAGD,CAAC,CAAC,CAAC,CAAC,GAAGC,CAAC,CAAC,CAAC,CAAC,GAAGD,CAAC,CAAC,CAAC,CAAC,GAAGC,CAAC,CAAC,EAAE,CAAC,GAAGD,CAAC,CAAC,CAAC,CAAC,GAAGC,CAAC,CAAC,EAAE,CAAC,GAAGD,CAAC,CAAC,EAAE,CAAC,EACxDC,CAAC,CAAC,CAAC,CAAC,GAAGD,CAAC,CAAC,CAAC,CAAC,GAAGC,CAAC,CAAC,CAAC,CAAC,GAAGD,CAAC,CAAC,CAAC,CAAC,GAAGC,CAAC,CAAC,EAAE,CAAC,GAAGD,CAAC,CAAC,CAAC,CAAC,GAAGC,CAAC,CAAC,EAAE,CAAC,GAAGD,CAAC,CAAC,EAAE,CAAC,EACxDC,CAAC,CAAC,CAAC,CAAC,GAAGD,CAAC,CAAC,CAAC,CAAC,GAAGC,CAAC,CAAC,CAAC,CAAC,GAAGD,CAAC,CAAC,CAAC,CAAC,GAAGC,CAAC,CAAC,EAAE,CAAC,GAAGD,CAAC,CAAC,EAAE,CAAC,GAAGC,CAAC,CAAC,EAAE,CAAC,GAAGD,CAAC,CAAC,EAAE,CAAC,EACzDC,CAAC,CAAC,CAAC,CAAC,GAAGD,CAAC,CAAC,CAAC,CAAC,GAAGC,CAAC,CAAC,CAAC,CAAC,GAAGD,CAAC,CAAC,CAAC,CAAC,GAAGC,CAAC,CAAC,EAAE,CAAC,GAAGD,CAAC,CAAC,EAAE,CAAC,GAAGC,CAAC,CAAC,EAAE,CAAC,GAAGD,CAAC,CAAC,EAAE,CAAC,EACzDC,CAAC,CAAC,EAAE,CAAC,GAAGD,CAAC,CAAC,CAAC,CAAC,GAAGC,CAAC,CAAC,EAAE,CAAC,GAAGD,CAAC,CAAC,CAAC,CAAC,GAAGC,CAAC,CAAC,EAAE,CAAC,GAAGD,CAAC,CAAC,CAAC,CAAC,GAAGC,CAAC,CAAC,EAAE,CAAC,GAAGD,CAAC,CAAC,EAAE,CAAC,EAC1DC,CAAC,CAAC,EAAE,CAAC,G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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}